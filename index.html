<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Invest AI - AI-Powered Investing Education</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:wght@400;500;700&family=JetBrains+Mono:wght@400;600&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --bg-dark: #0a0e27;
      --bg-card: #141b3d;
      --accent-gold: #f4c430;
      --accent-emerald: #2dd4bf;
      --accent-purple: #a78bfa;
      --text-primary: #f8fafc;
      --text-secondary: #94a3b8;
      --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }
    
    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--bg-dark);
      color: var(--text-primary);
      overflow-x: hidden;
      line-height: 1.6;
    }
    
    .app-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }
    
    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 30px 0;
      margin-bottom: 40px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      animation: slideDown 0.6s ease-out;
    }
    
    @keyframes slideDown {
      from { transform: translateY(-30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    .logo {
      font-family: 'Playfair Display', serif;
      font-size: 2.5rem;
      font-weight: 900;
      background: linear-gradient(135deg, var(--accent-gold), var(--accent-emerald));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -1px;
    }
    
    .nav-tabs {
      display: flex;
      gap: 15px;
    }
    
    .tab-btn {
      padding: 12px 24px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      color: var(--text-secondary);
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.95rem;
    }
    
    .tab-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: var(--accent-gold);
      color: var(--text-primary);
      transform: translateY(-2px);
    }
    
    .tab-btn.active {
      background: var(--accent-gold);
      color: var(--bg-dark);
      border-color: var(--accent-gold);
    }
    
    /* Main Content Area */
    .content-section {
      display: none;
      animation: fadeIn 0.5s ease-out;
    }
    
    .content-section.active {
      display: block;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Welcome Screen */
    .welcome-hero {
      text-align: center;
      padding: 60px 20px;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
      border-radius: 24px;
      margin-bottom: 40px;
      position: relative;
      overflow: hidden;
    }
    
    .welcome-hero::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(244, 196, 48, 0.1) 0%, transparent 70%);
      animation: rotate 20s linear infinite;
    }
    
    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    .welcome-hero h1 {
      font-family: 'Playfair Display', serif;
      font-size: 3.5rem;
      margin-bottom: 20px;
      position: relative;
      z-index: 1;
      animation: textGlow 3s ease-in-out infinite;
    }
    
    @keyframes textGlow {
      0%, 100% { text-shadow: 0 0 20px rgba(244, 196, 48, 0.3); }
      50% { text-shadow: 0 0 40px rgba(244, 196, 48, 0.6); }
    }
    
    .welcome-hero p {
      font-size: 1.3rem;
      color: var(--text-secondary);
      max-width: 700px;
      margin: 0 auto 30px;
      position: relative;
      z-index: 1;
    }
    
    .start-learning-btn {
      padding: 16px 48px;
      background: #39ff14;
      color: var(--bg-dark);
      border: none;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      z-index: 1;
      box-shadow: 0 0 20px rgba(57, 255, 20, 0.5);
    }
    
    .start-learning-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 40px rgba(57, 255, 20, 0.7), 0 0 30px rgba(57, 255, 20, 0.5);
    }
    
    /* Learning Modules Grid */
    .modules-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 25px;
      margin-top: 30px;
    }
    
    .module-card {
      background: var(--bg-card);
      border-radius: 20px;
      padding: 30px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .module-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: var(--gradient-1);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.3s ease;
    }
    
    .module-card:hover {
      transform: translateY(-5px);
      border-color: var(--accent-gold);
      box-shadow: 0 15px 40px rgba(244, 196, 48, 0.2);
    }
    
    .module-card:hover::before {
      transform: scaleX(1);
    }
    
    .module-icon {
      font-size: 3rem;
      margin-bottom: 15px;
    }
    
    .module-card h3 {
      font-family: 'Playfair Display', serif;
      font-size: 1.6rem;
      margin-bottom: 12px;
    }
    
    .module-card p {
      color: var(--text-secondary);
      line-height: 1.7;
    }
    
    /* Lesson Content */
    .lesson-container {
      background: var(--bg-card);
      border-radius: 20px;
      padding: 40px;
      margin-bottom: 30px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .lesson-container h2 {
      font-family: 'Playfair Display', serif;
      font-size: 2.5rem;
      margin-bottom: 30px;
      background: linear-gradient(135deg, var(--accent-gold), var(--accent-emerald));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    /* Animation Canvas */
    .animation-canvas {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 16px;
      padding: 40px;
      margin: 30px 0;
      min-height: 400px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    /* Penny Doubling Animation */
    .penny-animation {
      text-align: center;
    }
    
    .penny {
      width: 80px;
      height: 80px;
      background: radial-gradient(circle, #cd7f32 0%, #8b4513 100%);
      border-radius: 50%;
      margin: 20px auto;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: bold;
      box-shadow: 0 5px 15px rgba(205, 127, 50, 0.5);
      animation: pulse 2s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    .day-counter {
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent-gold);
      margin: 20px 0;
    }
    
    .penny-value {
      font-size: 1.8rem;
      font-family: 'JetBrains Mono', monospace;
      color: var(--accent-emerald);
      margin: 15px 0;
    }
    
    .animation-controls {
      margin-top: 30px;
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .control-btn {
      padding: 12px 30px;
      background: #39ff14;
      color: var(--bg-dark);
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 0 15px rgba(57, 255, 20, 0.4);
    }
    
    .control-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(57, 255, 20, 0.6), 0 0 25px rgba(57, 255, 20, 0.4);
    }
    
    .control-btn.secondary {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-primary);
    }
    
    /* Chart Container */
    .chart-container {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 16px;
      padding: 30px;
      margin: 30px 0;
      height: 400px;
      position: relative;
    }
    
    /* Stock Analysis */
    .stock-search {
      margin-bottom: 30px;
      position: relative;
    }
    
    .search-input {
      width: 100%;
      padding: 16px 24px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 1.1rem;
      transition: all 0.3s ease;
    }
    
    .search-input:focus {
      outline: none;
      border-color: #39ff14;
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 20px rgba(57, 255, 20, 0.2);
    }
    
    .search-input::placeholder {
      color: var(--text-secondary);
    }
    
    .autocomplete-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: var(--bg-card);
      border: 2px solid #39ff14;
      border-top: none;
      border-radius: 0 0 12px 12px;
      max-height: 400px;
      overflow-y: auto;
      z-index: 1000;
      display: none;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      margin-top: -2px;
    }
    
    .autocomplete-dropdown.show {
      display: block;
      animation: slideDown 0.3s ease-out;
    }
    
    @keyframes slideDown {
      from { 
        opacity: 0;
        transform: translateY(-10px);
      }
      to { 
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Custom scrollbar for dropdown */
    .autocomplete-dropdown::-webkit-scrollbar {
      width: 8px;
    }
    
    .autocomplete-dropdown::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 0 0 12px 0;
    }
    
    .autocomplete-dropdown::-webkit-scrollbar-thumb {
      background: #39ff14;
      border-radius: 4px;
    }
    
    .autocomplete-dropdown::-webkit-scrollbar-thumb:hover {
      background: #2de00f;
    }
    
    .autocomplete-item {
      padding: 15px 24px;
      cursor: pointer;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      transition: all 0.2s ease;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .autocomplete-item:hover,
    .autocomplete-item.selected {
      background: rgba(57, 255, 20, 0.1);
      border-left: 4px solid #39ff14;
    }
    
    .autocomplete-item:last-child {
      border-bottom: none;
    }
    
    .stock-ticker {
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
      color: #39ff14;
      font-size: 1.1rem;
    }
    
    .stock-name {
      color: var(--text-primary);
      flex: 1;
      margin: 0 15px;
    }
    
    .stock-exchange {
      font-size: 0.85rem;
      color: var(--text-secondary);
      background: rgba(255, 255, 255, 0.05);
      padding: 4px 10px;
      border-radius: 6px;
      font-family: 'JetBrains Mono', monospace;
    }
    
    .no-results {
      padding: 20px 24px;
      text-align: center;
      color: var(--text-secondary);
      font-style: italic;
    }
    
    .region-label {
      padding: 10px 24px;
      background: rgba(57, 255, 20, 0.05);
      color: #39ff14;
      font-weight: 600;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      border-bottom: 1px solid rgba(57, 255, 20, 0.2);
    }
    
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }
    
    .metric-card {
      background: rgba(255, 255, 255, 0.03);
      padding: 20px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .metric-label {
      color: var(--text-secondary);
      font-size: 0.9rem;
      margin-bottom: 8px;
    }
    
    .metric-value {
      font-size: 1.8rem;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
      color: var(--accent-emerald);
    }
    
    .metric-change {
      font-size: 0.9rem;
      margin-top: 5px;
    }
    
    .positive {
      color: #22c55e;
    }
    
    .negative {
      color: #ef4444;
    }
    
    /* AI Analysis Section */
    .ai-analysis {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
      border-radius: 16px;
      padding: 30px;
      margin: 30px 0;
      border: 1px solid rgba(167, 139, 250, 0.3);
    }
    
    .ai-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: var(--accent-purple);
      color: white;
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      margin-bottom: 15px;
    }
    
    .ai-content {
      font-size: 1.05rem;
      line-height: 1.8;
      color: var(--text-primary);
    }
    
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top-color: var(--accent-gold);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Tables */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    
    .data-table th {
      background: rgba(255, 255, 255, 0.05);
      padding: 15px;
      text-align: left;
      font-weight: 600;
      border-bottom: 2px solid rgba(255, 255, 255, 0.1);
    }
    
    .data-table td {
      padding: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .data-table tr:hover {
      background: rgba(255, 255, 255, 0.03);
    }
    
    /* Progress Bar */
    .progress-bar {
      width: 100%;
      height: 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      overflow: hidden;
      margin: 20px 0;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-gold), var(--accent-emerald));
      border-radius: 10px;
      transition: width 0.5s ease;
    }
    
    /* Tooltip */
    .tooltip {
      position: relative;
      display: inline-block;
      cursor: help;
      border-bottom: 1px dashed var(--text-secondary);
    }
    
    .tooltip-text {
      visibility: hidden;
      background: var(--bg-dark);
      color: var(--text-primary);
      text-align: center;
      padding: 10px 15px;
      border-radius: 8px;
      position: absolute;
      z-index: 1000;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
      white-space: nowrap;
      border: 1px solid rgba(255, 255, 255, 0.2);
      font-size: 0.9rem;
    }
    
    .tooltip:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .logo {
        font-size: 2rem;
      }
      
      .nav-tabs {
        flex-wrap: wrap;
      }
      
      .welcome-hero h1 {
        font-size: 2.5rem;
      }
      
      .modules-grid {
        grid-template-columns: 1fr;
      }
      
      .lesson-container {
        padding: 25px;
      }
      
      .metrics-grid {
        grid-template-columns: 1fr;
      }
      
      .flashcard-content {
        grid-template-columns: 1fr !important;
      }
      
      .flashcard-canvas-wrapper {
        width: 100% !important;
        height: auto !important;
      }
      
      .flashcard-canvas {
        width: 100% !important;
        height: auto !important;
        aspect-ratio: 1;
      }
    }
    
    /* Fix scrolling issue */
    html {
      scroll-behavior: smooth;
    }
    
    body {
      overflow-x: hidden;
      overflow-y: auto;
    }
    
    /* Export buttons */
    .export-buttons {
      display: flex;
      gap: 15px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    
    .export-btn {
      padding: 12px 24px;
      border: 2px solid #39ff14;
      background: rgba(57, 255, 20, 0.1);
      color: #39ff14;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.95rem;
    }
    
    .export-btn:hover {
      background: rgba(57, 255, 20, 0.2);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(57, 255, 20, 0.3);
    }
    
    .export-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    .model-selector {
      margin-bottom: 20px;
      padding: 20px;
      background: rgba(167, 139, 250, 0.1);
      border-radius: 12px;
      border: 1px solid rgba(167, 139, 250, 0.3);
    }
    
    .model-selector h4 {
      font-size: 1.1rem;
      margin-bottom: 15px;
      color: var(--accent-purple);
    }
    
    .model-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
    }
    
    .model-option {
      padding: 15px;
      background: rgba(255, 255, 255, 0.03);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .model-option:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: #39ff14;
    }
    
    .model-option.selected {
      background: rgba(57, 255, 20, 0.1);
      border-color: #39ff14;
      box-shadow: 0 0 15px rgba(57, 255, 20, 0.3);
    }
    
    .model-option h5 {
      font-size: 1rem;
      margin-bottom: 5px;
      color: var(--text-primary);
    }
    
    .model-option p {
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }
    
    .model-badge {
      display: inline-block;
      padding: 3px 8px;
      background: rgba(57, 255, 20, 0.2);
      color: #39ff14;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    /* Expandable Cards */
    .expandable-card {
      background: rgba(255, 255, 255, 0.03);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      margin: 20px 0;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .expandable-card:hover {
      border-color: #39ff14;
      background: rgba(255, 255, 255, 0.05);
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(57, 255, 20, 0.2);
    }
    
    .expand-header {
      padding: 20px 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
    }
    
    .expand-icon {
      font-size: 2rem;
      color: #39ff14;
      font-weight: bold;
      transition: transform 0.3s ease;
    }
    
    .expandable-card.expanded .expand-icon {
      transform: rotate(45deg);
    }
    
    .expand-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s ease, padding 0.5s ease;
      padding: 0 25px;
    }
    
    .expandable-card.expanded .expand-content {
      max-height: 10000px;
      padding: 25px;
    }
    
    .timeline-item {
      position: relative;
      padding-left: 0;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Flashcard Modal */
    .flashcard-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      z-index: 10000;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease-out;
    }

    .flashcard-modal.show {
      display: flex;
    }

    .flashcard-container {
      background: var(--bg-card);
      border-radius: 24px;
      padding: 40px;
      max-width: 1400px;
      width: 95%;
      max-height: 90vh;
      overflow-y: auto;
      border: 1px solid rgba(255, 255, 255, 0.1);
      position: relative;
    }

    .flashcard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .flashcard-header h2 {
      font-family: 'Playfair Display', serif;
      font-size: 2rem;
      background: linear-gradient(135deg, var(--accent-gold), var(--accent-emerald));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .close-modal {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: var(--text-primary);
      font-size: 2rem;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .close-modal:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: rotate(90deg);
    }

    .flashcard-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
      align-items: start;
    }

    .flashcard-preview {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: sticky;
      top: 20px;
    }

    .flashcard-canvas-wrapper {
      position: relative;
      width: 540px;
      height: 540px;
      margin-bottom: 20px;
    }

    .flashcard-canvas {
      width: 540px;
      height: 540px;
      border-radius: 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px;
      text-align: center;
      position: relative;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      transition: all 0.3s ease;
    }

    .flashcard-concept {
      font-size: 2rem;
      font-weight: 700;
      color: white;
      margin-bottom: 30px;
      font-family: 'Playfair Display', serif;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .flashcard-definition {
      font-size: 1.3rem;
      color: white;
      line-height: 1.6;
      margin-bottom: 25px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
    }

    .flashcard-formula {
      background: rgba(0, 0, 0, 0.3);
      padding: 15px 25px;
      border-radius: 12px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.4rem;
      color: #39ff14;
      margin-bottom: 20px;
      border: 2px solid rgba(57, 255, 20, 0.3);
    }

    .flashcard-example {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px 20px;
      border-radius: 10px;
      font-size: 1.1rem;
      color: rgba(255, 255, 255, 0.9);
      border-left: 4px solid #f4c430;
    }

    .flashcard-logo {
      position: absolute;
      bottom: 20px;
      right: 30px;
      font-family: 'Playfair Display', serif;
      font-size: 1.5rem;
      font-weight: 900;
      color: rgba(255, 255, 255, 0.5);
      z-index: 10;
    }

    /* Gradient Backgrounds */
    .gradient-1 {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .gradient-2 {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .gradient-3 {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }

    .gradient-4 {
      background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    }

    .gradient-5 {
      background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    }

    .gradient-6 {
      background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
    }

    .gradient-7 {
      background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
    }

    .gradient-8 {
      background: linear-gradient(135deg, #ff9a56 0%, #ff6a88 100%);
    }

    /* Controls Section */
    .flashcard-controls {
      width: 100%;
    }

    .control-section {
      background: rgba(255, 255, 255, 0.03);
      padding: 25px;
      border-radius: 16px;
      margin-bottom: 20px;
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .control-section h3 {
      font-size: 1.3rem;
      margin-bottom: 20px;
      color: var(--accent-gold);
      font-weight: 600;
    }

    .gradient-selector {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-bottom: 10px;
    }

    .gradient-option {
      width: 100%;
      height: 80px;
      border-radius: 12px;
      cursor: pointer;
      border: 3px solid transparent;
      transition: all 0.3s ease;
      position: relative;
    }

    .gradient-option:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    }

    .gradient-option.active {
      border-color: #39ff14;
      box-shadow: 0 0 20px rgba(57, 255, 20, 0.5);
    }

    .size-controls {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .size-control {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .size-control label {
      font-size: 1rem;
      color: var(--text-secondary);
      min-width: 120px;
    }

    .size-control input[type="range"] {
      flex: 1;
      margin: 0 15px;
      height: 6px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 5px;
      outline: none;
    }

    .size-control input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      background: #39ff14;
      cursor: pointer;
      border-radius: 50%;
      box-shadow: 0 0 10px rgba(57, 255, 20, 0.5);
    }

    .size-control input[type="range"]::-moz-range-thumb {
      width: 20px;
      height: 20px;
      background: #39ff14;
      cursor: pointer;
      border-radius: 50%;
      box-shadow: 0 0 10px rgba(57, 255, 20, 0.5);
      border: none;
    }

    .size-value {
      min-width: 50px;
      text-align: right;
      font-family: 'JetBrains Mono', monospace;
      color: var(--accent-emerald);
      font-weight: 600;
    }

    .flashcard-actions {
      display: flex;
      gap: 15px;
      margin-top: 30px;
    }

    .flashcard-btn {
      flex: 1;
      padding: 16px 24px;
      border: none;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .flashcard-btn.primary {
      background: #39ff14;
      color: var(--bg-dark);
      box-shadow: 0 0 20px rgba(57, 255, 20, 0.4);
    }

    .flashcard-btn.primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 25px rgba(57, 255, 20, 0.6);
    }

    .flashcard-btn.secondary {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-primary);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .flashcard-btn.secondary:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: translateY(-2px);
    }

    .concept-library {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .concept-card {
      background: rgba(255, 255, 255, 0.05);
      padding: 15px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }

    .concept-card:hover {
      background: rgba(57, 255, 20, 0.1);
      border-color: #39ff14;
      transform: translateY(-3px);
    }

    .concept-card.active {
      background: rgba(57, 255, 20, 0.15);
      border-color: #39ff14;
    }

    .concept-card h4 {
      font-size: 0.95rem;
      color: var(--text-primary);
      margin-bottom: 5px;
    }

    .concept-card p {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <header class="header">
      <div class="logo">Invest AI</div>
      <nav class="nav-tabs">
        <button class="tab-btn active" onclick="switchTab('home')">Home</button>
        <button class="tab-btn" onclick="switchTab('learn')">Learn</button>
        <button class="tab-btn" onclick="switchTab('flashcards')">üìö Flashcards</button>
        <button class="tab-btn" onclick="switchTab('analyze')">Analyze Stocks</button>
      </nav>
    </header>

    <!-- Home Section -->
    <section id="home" class="content-section active">
      <div class="welcome-hero">
        <h1>Master Investing with AI</h1>
        <p>Your personal AI-powered guide to understanding markets, analyzing stocks, and building wealth through informed investing.</p>
        
        <!-- Debug Test Button -->
        <button onclick="testJS()" style="background: rgba(255,0,0,0.2); border: 2px solid red; color: white; padding: 8px 16px; border-radius: 8px; margin: 10px; cursor: pointer; font-size: 0.9rem;">
          üîß Test JavaScript (Click if buttons don't work)
        </button>
        
        <button class="start-learning-btn" onclick="switchTab('learn')">Start Learning Now</button>
      </div>
    </section>

    <!-- Learn Section -->
    <section id="learn" class="content-section">
      <div id="modules-view">
        <h2 style="font-size: 2.5rem; text-align: center; margin-bottom: 40px; font-family: 'Playfair Display', serif;">
          üìö Choose Your Learning Path
        </h2>
        <div class="modules-grid">
          <div class="module-card" onclick="loadLesson('compounding')">
            <div class="module-icon">üí∞</div>
            <h3>The Power of Compounding</h3>
            <p>Discover how small investments grow exponentially over time through interactive animations and real-world examples.</p>
          </div>

          <div class="module-card" onclick="loadLesson('stocks')">
            <div class="module-icon">üìà</div>
            <h3>Stocks & Capital Markets</h3>
            <p>Learn what stocks are, how markets work, and the difference between individual stocks and ETFs.</p>
          </div>

          <div class="module-card" onclick="loadLesson('analysis')">
            <div class="module-icon">üîç</div>
            <h3>Stock Analysis</h3>
            <p>Master the art of analyzing companies using financial metrics, ratios, and valuation techniques.</p>
          </div>

          <div class="module-card" onclick="loadLesson('financials')">
            <div class="module-icon">üìä</div>
            <h3>Financial Modeling</h3>
            <p>Understand balance sheets, P&L statements, cash flows, and how to build financial models.</p>
          </div>

          <div class="module-card" onclick="loadLesson('valuation')">
            <div class="module-icon">üíé</div>
            <h3>Stock Valuation</h3>
            <p>Learn DCF analysis, price multiples, and how to determine if a stock is fairly valued.</p>
          </div>

          <div class="module-card" onclick="loadLesson('metrics')">
            <div class="module-icon">üìê</div>
            <h3>Key Metrics & Ratios</h3>
            <p>Deep dive into ROE, ROIC, debt ratios, and other crucial metrics for evaluating companies.</p>
          </div>
        </div>
      </div>
      
      <div id="lesson-content" style="display: none;"></div>
    </section>

    <!-- Flashcards Section -->
    <section id="flashcards" class="content-section">
      <div style="max-width: 1400px; margin: 0 auto; padding: 40px 20px;">
        <h2 style="font-size: 2.5rem; text-align: center; margin-bottom: 20px; font-family: 'Playfair Display', serif;">
          üìö Investment Flashcards
        </h2>
        <p style="text-align: center; font-size: 1.1rem; color: var(--text-secondary); margin-bottom: 40px; max-width: 800px; margin-left: auto; margin-right: auto;">
          Master investing concepts with visual flashcards. Create 1080x1080 shareable cards perfect for Instagram, study, or sharing with friends. Click any concept to customize and download!
        </p>
        
        <div id="flashcard-library" class="concept-library"></div>
      </div>
    </section>

    <!-- Analyze Section -->
    <section id="analyze" class="content-section">
      <div class="lesson-container">
        <h2>AI-Powered Stock Analysis</h2>
        <p style="color: var(--text-secondary); margin-bottom: 30px;">Search for any stock to get comprehensive financial analysis, metrics, and AI-powered insights.</p>
        
        <div class="stock-search">
          <input 
            type="text" 
            id="stockSymbol" 
            class="search-input" 
            placeholder="Search global stocks (e.g., AAPL, RACE, BABA, HDFCBANK.NS)..."
            oninput="filterStocks()"
            onfocus="showDropdown()"
            onkeydown="handleKeyDown(event)"
            autocomplete="off"
          >
          <div id="autocompleteDropdown" class="autocomplete-dropdown"></div>
        </div>

        <div class="model-selector">
          <h4>ü§ñ Select Analysis Model</h4>
          <div class="model-options">
            <div class="model-option selected" onclick="selectModel('sonnet')" id="model-sonnet">
              <h5>Claude Sonnet 4.5</h5>
              <p>Fast, balanced analysis - Perfect for quick insights</p>
              <span class="model-badge">RECOMMENDED</span>
            </div>
            <div class="model-option" onclick="selectModel('opus')" id="model-opus">
              <h5>Claude Opus 4.5</h5>
              <p>Deep financial analysis - Most comprehensive research</p>
              <span class="model-badge">PREMIUM</span>
            </div>
          </div>
        </div>

        <div class="animation-controls">
          <button class="control-btn" onclick="analyzeStock()">üîç Analyze Stock</button>
          <button class="control-btn secondary" onclick="showExample()">üìä Show Example (AAPL)</button>
        </div>

        <div id="stockAnalysis"></div>
      </div>
    </section>
  </div>

  <!-- AI Video Explanation Modal -->
  <div id="video-explanation-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10000; justify-content: center; align-items: center; overflow-y: auto;">
    <div style="width: 90%; max-width: 900px; background: linear-gradient(135deg, #1a1f3a, #0a0e27); border-radius: 24px; padding: 40px; position: relative; margin: 20px;">
      <button onclick="closeVideoExplanation()" style="position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.1); border: 2px solid #39ff14; color: #39ff14; width: 50px; height: 50px; border-radius: 50%; font-size: 1.5rem; cursor: pointer; display: flex; align-items: center; justify-content: center;">‚úï</button>
      
      <div style="text-align: center; margin-bottom: 30px;">
        <h2 id="video-concept-title" style="font-size: 2rem; color: #39ff14; margin-bottom: 10px; font-family: 'Playfair Display', serif;"></h2>
        <p style="color: var(--text-secondary); font-size: 1.1rem;">AI-Powered 60-Second Explanation</p>
      </div>
      
      <!-- Video Progress Bar -->
      <div style="background: rgba(255,255,255,0.1); height: 6px; border-radius: 10px; margin-bottom: 30px; overflow: hidden;">
        <div id="video-progress-bar" style="background: linear-gradient(90deg, #39ff14, var(--accent-emerald)); height: 100%; width: 0%; transition: width 0.3s ease;"></div>
      </div>
      
      <!-- Animated Flashcard Display -->
      <div id="video-flashcard-display" style="background: linear-gradient(135deg, var(--gradient-1-start), var(--gradient-1-end)); padding: 40px; border-radius: 20px; margin-bottom: 30px; min-height: 400px; display: flex; flex-direction: column; justify-content: center; box-shadow: 0 10px 40px rgba(0,0,0,0.5);">
        <div id="video-flashcard-content" style="text-align: center;">
          <!-- Dynamic content will be inserted here -->
        </div>
      </div>
      
      <!-- Script Display with Synchronized Highlighting -->
      <div id="video-script-container" style="background: rgba(0,0,0,0.3); padding: 25px; border-radius: 16px; margin-bottom: 25px; border-left: 4px solid var(--accent-purple);">
        <h4 style="color: var(--accent-purple); margin-bottom: 15px; font-size: 1.1rem;">üìù Transcript:</h4>
        <div id="video-script-display" style="font-size: 1.05rem; line-height: 2; color: rgba(255,255,255,0.7); font-family: 'Inter', sans-serif;">
          <!-- Script will appear here -->
        </div>
      </div>
      
      <!-- Video Controls -->
      <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
        <button id="play-explanation-btn" onclick="playExplanation()" style="background: linear-gradient(135deg, #39ff14, var(--accent-emerald)); color: #0a0e27; padding: 15px 40px; border-radius: 12px; border: none; font-size: 1.1rem; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 10px;">
          <span id="play-icon">‚ñ∂Ô∏è</span>
          <span id="play-text">Play Explanation</span>
        </button>
        
        <button onclick="pauseExplanation()" style="background: rgba(244, 196, 48, 0.2); color: var(--accent-gold); padding: 15px 30px; border-radius: 12px; border: 2px solid var(--accent-gold); font-size: 1.1rem; font-weight: 600; cursor: pointer;">
          ‚è∏Ô∏è Pause
        </button>
        
        <button onclick="stopExplanation()" style="background: rgba(255, 107, 107, 0.2); color: #ff6b6b; padding: 15px 30px; border-radius: 12px; border: 2px solid #ff6b6b; font-size: 1.1rem; font-weight: 600; cursor: pointer;">
          ‚èπÔ∏è Stop
        </button>
        
        <button onclick="replayExplanation()" style="background: rgba(102, 126, 234, 0.2); color: var(--accent-purple); padding: 15px 30px; border-radius: 12px; border: 2px solid var(--accent-purple); font-size: 1.1rem; font-weight: 600; cursor: pointer;">
          üîÑ Replay
        </button>
      </div>
      
      <!-- Loading State -->
      <div id="video-loading" style="display: none; text-align: center; padding: 40px;">
        <div style="display: inline-block; width: 50px; height: 50px; border: 5px solid rgba(57, 255, 20, 0.3); border-top-color: #39ff14; border-radius: 50%; animation: spin 1s linear infinite;"></div>
        <p style="margin-top: 20px; color: #39ff14; font-size: 1.1rem;">Generating AI explanation with Claude...</p>
      </div>
      
      <!-- Voice Settings -->
      <div style="margin-top: 30px; padding: 20px; background: rgba(255,255,255,0.05); border-radius: 12px;">
        <h4 style="color: var(--accent-gold); margin-bottom: 15px; font-size: 1rem;">üéôÔ∏è Voice Settings:</h4>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
          <div>
            <label style="color: var(--text-secondary); font-size: 0.9rem; display: block; margin-bottom: 5px;">Speed:</label>
            <input type="range" id="voice-rate" min="0.5" max="1.5" step="0.1" value="0.9" style="width: 100%;">
            <span id="rate-value" style="color: #39ff14; font-size: 0.85rem;">0.9x</span>
          </div>
          <div>
            <label style="color: var(--text-secondary); font-size: 0.9rem; display: block; margin-bottom: 5px;">Pitch:</label>
            <input type="range" id="voice-pitch" min="0.5" max="2" step="0.1" value="1" style="width: 100%;">
            <span id="pitch-value" style="color: #39ff14; font-size: 0.85rem;">1.0x</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Flashcard Modal -->
  <div id="flashcardModal" class="flashcard-modal">
    <div class="flashcard-container">
      <div class="flashcard-header">
        <h2>üìö Create Learning Flashcard</h2>
        <button class="close-modal" onclick="closeFlashcardModal()">√ó</button>
      </div>

      <div class="flashcard-content">
        <!-- Preview Section -->
        <div class="flashcard-preview">
          <div class="flashcard-canvas-wrapper">
            <div id="flashcardCanvas" class="flashcard-canvas gradient-1">
              <div class="flashcard-concept" id="previewConcept">Return on Equity (ROE)</div>
              <div class="flashcard-definition" id="previewDefinition">Measures how efficiently a company uses shareholders' equity to generate profits</div>
              <div class="flashcard-formula" id="previewFormula">ROE = Net Income √∑ Shareholders' Equity</div>
              <div class="flashcard-example" id="previewExample">üí° Example: A company with $100M equity earning $20M profit has 20% ROE</div>
              <div class="flashcard-logo">Invest AI</div>
            </div>
          </div>

          <div class="flashcard-actions">
            <button class="flashcard-btn primary" onclick="downloadFlashcard()">
              üíæ Download PNG
            </button>
            <button class="flashcard-btn secondary" onclick="shareFlashcard()">
              üì§ Share
            </button>
          </div>
        </div>

        <!-- Controls Section -->
        <div class="flashcard-controls">
          <!-- Concept Selection -->
          <div class="control-section">
            <h3>üìñ Select Concept</h3>
            <div class="concept-library" id="conceptLibrary"></div>
          </div>

          <!-- Gradient Selection -->
          <div class="control-section">
            <h3>üé® Choose Background</h3>
            <div class="gradient-selector">
              <div class="gradient-option gradient-1 active" onclick="selectGradient(1)"></div>
              <div class="gradient-option gradient-2" onclick="selectGradient(2)"></div>
              <div class="gradient-option gradient-3" onclick="selectGradient(3)"></div>
              <div class="gradient-option gradient-4" onclick="selectGradient(4)"></div>
              <div class="gradient-option gradient-5" onclick="selectGradient(5)"></div>
              <div class="gradient-option gradient-6" onclick="selectGradient(6)"></div>
              <div class="gradient-option gradient-7" onclick="selectGradient(7)"></div>
              <div class="gradient-option gradient-8" onclick="selectGradient(8)"></div>
            </div>
          </div>

          <!-- Text Size Controls -->
          <div class="control-section">
            <h3>üìè Adjust Text Size</h3>
            <div class="size-controls">
              <div class="size-control">
                <label>Concept:</label>
                <input type="range" min="24" max="48" value="32" id="conceptSize" oninput="updateTextSize('concept', this.value)">
                <span class="size-value"><span id="conceptSizeValue">32</span>px</span>
              </div>
              <div class="size-control">
                <label>Definition:</label>
                <input type="range" min="16" max="32" value="21" id="definitionSize" oninput="updateTextSize('definition', this.value)">
                <span class="size-value"><span id="definitionSizeValue">21</span>px</span>
              </div>
              <div class="size-control">
                <label>Formula:</label>
                <input type="range" min="18" max="36" value="22" id="formulaSize" oninput="updateTextSize('formula', this.value)">
                <span class="size-value"><span id="formulaSizeValue">22</span>px</span>
              </div>
              <div class="size-control">
                <label>Example:</label>
                <input type="range" min="14" max="28" value="18" id="exampleSize" oninput="updateTextSize('example', this.value)">
                <span class="size-value"><span id="exampleSizeValue">18</span>px</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    // Debug helper
    console.log('Invest AI App Loading...');
    
    // Ensure functions are in global scope
    window.appReady = false;
    
    // Test function to verify JavaScript is working
    function testJS() {
      alert('‚úÖ JavaScript is working!\n\nIf you see this message, the app should work.\n\nTry clicking "Start Learning Now" or any module card.');
      console.log('JavaScript test successful');
      return true;
    }
    
    // Make test function available globally
    window.testJS = testJS;
  </script>
  <script>
    // Comprehensive Global Stock Database
    const globalStocks = {
      "United States": [
        // Tech Giants & FAANG
        { ticker: "AAPL", name: "Apple Inc.", exchange: "NASDAQ" },
        { ticker: "MSFT", name: "Microsoft Corporation", exchange: "NASDAQ" },
        { ticker: "GOOGL", name: "Alphabet Inc.", exchange: "NASDAQ" },
        { ticker: "GOOG", name: "Alphabet Inc. Class C", exchange: "NASDAQ" },
        { ticker: "AMZN", name: "Amazon.com Inc.", exchange: "NASDAQ" },
        { ticker: "NVDA", name: "NVIDIA Corporation", exchange: "NASDAQ" },
        { ticker: "TSLA", name: "Tesla Inc.", exchange: "NASDAQ" },
        { ticker: "META", name: "Meta Platforms Inc.", exchange: "NASDAQ" },
        { ticker: "NFLX", name: "Netflix Inc.", exchange: "NASDAQ" },
        
        // Semiconductors & Hardware
        { ticker: "AMD", name: "Advanced Micro Devices Inc.", exchange: "NASDAQ" },
        { ticker: "INTC", name: "Intel Corporation", exchange: "NASDAQ" },
        { ticker: "AVGO", name: "Broadcom Inc.", exchange: "NASDAQ" },
        { ticker: "QCOM", name: "Qualcomm Inc.", exchange: "NASDAQ" },
        { ticker: "TXN", name: "Texas Instruments Inc.", exchange: "NASDAQ" },
        { ticker: "MU", name: "Micron Technology Inc.", exchange: "NASDAQ" },
        { ticker: "AMAT", name: "Applied Materials Inc.", exchange: "NASDAQ" },
        { ticker: "LRCX", name: "Lam Research Corporation", exchange: "NASDAQ" },
        { ticker: "KLAC", name: "KLA Corporation", exchange: "NASDAQ" },
        { ticker: "MRVL", name: "Marvell Technology Inc.", exchange: "NASDAQ" },
        { ticker: "ADI", name: "Analog Devices Inc.", exchange: "NASDAQ" },
        { ticker: "NXPI", name: "NXP Semiconductors N.V.", exchange: "NASDAQ" },
        { ticker: "MCHP", name: "Microchip Technology Inc.", exchange: "NASDAQ" },
        { ticker: "ON", name: "ON Semiconductor Corporation", exchange: "NASDAQ" },
        { ticker: "SWKS", name: "Skyworks Solutions Inc.", exchange: "NASDAQ" },
        { ticker: "QRVO", name: "Qorvo Inc.", exchange: "NASDAQ" },
        { ticker: "LITE", name: "Lumentum Holdings Inc.", exchange: "NASDAQ" },
        { ticker: "CRUS", name: "Cirrus Logic Inc.", exchange: "NASDAQ" },
        { ticker: "MPWR", name: "Monolithic Power Systems Inc.", exchange: "NASDAQ" },
        
        // Software & Cloud
        { ticker: "ORCL", name: "Oracle Corporation", exchange: "NYSE" },
        { ticker: "CRM", name: "Salesforce Inc.", exchange: "NYSE" },
        { ticker: "ADBE", name: "Adobe Inc.", exchange: "NASDAQ" },
        { ticker: "NOW", name: "ServiceNow Inc.", exchange: "NYSE" },
        { ticker: "INTU", name: "Intuit Inc.", exchange: "NASDAQ" },
        { ticker: "WDAY", name: "Workday Inc.", exchange: "NASDAQ" },
        { ticker: "TEAM", name: "Atlassian Corporation", exchange: "NASDAQ" },
        { ticker: "DDOG", name: "Datadog Inc.", exchange: "NASDAQ" },
        { ticker: "SNOW", name: "Snowflake Inc.", exchange: "NYSE" },
        { ticker: "CRWD", name: "CrowdStrike Holdings Inc.", exchange: "NASDAQ" },
        { ticker: "ZS", name: "Zscaler Inc.", exchange: "NASDAQ" },
        { ticker: "PANW", name: "Palo Alto Networks Inc.", exchange: "NASDAQ" },
        { ticker: "FTNT", name: "Fortinet Inc.", exchange: "NASDAQ" },
        { ticker: "OKTA", name: "Okta Inc.", exchange: "NASDAQ" },
        { ticker: "NET", name: "Cloudflare Inc.", exchange: "NYSE" },
        { ticker: "PLTR", name: "Palantir Technologies Inc.", exchange: "NYSE" },
        { ticker: "U", name: "Unity Software Inc.", exchange: "NYSE" },
        { ticker: "RBLX", name: "Roblox Corporation", exchange: "NYSE" },
        
        // E-commerce & Digital
        { ticker: "SHOP", name: "Shopify Inc.", exchange: "NYSE" },
        { ticker: "MELI", name: "MercadoLibre Inc.", exchange: "NASDAQ" },
        { ticker: "EBAY", name: "eBay Inc.", exchange: "NASDAQ" },
        { ticker: "ETSY", name: "Etsy Inc.", exchange: "NASDAQ" },
        { ticker: "W", name: "Wayfair Inc.", exchange: "NYSE" },
        { ticker: "CHWY", name: "Chewy Inc.", exchange: "NYSE" },
        
        // Fintech & Payments
        { ticker: "V", name: "Visa Inc.", exchange: "NYSE" },
        { ticker: "MA", name: "Mastercard Inc.", exchange: "NYSE" },
        { ticker: "PYPL", name: "PayPal Holdings Inc.", exchange: "NASDAQ" },
        { ticker: "SQ", name: "Block Inc.", exchange: "NYSE" },
        { ticker: "COIN", name: "Coinbase Global Inc.", exchange: "NASDAQ" },
        { ticker: "AFRM", name: "Affirm Holdings Inc.", exchange: "NASDAQ" },
        { ticker: "SOFI", name: "SoFi Technologies Inc.", exchange: "NASDAQ" },
        { ticker: "UPST", name: "Upstart Holdings Inc.", exchange: "NASDAQ" },
        { ticker: "HOOD", name: "Robinhood Markets Inc.", exchange: "NASDAQ" },
        
        // Social Media & Communication
        { ticker: "SNAP", name: "Snap Inc.", exchange: "NYSE" },
        { ticker: "PINS", name: "Pinterest Inc.", exchange: "NYSE" },
        { ticker: "RDDT", name: "Reddit Inc.", exchange: "NYSE" },
        { ticker: "MTCH", name: "Match Group Inc.", exchange: "NASDAQ" },
        { ticker: "BMBL", name: "Bumble Inc.", exchange: "NASDAQ" },
        { ticker: "ZM", name: "Zoom Video Communications Inc.", exchange: "NASDAQ" },
        { ticker: "DOCU", name: "DocuSign Inc.", exchange: "NASDAQ" },
        { ticker: "TWLO", name: "Twilio Inc.", exchange: "NYSE" },
        
        // Transportation & Mobility
        { ticker: "UBER", name: "Uber Technologies Inc.", exchange: "NYSE" },
        { ticker: "LYFT", name: "Lyft Inc.", exchange: "NASDAQ" },
        { ticker: "ABNB", name: "Airbnb Inc.", exchange: "NASDAQ" },
        { ticker: "DASH", name: "DoorDash Inc.", exchange: "NYSE" },
        
        // Auto & EV
        { ticker: "F", name: "Ford Motor Company", exchange: "NYSE" },
        { ticker: "GM", name: "General Motors Company", exchange: "NYSE" },
        { ticker: "RIVN", name: "Rivian Automotive Inc.", exchange: "NASDAQ" },
        { ticker: "LCID", name: "Lucid Group Inc.", exchange: "NASDAQ" },
        
        // Banks & Financial Services
        { ticker: "JPM", name: "JPMorgan Chase & Co.", exchange: "NYSE" },
        { ticker: "BAC", name: "Bank of America Corporation", exchange: "NYSE" },
        { ticker: "WFC", name: "Wells Fargo & Company", exchange: "NYSE" },
        { ticker: "C", name: "Citigroup Inc.", exchange: "NYSE" },
        { ticker: "GS", name: "The Goldman Sachs Group Inc.", exchange: "NYSE" },
        { ticker: "MS", name: "Morgan Stanley", exchange: "NYSE" },
        { ticker: "BLK", name: "BlackRock Inc.", exchange: "NYSE" },
        { ticker: "SCHW", name: "The Charles Schwab Corporation", exchange: "NYSE" },
        { ticker: "AXP", name: "American Express Company", exchange: "NYSE" },
        { ticker: "BRK.B", name: "Berkshire Hathaway Inc.", exchange: "NYSE" },
        { ticker: "BRK.A", name: "Berkshire Hathaway Inc. Class A", exchange: "NYSE" },
        
        // Healthcare & Pharma
        { ticker: "JNJ", name: "Johnson & Johnson", exchange: "NYSE" },
        { ticker: "UNH", name: "UnitedHealth Group Inc.", exchange: "NYSE" },
        { ticker: "PFE", name: "Pfizer Inc.", exchange: "NYSE" },
        { ticker: "ABBV", name: "AbbVie Inc.", exchange: "NYSE" },
        { ticker: "TMO", name: "Thermo Fisher Scientific Inc.", exchange: "NYSE" },
        { ticker: "ABT", name: "Abbott Laboratories", exchange: "NYSE" },
        { ticker: "DHR", name: "Danaher Corporation", exchange: "NYSE" },
        { ticker: "MRK", name: "Merck & Co. Inc.", exchange: "NYSE" },
        { ticker: "LLY", name: "Eli Lilly and Company", exchange: "NYSE" },
        { ticker: "BMY", name: "Bristol-Myers Squibb Company", exchange: "NYSE" },
        { ticker: "AMGN", name: "Amgen Inc.", exchange: "NASDAQ" },
        { ticker: "GILD", name: "Gilead Sciences Inc.", exchange: "NASDAQ" },
        { ticker: "REGN", name: "Regeneron Pharmaceuticals Inc.", exchange: "NASDAQ" },
        { ticker: "VRTX", name: "Vertex Pharmaceuticals Inc.", exchange: "NASDAQ" },
        { ticker: "BIIB", name: "Biogen Inc.", exchange: "NASDAQ" },
        { ticker: "ISRG", name: "Intuitive Surgical Inc.", exchange: "NASDAQ" },
        { ticker: "ILMN", name: "Illumina Inc.", exchange: "NASDAQ" },
        { ticker: "MRNA", name: "Moderna Inc.", exchange: "NASDAQ" },
        
        // Consumer Goods
        { ticker: "WMT", name: "Walmart Inc.", exchange: "NYSE" },
        { ticker: "PG", name: "Procter & Gamble Co.", exchange: "NYSE" },
        { ticker: "KO", name: "The Coca-Cola Company", exchange: "NYSE" },
        { ticker: "PEP", name: "PepsiCo Inc.", exchange: "NASDAQ" },
        { ticker: "COST", name: "Costco Wholesale Corporation", exchange: "NASDAQ" },
        { ticker: "NKE", name: "Nike Inc.", exchange: "NYSE" },
        { ticker: "MCD", name: "McDonald's Corporation", exchange: "NYSE" },
        { ticker: "SBUX", name: "Starbucks Corporation", exchange: "NASDAQ" },
        { ticker: "TGT", name: "Target Corporation", exchange: "NYSE" },
        { ticker: "HD", name: "The Home Depot Inc.", exchange: "NYSE" },
        { ticker: "LOW", name: "Lowe's Companies Inc.", exchange: "NYSE" },
        { ticker: "DIS", name: "The Walt Disney Company", exchange: "NYSE" },
        { ticker: "CMCSA", name: "Comcast Corporation", exchange: "NASDAQ" },
        
        // Aerospace & Defense
        { ticker: "BA", name: "The Boeing Company", exchange: "NYSE" },
        { ticker: "LMT", name: "Lockheed Martin Corporation", exchange: "NYSE" },
        { ticker: "RTX", name: "RTX Corporation", exchange: "NYSE" },
        { ticker: "GD", name: "General Dynamics Corporation", exchange: "NYSE" },
        { ticker: "NOC", name: "Northrop Grumman Corporation", exchange: "NYSE" },
        
        // Energy
        { ticker: "XOM", name: "Exxon Mobil Corporation", exchange: "NYSE" },
        { ticker: "CVX", name: "Chevron Corporation", exchange: "NYSE" },
        { ticker: "COP", name: "ConocoPhillips", exchange: "NYSE" },
        { ticker: "SLB", name: "Schlumberger Limited", exchange: "NYSE" },
        { ticker: "OXY", name: "Occidental Petroleum Corporation", exchange: "NYSE" },
        
        // Industrial
        { ticker: "CAT", name: "Caterpillar Inc.", exchange: "NYSE" },
        { ticker: "DE", name: "Deere & Company", exchange: "NYSE" },
        { ticker: "GE", name: "General Electric Company", exchange: "NYSE" },
        { ticker: "HON", name: "Honeywell International Inc.", exchange: "NASDAQ" },
        { ticker: "MMM", name: "3M Company", exchange: "NYSE" },
        { ticker: "UPS", name: "United Parcel Service Inc.", exchange: "NYSE" },
        { ticker: "FDX", name: "FedEx Corporation", exchange: "NYSE" }
      ],
      "Europe": [
        { ticker: "RACE", name: "Ferrari N.V.", exchange: "NYSE (Italy)" },
        { ticker: "ASML", name: "ASML Holding N.V.", exchange: "NASDAQ (Netherlands)" },
        { ticker: "SAP", name: "SAP SE", exchange: "NYSE (Germany)" },
        { ticker: "NVO", name: "Novo Nordisk A/S", exchange: "NYSE (Denmark)" },
        { ticker: "OR.PA", name: "L'Or√©al S.A.", exchange: "Euronext Paris" },
        { ticker: "MC.PA", name: "LVMH Mo√´t Hennessy Louis Vuitton", exchange: "Euronext Paris" },
        { ticker: "SAN.PA", name: "Sanofi S.A.", exchange: "Euronext Paris" },
        { ticker: "AIR.PA", name: "Airbus SE", exchange: "Euronext Paris" },
        { ticker: "SIE.DE", name: "Siemens AG", exchange: "XETRA (Germany)" },
        { ticker: "VOW3.DE", name: "Volkswagen AG", exchange: "XETRA (Germany)" },
        { ticker: "NESN.SW", name: "Nestl√© S.A.", exchange: "SIX Swiss Exchange" },
        { ticker: "NOVN.SW", name: "Novartis AG", exchange: "SIX Swiss Exchange" },
        { ticker: "ROG.SW", name: "Roche Holding AG", exchange: "SIX Swiss Exchange" },
        { ticker: "AZN", name: "AstraZeneca PLC", exchange: "NASDAQ (UK)" },
        { ticker: "HSBC", name: "HSBC Holdings plc", exchange: "NYSE (UK)" },
        { ticker: "BP", name: "BP p.l.c.", exchange: "NYSE (UK)" },
        { ticker: "SHEL", name: "Shell plc", exchange: "NYSE (UK/Netherlands)" },
        { ticker: "UL", name: "Unilever PLC", exchange: "NYSE (UK/Netherlands)" },
        { ticker: "BHP", name: "BHP Group Limited", exchange: "NYSE (UK/Australia)" },
        { ticker: "IBE.MC", name: "Iberdrola S.A.", exchange: "Madrid (Spain)" }
      ],
      "China": [
        // E-commerce & Tech Giants
        { ticker: "BABA", name: "Alibaba Group Holding Limited", exchange: "NYSE" },
        { ticker: "9988.HK", name: "Alibaba Group (Hong Kong)", exchange: "Hong Kong" },
        { ticker: "JD", name: "JD.com Inc.", exchange: "NASDAQ" },
        { ticker: "9618.HK", name: "JD.com (Hong Kong)", exchange: "Hong Kong" },
        { ticker: "PDD", name: "PDD Holdings Inc. (Pinduoduo)", exchange: "NASDAQ" },
        { ticker: "BEKE", name: "KE Holdings Inc. (Beike)", exchange: "NYSE" },
        { ticker: "VIPS", name: "Vipshop Holdings Limited", exchange: "NYSE" },
        
        // Search & AI
        { ticker: "BIDU", name: "Baidu Inc.", exchange: "NASDAQ" },
        { ticker: "9888.HK", name: "Baidu (Hong Kong)", exchange: "Hong Kong" },
        
        // Social & Entertainment
        { ticker: "0700.HK", name: "Tencent Holdings Limited", exchange: "Hong Kong" },
        { ticker: "NTES", name: "NetEase Inc.", exchange: "NASDAQ" },
        { ticker: "9999.HK", name: "NetEase (Hong Kong)", exchange: "Hong Kong" },
        { ticker: "TME", name: "Tencent Music Entertainment Group", exchange: "NYSE" },
        { ticker: "BILI", name: "Bilibili Inc.", exchange: "NASDAQ" },
        { ticker: "9626.HK", name: "Bilibili (Hong Kong)", exchange: "Hong Kong" },
        { ticker: "IQ", name: "iQIYI Inc.", exchange: "NASDAQ" },
        { ticker: "HUYA", name: "HUYA Inc.", exchange: "NYSE" },
        { ticker: "DOYU", name: "DouYu International Holdings Limited", exchange: "NASDAQ" },
        { ticker: "YY", name: "JOYY Inc.", exchange: "NASDAQ" },
        { ticker: "MOMO", name: "Hello Group Inc.", exchange: "NASDAQ" },
        
        // Electric Vehicles
        { ticker: "NIO", name: "NIO Inc.", exchange: "NYSE" },
        { ticker: "9866.HK", name: "NIO (Hong Kong)", exchange: "Hong Kong" },
        { ticker: "XPEV", name: "XPeng Inc.", exchange: "NYSE" },
        { ticker: "9868.HK", name: "XPeng (Hong Kong)", exchange: "Hong Kong" },
        { ticker: "LI", name: "Li Auto Inc.", exchange: "NASDAQ" },
        { ticker: "2015.HK", name: "Li Auto (Hong Kong)", exchange: "Hong Kong" },
        { ticker: "1211.HK", name: "BYD Company Limited", exchange: "Hong Kong" },
        { ticker: "BYDDY", name: "BYD Company Limited ADR", exchange: "OTC" },
        
        // Technology & Hardware
        { ticker: "1810.HK", name: "Xiaomi Corporation", exchange: "Hong Kong" },
        { ticker: "0981.HK", name: "Semiconductor Manufacturing International", exchange: "Hong Kong" },
        { ticker: "3690.HK", name: "Meituan", exchange: "Hong Kong" },
        { ticker: "0992.HK", name: "Lenovo Group Limited", exchange: "Hong Kong" },
        
        // Telecom
        { ticker: "0941.HK", name: "China Mobile Limited", exchange: "Hong Kong" },
        { ticker: "CHL", name: "China Mobile Limited ADR", exchange: "NYSE" },
        { ticker: "0762.HK", name: "China Unicom (Hong Kong) Limited", exchange: "Hong Kong" },
        { ticker: "CHU", name: "China Unicom ADR", exchange: "NYSE" },
        { ticker: "0728.HK", name: "China Telecom Corporation Limited", exchange: "Hong Kong" },
        { ticker: "CHA", name: "China Telecom ADR", exchange: "NYSE" },
        
        // Banking & Finance
        { ticker: "1398.HK", name: "Industrial and Commercial Bank of China", exchange: "Hong Kong" },
        { ticker: "0939.HK", name: "China Construction Bank", exchange: "Hong Kong" },
        { ticker: "3988.HK", name: "Bank of China Limited", exchange: "Hong Kong" },
        { ticker: "0998.HK", name: "China CITIC Bank Corporation Limited", exchange: "Hong Kong" },
        { ticker: "2318.HK", name: "Ping An Insurance", exchange: "Hong Kong" },
        { ticker: "2628.HK", name: "China Life Insurance Company Limited", exchange: "Hong Kong" },
        { ticker: "6178.HK", name: "China Pacific Insurance", exchange: "Hong Kong" },
        
        // Transportation & Logistics
        { ticker: "DIDI", name: "DiDi Global Inc.", exchange: "NYSE" },
        { ticker: "0175.HK", name: "Geely Automobile Holdings Limited", exchange: "Hong Kong" },
        { ticker: "2333.HK", name: "Great Wall Motor Company Limited", exchange: "Hong Kong" },
        { ticker: "ZTO", name: "ZTO Express (Cayman) Inc.", exchange: "NYSE" },
        { ticker: "BEST", name: "BEST Inc.", exchange: "NYSE" },
        
        // Real Estate & Construction
        { ticker: "3333.HK", name: "China Evergrande Group", exchange: "Hong Kong" },
        { ticker: "2007.HK", name: "Country Garden Holdings Company Limited", exchange: "Hong Kong" },
        
        // Consumer & Retail
        { ticker: "YUM", name: "Yum China Holdings Inc.", exchange: "NYSE" },
        { ticker: "9987.HK", name: "Yum China (Hong Kong)", exchange: "Hong Kong" },
        { ticker: "LU", name: "Lufax Holding Ltd", exchange: "NYSE" },
        
        // Education
        { ticker: "TAL", name: "TAL Education Group", exchange: "NYSE" },
        { ticker: "EDU", name: "New Oriental Education & Technology Group", exchange: "NYSE" },
        { ticker: "GOTU", name: "Gaotu Techedu Inc.", exchange: "NYSE" },
        
        // Energy & Resources
        { ticker: "0857.HK", name: "PetroChina Company Limited", exchange: "Hong Kong" },
        { ticker: "PTR", name: "PetroChina ADR", exchange: "NYSE" },
        { ticker: "0386.HK", name: "China Petroleum & Chemical Corporation", exchange: "Hong Kong" },
        { ticker: "SNP", name: "China Petroleum & Chemical ADR", exchange: "NYSE" },
        { ticker: "0883.HK", name: "CNOOC Limited", exchange: "Hong Kong" }
      ],
      "India": [
        // Banking & Finance
        { ticker: "HDFCBANK.NS", name: "HDFC Bank Limited", exchange: "NSE" },
        { ticker: "HDFCBANK.BO", name: "HDFC Bank Limited", exchange: "BSE" },
        { ticker: "HDB", name: "HDFC Bank Limited ADR", exchange: "NYSE" },
        { ticker: "ICICIBANK.NS", name: "ICICI Bank Limited", exchange: "NSE" },
        { ticker: "ICICIBANK.BO", name: "ICICI Bank Limited", exchange: "BSE" },
        { ticker: "IBN", name: "ICICI Bank Limited ADR", exchange: "NYSE" },
        { ticker: "SBIN.NS", name: "State Bank of India", exchange: "NSE" },
        { ticker: "SBIN.BO", name: "State Bank of India", exchange: "BSE" },
        { ticker: "KOTAKBANK.NS", name: "Kotak Mahindra Bank Limited", exchange: "NSE" },
        { ticker: "KOTAKBANK.BO", name: "Kotak Mahindra Bank Limited", exchange: "BSE" },
        { ticker: "AXISBANK.NS", name: "Axis Bank Limited", exchange: "NSE" },
        { ticker: "INDUSINDBK.NS", name: "IndusInd Bank Limited", exchange: "NSE" },
        { ticker: "BAJFINANCE.NS", name: "Bajaj Finance Limited", exchange: "NSE" },
        { ticker: "BAJFINSVV.NS", name: "Bajaj Finserv Limited", exchange: "NSE" },
        { ticker: "HDFCLIFE.NS", name: "HDFC Life Insurance Company Limited", exchange: "NSE" },
        { ticker: "SBILIFE.NS", name: "SBI Life Insurance Company Limited", exchange: "NSE" },
        
        // IT & Technology
        { ticker: "TCS.NS", name: "Tata Consultancy Services Limited", exchange: "NSE" },
        { ticker: "TCS.BO", name: "Tata Consultancy Services Limited", exchange: "BSE" },
        { ticker: "INFY", name: "Infosys Limited ADR", exchange: "NYSE" },
        { ticker: "INFY.NS", name: "Infosys Limited", exchange: "NSE" },
        { ticker: "WIT", name: "Wipro Limited ADR", exchange: "NYSE" },
        { ticker: "WIPRO.NS", name: "Wipro Limited", exchange: "NSE" },
        { ticker: "HCLTECH.NS", name: "HCL Technologies Limited", exchange: "NSE" },
        { ticker: "TECHM.NS", name: "Tech Mahindra Limited", exchange: "NSE" },
        { ticker: "LTI.NS", name: "LTI Mindtree Limited", exchange: "NSE" },
        { ticker: "MPHASIS.NS", name: "Mphasis Limited", exchange: "NSE" },
        { ticker: "COFORGE.NS", name: "Coforge Limited", exchange: "NSE" },
        { ticker: "PERSISTENT.NS", name: "Persistent Systems Limited", exchange: "NSE" },
        
        // Conglomerates
        { ticker: "RELIANCE.NS", name: "Reliance Industries Limited", exchange: "NSE" },
        { ticker: "RELIANCE.BO", name: "Reliance Industries Limited", exchange: "BSE" },
        { ticker: "ADANIENT.NS", name: "Adani Enterprises Limited", exchange: "NSE" },
        { ticker: "ADANIPORTS.NS", name: "Adani Ports and Special Economic Zone Limited", exchange: "NSE" },
        { ticker: "ADANIGREEN.NS", name: "Adani Green Energy Limited", exchange: "NSE" },
        { ticker: "TATAMOTORS.NS", name: "Tata Motors Limited", exchange: "NSE" },
        { ticker: "TTM", name: "Tata Motors Limited ADR", exchange: "NYSE" },
        { ticker: "TATAPOWER.NS", name: "Tata Power Company Limited", exchange: "NSE" },
        { ticker: "TATASTEEL.NS", name: "Tata Steel Limited", exchange: "NSE" },
        
        // Telecom
        { ticker: "BHARTIARTL.NS", name: "Bharti Airtel Limited", exchange: "NSE" },
        { ticker: "BHARTIARTL.BO", name: "Bharti Airtel Limited", exchange: "BSE" },
        { ticker: "RJIO.NS", name: "Reliance Jio Infocomm Limited", exchange: "NSE" },
        
        // Consumer Goods
        { ticker: "ITC.NS", name: "ITC Limited", exchange: "NSE" },
        { ticker: "ITC.BO", name: "ITC Limited", exchange: "BSE" },
        { ticker: "HINDUNILVR.NS", name: "Hindustan Unilever Limited", exchange: "NSE" },
        { ticker: "HINDUNILVR.BO", name: "Hindustan Unilever Limited", exchange: "BSE" },
        { ticker: "NESTLEIND.NS", name: "Nestl√© India Limited", exchange: "NSE" },
        { ticker: "BRITANNIA.NS", name: "Britannia Industries Limited", exchange: "NSE" },
        { ticker: "GODREJCP.NS", name: "Godrej Consumer Products Limited", exchange: "NSE" },
        { ticker: "DABUR.NS", name: "Dabur India Limited", exchange: "NSE" },
        { ticker: "MARICO.NS", name: "Marico Limited", exchange: "NSE" },
        
        // Auto
        { ticker: "MARUTI.NS", name: "Maruti Suzuki India Limited", exchange: "NSE" },
        { ticker: "MARUTI.BO", name: "Maruti Suzuki India Limited", exchange: "BSE" },
        { ticker: "M&M.NS", name: "Mahindra & Mahindra Limited", exchange: "NSE" },
        { ticker: "BAJAJ-AUTO.NS", name: "Bajaj Auto Limited", exchange: "NSE" },
        { ticker: "HEROMOTOCO.NS", name: "Hero MotoCorp Limited", exchange: "NSE" },
        { ticker: "EICHERMOT.NS", name: "Eicher Motors Limited", exchange: "NSE" },
        { ticker: "TVSMOTOR.NS", name: "TVS Motor Company Limited", exchange: "NSE" },
        
        // Pharma
        { ticker: "SUNPHARMA.NS", name: "Sun Pharmaceutical Industries Limited", exchange: "NSE" },
        { ticker: "DRREDDY.NS", name: "Dr. Reddy's Laboratories Limited", exchange: "NSE" },
        { ticker: "RDY", name: "Dr. Reddy's Laboratories Limited ADR", exchange: "NYSE" },
        { ticker: "CIPLA.NS", name: "Cipla Limited", exchange: "NSE" },
        { ticker: "DIVISLAB.NS", name: "Divi's Laboratories Limited", exchange: "NSE" },
        { ticker: "BIOCON.NS", name: "Biocon Limited", exchange: "NSE" },
        { ticker: "LUPIN.NS", name: "Lupin Limited", exchange: "NSE" },
        { ticker: "TORNTPHARM.NS", name: "Torrent Pharmaceuticals Limited", exchange: "NSE" },
        
        // Infrastructure & Construction
        { ticker: "LT.NS", name: "Larsen & Toubro Limited", exchange: "NSE" },
        { ticker: "LT.BO", name: "Larsen & Toubro Limited", exchange: "BSE" },
        { ticker: "ULTRACEMCO.NS", name: "UltraTech Cement Limited", exchange: "NSE" },
        { ticker: "GRASIM.NS", name: "Grasim Industries Limited", exchange: "NSE" },
        { ticker: "ADANIPOWER.NS", name: "Adani Power Limited", exchange: "NSE" },
        { ticker: "NTPC.NS", name: "NTPC Limited", exchange: "NSE" },
        { ticker: "POWERGRID.NS", name: "Power Grid Corporation of India Limited", exchange: "NSE" },
        
        // Paints & Materials
        { ticker: "ASIANPAINT.NS", name: "Asian Paints Limited", exchange: "NSE" },
        { ticker: "ASIANPAINT.BO", name: "Asian Paints Limited", exchange: "BSE" },
        { ticker: "BERGEPAINT.NS", name: "Berger Paints India Limited", exchange: "NSE" },
        { ticker: "PIDILITIND.NS", name: "Pidilite Industries Limited", exchange: "NSE" },
        
        // Retail & E-commerce
        { ticker: "DMART.NS", name: "Avenue Supermarts Limited (DMart)", exchange: "NSE" },
        { ticker: "TATACONSUM.NS", name: "Tata Consumer Products Limited", exchange: "NSE" },
        
        // Energy & Oil
        { ticker: "ONGC.NS", name: "Oil and Natural Gas Corporation Limited", exchange: "NSE" },
        { ticker: "BPCL.NS", name: "Bharat Petroleum Corporation Limited", exchange: "NSE" },
        { ticker: "IOC.NS", name: "Indian Oil Corporation Limited", exchange: "NSE" },
        { ticker: "COALINDIA.NS", name: "Coal India Limited", exchange: "NSE" }
      ],
      "Japan": [
        { ticker: "7203.T", name: "Toyota Motor Corporation", exchange: "Tokyo" },
        { ticker: "6758.T", name: "Sony Group Corporation", exchange: "Tokyo" },
        { ticker: "9984.T", name: "SoftBank Group Corp.", exchange: "Tokyo" },
        { ticker: "6861.T", name: "Keyence Corporation", exchange: "Tokyo" },
        { ticker: "7974.T", name: "Nintendo Co., Ltd.", exchange: "Tokyo" },
        { ticker: "SONY", name: "Sony Group Corporation", exchange: "NYSE (ADR)" },
        { ticker: "TM", name: "Toyota Motor Corporation", exchange: "NYSE (ADR)" },
        { ticker: "MUFG", name: "Mitsubishi UFJ Financial Group", exchange: "NYSE (ADR)" },
        { ticker: "SMFG", name: "Sumitomo Mitsui Financial Group", exchange: "NYSE (ADR)" }
      ],
      "South Korea": [
        { ticker: "005930.KS", name: "Samsung Electronics Co., Ltd.", exchange: "KOSPI" },
        { ticker: "035420.KS", name: "NAVER Corporation", exchange: "KOSPI" },
        { ticker: "035720.KS", name: "Kakao Corporation", exchange: "KOSPI" },
        { ticker: "051910.KS", name: "LG Chem Ltd.", exchange: "KOSPI" },
        { ticker: "006400.KS", name: "Samsung SDI Co., Ltd.", exchange: "KOSPI" },
        { ticker: "207940.KS", name: "Samsung Biologics Co., Ltd.", exchange: "KOSPI" }
      ],
      "Canada": [
        { ticker: "SHOP", name: "Shopify Inc.", exchange: "NYSE" },
        { ticker: "TD", name: "The Toronto-Dominion Bank", exchange: "NYSE" },
        { ticker: "RY", name: "Royal Bank of Canada", exchange: "NYSE" },
        { ticker: "ENB", name: "Enbridge Inc.", exchange: "NYSE" },
        { ticker: "CNQ", name: "Canadian Natural Resources Limited", exchange: "NYSE" },
        { ticker: "BMO", name: "Bank of Montreal", exchange: "NYSE" }
      ],
      "Australia": [
        { ticker: "BHP", name: "BHP Group Limited", exchange: "NYSE (ADR)" },
        { ticker: "CBA.AX", name: "Commonwealth Bank of Australia", exchange: "ASX" },
        { ticker: "CSL.AX", name: "CSL Limited", exchange: "ASX" },
        { ticker: "NAB.AX", name: "National Australia Bank", exchange: "ASX" },
        { ticker: "WBC.AX", name: "Westpac Banking Corporation", exchange: "ASX" }
      ],
      "Brazil": [
        { ticker: "VALE", name: "Vale S.A.", exchange: "NYSE" },
        { ticker: "VALE3.SA", name: "Vale S.A.", exchange: "B3" },
        { ticker: "PBR", name: "Petr√≥leo Brasileiro S.A. - Petrobras", exchange: "NYSE" },
        { ticker: "PETR4.SA", name: "Petrobras", exchange: "B3" },
        { ticker: "ITUB", name: "Ita√∫ Unibanco Holding S.A.", exchange: "NYSE" },
        { ticker: "ITUB4.SA", name: "Ita√∫ Unibanco", exchange: "B3" },
        { ticker: "NU", name: "Nu Holdings Ltd. (Nubank)", exchange: "NYSE" },
        { ticker: "BBD", name: "Banco Bradesco S.A.", exchange: "NYSE" },
        { ticker: "BBDC4.SA", name: "Banco Bradesco", exchange: "B3" },
        { ticker: "ABEV", name: "Ambev S.A.", exchange: "NYSE" },
        { ticker: "ABEV3.SA", name: "Ambev", exchange: "B3" },
        { ticker: "SBS", name: "Companhia de Saneamento B√°sico do Estado de S√£o Paulo", exchange: "NYSE" },
        { ticker: "SBSP3.SA", name: "Sabesp", exchange: "B3" },
        { ticker: "EBR", name: "Centrais El√©tricas Brasileiras S.A. - Eletrobras", exchange: "NYSE" },
        { ticker: "ELET3.SA", name: "Eletrobras", exchange: "B3" },
        { ticker: "BSBR", name: "Banco Santander (Brasil) S.A.", exchange: "NYSE" },
        { ticker: "PAGS", name: "PagSeguro Digital Ltd.", exchange: "NYSE" },
        { ticker: "STNE", name: "StoneCo Ltd.", exchange: "NASDAQ" },
        { ticker: "MGLU3.SA", name: "Magazine Luiza S.A.", exchange: "B3" },
        { ticker: "WEGE3.SA", name: "WEG S.A.", exchange: "B3" },
        { ticker: "RENT3.SA", name: "Localiza Rent a Car S.A.", exchange: "B3" },
        { ticker: "B3SA3.SA", name: "B3 S.A. - Brasil, Bolsa, Balc√£o", exchange: "B3" },
        { ticker: "BBAS3.SA", name: "Banco do Brasil S.A.", exchange: "B3" },
        { ticker: "SUZB3.SA", name: "Suzano S.A.", exchange: "B3" }
      ],
      "Mexico": [
        { ticker: "AMXL", name: "Am√©rica M√≥vil, S.A.B. de C.V.", exchange: "NYSE" },
        { ticker: "AMX", name: "Am√©rica M√≥vil ADR", exchange: "NYSE" },
        { ticker: "AMXL.MX", name: "Am√©rica M√≥vil", exchange: "BMV" },
        { ticker: "TV", name: "Grupo Televisa, S.A.B.", exchange: "NYSE" },
        { ticker: "FMX", name: "Fomento Econ√≥mico Mexicano, S.A.B. de C.V.", exchange: "NYSE" },
        { ticker: "FEMSAUBD.MX", name: "FEMSA", exchange: "BMV" },
        { ticker: "CEMEXCPO.MX", name: "CEMEX, S.A.B. de C.V.", exchange: "BMV" },
        { ticker: "CX", name: "CEMEX ADR", exchange: "NYSE" },
        { ticker: "GFNORTEO.MX", name: "Grupo Financiero Banorte", exchange: "BMV" },
        { ticker: "WALMEX.MX", name: "Wal-Mart de M√©xico", exchange: "BMV" },
        { ticker: "GMEXICOB.MX", name: "Grupo M√©xico", exchange: "BMV" },
        { ticker: "ALFAA.MX", name: "Alfa, S.A.B. de C.V.", exchange: "BMV" },
        { ticker: "BIMBOA.MX", name: "Grupo Bimbo", exchange: "BMV" }
      ],
      "Chile": [
        { ticker: "SQM", name: "Sociedad Qu√≠mica y Minera de Chile S.A.", exchange: "NYSE" },
        { ticker: "LTM", name: "Latam Airlines Group S.A.", exchange: "NYSE" },
        { ticker: "ENIA", name: "Enel Americas S.A.", exchange: "NYSE" }
      ],
      "Colombia": [
        { ticker: "EC", name: "Ecopetrol S.A.", exchange: "NYSE" }
      ],
      "Latin America Regional": [
        { ticker: "MELI", name: "MercadoLibre Inc.", exchange: "NASDAQ" },
        { ticker: "GLOB", name: "Globant S.A.", exchange: "NYSE" },
        { ticker: "DESP", name: "Despegar.com Corp.", exchange: "NYSE" }
      ],
      "Taiwan": [
        { ticker: "TSM", name: "Taiwan Semiconductor Manufacturing Company", exchange: "NYSE" },
        { ticker: "2330.TW", name: "Taiwan Semiconductor Manufacturing", exchange: "TWSE" }
      ],
      "Singapore": [
        { ticker: "SE", name: "Sea Limited (Shopee, Garena)", exchange: "NYSE" },
        { ticker: "GRAB", name: "Grab Holdings Limited", exchange: "NASDAQ" }
      ],
      "Saudi Arabia": [
        { ticker: "2222.SR", name: "Saudi Aramco", exchange: "Tadawul" }
      ],
      "Argentina": [
        { ticker: "YPF", name: "YPF Sociedad An√≥nima", exchange: "NYSE" },
        { ticker: "BMA", name: "Banco Macro S.A.", exchange: "NYSE" },
        { ticker: "TEO", name: "Telecom Argentina S.A.", exchange: "NYSE" },
        { ticker: "GGAL", name: "Grupo Financiero Galicia S.A.", exchange: "NASDAQ" },
        { ticker: "CRESY", name: "Cresud S.A.C.I.F.A.", exchange: "NASDAQ" },
        { ticker: "IRS", name: "IRSA Inversiones y Representaciones S.A.", exchange: "NYSE" },
        { ticker: "LOMA", name: "Loma Negra Compa√±√≠a Industrial Argentina", exchange: "NYSE" },
        { ticker: "PAM", name: "Pampa Energ√≠a S.A.", exchange: "NYSE" }
      ],
      "Latin America Regional": [
        { ticker: "MELI", name: "MercadoLibre Inc.", exchange: "NASDAQ" },
        { ticker: "GLOB", name: "Globant S.A.", exchange: "NYSE" },
        { ticker: "DESP", name: "Despegar.com Corp.", exchange: "NYSE" }
      ]
    };

    // Flatten all stocks for searching
    let allStocks = [];
    Object.keys(globalStocks).forEach(region => {
      globalStocks[region].forEach(stock => {
        allStocks.push({ ...stock, region });
      });
    });

    let selectedIndex = -1;
    let filteredResults = [];

    // Flashcard Concepts Database - EXPANDED
    const flashcardConcepts = [
      // Core Metrics
      {
        id: 'roe',
        concept: 'Return on Equity (ROE)',
        definition: "Measures how efficiently a company uses shareholders' equity to generate profits",
        formula: 'ROE = Net Income √∑ Shareholders\' Equity',
        example: 'üí° A company with $100M equity earning $20M profit has 20% ROE',
        category: 'Profitability Metrics'
      },
      {
        id: 'roic',
        concept: 'Return on Invested Capital (ROIC)',
        definition: 'Shows how well a company generates cash flow relative to capital invested',
        formula: 'ROIC = NOPAT √∑ Invested Capital',
        example: 'üí° Target: ROIC should exceed cost of capital (WACC)',
        category: 'Profitability Metrics'
      },
      
      // Valuation Metrics
      {
        id: 'pe',
        concept: 'Price-to-Earnings Ratio (P/E)',
        definition: 'Compares stock price to earnings per share',
        formula: 'P/E = Stock Price √∑ Earnings Per Share',
        example: 'üí° P/E of 20 means paying $20 for every $1 of earnings',
        category: 'Valuation Metrics'
      },
      {
        id: 'peg',
        concept: 'PEG Ratio',
        definition: 'P/E ratio adjusted for growth rate',
        formula: 'PEG = P/E √∑ Annual EPS Growth',
        example: 'üí° PEG < 1.0 may signal undervaluation',
        category: 'Valuation Metrics'
      },
      {
        id: 'ps',
        concept: 'Price-to-Sales (P/S) Ratio',
        definition: 'Compares market cap to total revenue',
        formula: 'P/S = Market Cap √∑ Annual Revenue',
        example: 'üí° Useful for unprofitable companies. P/S < 2 often considered reasonable',
        category: 'Valuation Metrics'
      },
      {
        id: 'pb',
        concept: 'Price-to-Book (P/B) Ratio',
        definition: 'Compares stock price to book value per share',
        formula: 'P/B = Stock Price √∑ Book Value Per Share',
        example: 'üí° P/B < 1 means trading below liquidation value',
        category: 'Valuation Metrics'
      },
      
      // Cash Flow Concepts (NEW!)
      {
        id: 'fcf',
        concept: 'Free Cash Flow (FCF)',
        definition: 'Cash generated after paying for operations and capital expenditures',
        formula: 'FCF = Operating Cash Flow - CapEx',
        example: 'üí° Strong FCF enables dividends, buybacks, and growth investments',
        category: 'Cash Flow'
      },
      {
        id: 'ocf',
        concept: 'Operating Cash Flow (OCF)',
        definition: 'Cash generated from core business operations',
        formula: 'OCF = Net Income + Non-Cash Expenses - Working Capital Changes',
        example: 'üí° Apple generated $110B OCF in 2024 - shows business health',
        category: 'Cash Flow'
      },
      {
        id: 'cashvsincome',
        concept: 'Cash Flow vs Net Income',
        definition: 'Net income can be "paper profit" while cash flow shows real money',
        formula: 'Real Profit = Check if OCF > Net Income',
        example: 'üí° Company shows $10M profit but -$5M cash flow? Red flag!',
        category: 'Cash Flow'
      },
      {
        id: 'fcfyield',
        concept: 'Free Cash Flow Yield',
        definition: 'FCF as percentage of market cap - shows cash return',
        formula: 'FCF Yield = (FCF √∑ Market Cap) √ó 100',
        example: 'üí° 5%+ FCF yield is strong. Better than dividend yield for growth',
        category: 'Cash Flow'
      },
      {
        id: 'fcfconversion',
        concept: 'FCF Conversion Rate',
        definition: 'How much net income converts to free cash flow',
        formula: 'FCF Conversion = (FCF √∑ Net Income) √ó 100',
        example: 'üí° >100% is excellent. <70% may indicate accounting issues',
        category: 'Cash Flow'
      },
      
      // Profitability Metrics (EXPANDED)
      {
        id: 'grossmargin',
        concept: 'Gross Margin',
        definition: 'Revenue remaining after cost of goods sold',
        formula: 'Gross Margin = (Revenue - COGS) √∑ Revenue',
        example: 'üí° >60% margin shows strong pricing power (e.g., software)',
        category: 'Profitability Metrics'
      },
      {
        id: 'operatingmargin',
        concept: 'Operating Margin',
        definition: 'Profit from core operations before interest and taxes',
        formula: 'Operating Margin = Operating Income √∑ Revenue',
        example: 'üí° Apple: 30% = For every $100 revenue, $30 operating profit',
        category: 'Profitability Metrics'
      },
      {
        id: 'netmargin',
        concept: 'Net Profit Margin',
        definition: 'Bottom-line profit as percentage of revenue',
        formula: 'Net Margin = Net Income √∑ Revenue',
        example: 'üí° >20% is excellent. Most companies: 5-15%',
        category: 'Profitability Metrics'
      },
      {
        id: 'eps',
        concept: 'Earnings Per Share (EPS)',
        definition: 'Company profit divided by shares outstanding',
        formula: 'EPS = Net Income √∑ Shares Outstanding',
        example: 'üí° Growing EPS = positive signal for stock price',
        category: 'Profitability Metrics'
      },
      {
        id: 'epsgrowth',
        concept: 'EPS Growth Rate',
        definition: 'Year-over-year earnings per share growth',
        formula: 'EPS Growth = ((Current EPS - Prior EPS) √∑ Prior EPS) √ó 100',
        example: 'üí° 15%+ annual EPS growth is strong for large companies',
        category: 'Profitability Metrics'
      },
      
      // Financial Health
      {
        id: 'debttoequity',
        concept: 'Debt-to-Equity Ratio',
        definition: 'Measures financial leverage relative to equity',
        formula: 'D/E = Total Debt √∑ Total Equity',
        example: 'üí° D/E < 1.0 = conservative, > 2.0 = aggressive',
        category: 'Financial Health'
      },
      {
        id: 'currentratio',
        concept: 'Current Ratio',
        definition: 'Ability to pay short-term obligations',
        formula: 'Current Ratio = Current Assets √∑ Current Liabilities',
        example: 'üí° >1.5 is healthy. <1.0 = liquidity concerns',
        category: 'Financial Health'
      },
      {
        id: 'quickratio',
        concept: 'Quick Ratio (Acid Test)',
        definition: 'Can company pay debts without selling inventory?',
        formula: 'Quick Ratio = (Current Assets - Inventory) √∑ Current Liabilities',
        example: 'üí° >1.0 is good. More conservative than current ratio',
        category: 'Financial Health'
      },
      {
        id: 'interestcoverage',
        concept: 'Interest Coverage Ratio',
        definition: 'How easily company can pay interest on debt',
        formula: 'Interest Coverage = EBIT √∑ Interest Expense',
        example: 'üí° >3x is safe. <1.5x = potential distress',
        category: 'Financial Health'
      },
      
      // Growth & Valuation
      {
        id: 'compounding',
        concept: 'Compound Interest',
        definition: 'Exponential growth from earning returns on your returns',
        formula: 'Future Value = P √ó (1 + r)‚Åø',
        example: 'üí° $10K at 10% for 30 years ‚Üí $174K',
        category: 'Core Concepts'
      },
      {
        id: 'dcf',
        concept: 'Discounted Cash Flow (DCF)',
        definition: 'Valuation method using present value of future cash flows',
        formula: 'PV = Œ£ FCF/(1+r)‚Åø + Terminal Value',
        example: 'üí° Principle: $1 today > $1 tomorrow',
        category: 'Valuation Methods'
      },
      {
        id: 'wacc',
        concept: 'Weighted Average Cost of Capital (WACC)',
        definition: 'Average rate company pays to finance assets',
        formula: 'WACC = (E/V √ó Re) + (D/V √ó Rd √ó (1-Tc))',
        example: 'üí° Used as discount rate in DCF. Typical: 8-12%',
        category: 'Valuation Methods'
      },
      {
        id: 'tam',
        concept: 'Total Addressable Market (TAM)',
        definition: 'Maximum revenue opportunity for a product/service',
        formula: 'TAM = Total Customers √ó Avg Revenue Per Customer',
        example: 'üí° Low penetration = high growth potential',
        category: 'Growth Metrics'
      },
      {
        id: 'cagr',
        concept: 'Compound Annual Growth Rate (CAGR)',
        definition: 'Average annual growth rate over time',
        formula: 'CAGR = ((Ending Value √∑ Beginning Value)^(1/years)) - 1',
        example: 'üí° $100 to $200 in 5 years = 15% CAGR',
        category: 'Growth Metrics'
      },
      {
        id: 'revenuerun',
        concept: 'Revenue Run Rate',
        definition: 'Annualized revenue based on current period',
        formula: 'Run Rate = Current Period Revenue √ó Periods in Year',
        example: 'üí° Q1 revenue $25M ‚Üí $100M annual run rate',
        category: 'Growth Metrics'
      },
      
      // Market Concepts
      {
        id: 'marketcap',
        concept: 'Market Capitalization',
        definition: 'Total market value of outstanding shares',
        formula: 'Market Cap = Stock Price √ó Shares Outstanding',
        example: 'üí° Large: >$10B, Mid: $2-10B, Small: <$2B',
        category: 'Core Concepts'
      },
      {
        id: 'enterprisevalue',
        concept: 'Enterprise Value (EV)',
        definition: 'Total value of company including debt',
        formula: 'EV = Market Cap + Debt - Cash',
        example: 'üí° True takeover cost. Used in EV/EBITDA ratio',
        category: 'Valuation Metrics'
      },
      {
        id: 'floatshares',
        concept: 'Float Shares',
        definition: 'Shares available for public trading',
        formula: 'Float = Total Shares - (Restricted + Insider Shares)',
        example: 'üí° Low float + high demand = volatile price movement',
        category: 'Market Structure'
      },
      
      // Income & Dividends
      {
        id: 'dividend',
        concept: 'Dividend Yield',
        definition: 'Annual dividend as % of stock price',
        formula: 'Yield = (Annual Dividend √∑ Stock Price) √ó 100',
        example: 'üí° 3-5% yield attracts income investors',
        category: 'Income Investing'
      },
      {
        id: 'payoutratio',
        concept: 'Dividend Payout Ratio',
        definition: 'Percentage of earnings paid as dividends',
        formula: 'Payout Ratio = (Dividends √∑ Net Income) √ó 100',
        example: 'üí° 40-60% is sustainable. >100% unsustainable',
        category: 'Income Investing'
      },
      {
        id: 'dividendgrowth',
        concept: 'Dividend Growth Rate',
        definition: 'Annual increase in dividend payments',
        formula: 'Growth = ((New Dividend - Old Dividend) √∑ Old Dividend) √ó 100',
        example: 'üí° Dividend Aristocrats: 25+ years of increases',
        category: 'Income Investing'
      },
      
      // Risk Metrics
      {
        id: 'beta',
        concept: 'Beta (Œ≤)',
        definition: 'Stock volatility relative to market',
        formula: 'Œ≤ = Cov(Stock,Market) √∑ Var(Market)',
        example: 'üí° Œ≤=1: matches market, >1: more volatile, <1: less volatile',
        category: 'Risk Metrics'
      },
      {
        id: 'sharpe',
        concept: 'Sharpe Ratio',
        definition: 'Risk-adjusted return measurement',
        formula: 'Sharpe = (Return - Risk-Free Rate) √∑ Std Deviation',
        example: 'üí° >1 is good, >2 is excellent, >3 is exceptional',
        category: 'Risk Metrics'
      },
      {
        id: 'maxdrawdown',
        concept: 'Maximum Drawdown',
        definition: 'Largest peak-to-trough decline',
        formula: 'Max DD = (Trough Value - Peak Value) √∑ Peak Value',
        example: 'üí° Measures worst-case scenario. TSLA: 70% drawdown in 2022',
        category: 'Risk Metrics'
      },
      
      // Investment Vehicles
      {
        id: 'etf',
        concept: 'Exchange-Traded Fund (ETF)',
        definition: 'Fund that trades on exchanges, holds basket of stocks',
        formula: 'Instant Diversification',
        example: 'üí° S&P 500 ETF (SPY) owns all 500 companies',
        category: 'Investment Vehicles'
      },
      {
        id: 'mutualfund',
        concept: 'Mutual Fund',
        definition: 'Professionally managed pool of investments',
        formula: 'NAV = (Assets - Liabilities) √∑ Shares',
        example: 'üí° Trades once daily at NAV. Higher fees than ETFs',
        category: 'Investment Vehicles'
      },
      {
        id: 'indexfund',
        concept: 'Index Fund',
        definition: 'Fund that tracks a market index',
        formula: 'Low Cost + Diversification',
        example: 'üí° VTSAX tracks entire US stock market. 0.04% expense ratio',
        category: 'Investment Vehicles'
      },
      
      // Advanced Concepts
      {
        id: 'moat',
        concept: 'Economic Moat',
        definition: 'Sustainable competitive advantage protecting profits',
        formula: 'Types: Brand, Network Effects, Cost Advantage, Switching Costs',
        example: 'üí° Apple: Brand + ecosystem switching costs = wide moat',
        category: 'Qualitative Analysis'
      },
      {
        id: 'buyback',
        concept: 'Share Buyback',
        definition: 'Company repurchases its own shares',
        formula: 'Buyback Yield = (Shares Repurchased √ó Price) √∑ Market Cap',
        example: 'üí° Reduces share count, increases EPS. Apple: $90B/year',
        category: 'Capital Allocation'
      },
      {
        id: 'dilution',
        concept: 'Share Dilution',
        definition: 'Decrease in ownership % from new shares issued',
        formula: 'New Ownership = Old Shares √∑ (Old + New Shares)',
        example: 'üí° Stock-based compensation dilutes shareholders ~3%/year for tech',
        category: 'Capital Structure'
      }
    ];

    let currentFlashcard = flashcardConcepts[0];
    let currentGradient = 1;
    let selectedModel = 'sonnet';
    let currentAnalysis = null;
    
    // OFFLINE TESTING MODE - Set to FALSE for real API calls
    const OFFLINE_MODE = false;
    
    // Mock analysis data for testing
    const mockAnalysisData = {
      'NIO': `## 1. EXECUTIVE SUMMARY

**Investment Recommendation:** HOLD

**Key Thesis:** NIO is a premium Chinese electric vehicle manufacturer with strong brand positioning in China's EV market. The company faces intense competition but has differentiated through battery swapping technology and premium positioning. Near-term headwinds from competition and margin pressure, but long-term growth potential remains if execution improves.

**Target Price:** $8.50 (12-month, representing ~25% upside from current levels)

## 2. COMPANY OVERVIEW

**Business Model:** NIO designs, manufactures, and sells premium smart electric SUVs and sedans in China. Key differentiators include:
- Battery-as-a-Service (BaaS) subscription model
- Proprietary battery swap technology with 2,000+ swap stations
- Premium positioning competing with Tesla, BYD, and traditional luxury brands

**Competitive Position:** #2 in China's premium EV segment (after Tesla), with ~2% market share of overall China EV market. Strong brand loyalty in tier-1 cities.

**Market Share:** Approximately 2.3% of China's EV market as of Q4 2024.

## 3. FINANCIAL METRICS

| Metric | Value |
|--------|-------|
| **Stock Price** | $6.80 |
| **Market Cap** | $11.2B |
| **P/E Ratio** | N/A (unprofitable) |
| **P/S Ratio** | 1.8x |
| **EV/Sales** | 2.1x |
| **Revenue (TTM)** | $6.2B |
| **Revenue Growth YoY** | +32% |
| **Gross Margin** | 9.5% |
| **Operating Margin** | -38% |
| **Net Margin** | -45% |
| **ROE** | -85% (negative due to losses) |
| **Debt-to-Equity** | 0.65 |
| **Current Ratio** | 0.85 |
| **Free Cash Flow** | -$1.8B (TTM) |
| **Cash Position** | $4.5B |

## 4. REVENUE ANALYSIS & PROJECTIONS

**Historical Trend (2021-2024):**
- 2021: $2.2B
- 2022: $3.8B (+73%)
- 2023: $4.7B (+24%)
- 2024: $6.2B (+32%)

**Key Revenue Drivers:**
1. Vehicle deliveries (targeting 250K units in 2025, +40% YoY)
2. BaaS subscription revenue growing 50%+ annually
3. Expansion beyond China (Middle East launch 2025)
4. New model launches (ET9 flagship sedan, lower-priced models)

**Projections (2025-2027):**
- 2025E: $8.7B (+40% growth)
- 2026E: $12.0B (+38% growth)  
- 2027E: $15.6B (+30% growth)
- Expected 3-year CAGR: 36%

## 5. PROFITABILITY & CASH FLOW

**Margin Analysis:**
- Gross margins improving from 5% (2023) to 9.5% (2024) as scale increases
- Target: 15% gross margin by 2026 at 500K annual deliveries
- Operating leverage kicking in, but still 3+ years from profitability

**Cash Flow:**
- Burning ~$450M per quarter
- Current cash runway: 2.5 years at current burn rate
- Will likely need additional capital raise in 2026

**Capital Allocation:**
- Heavy R&D spend (15% of revenue) on autonomous driving and battery tech
- Expanding production capacity and swap station network
- Limited returns to shareholders (no dividends, focus on growth)

## 6. MANAGEMENT QUALITY

**CEO William Li:** Solid track record of execution on delivery targets. Successfully navigated supply chain challenges in 2022-2023. However, company has missed profitability targets multiple times.

**Key Strengths:**
- Strong product innovation and brand building
- Excellent customer service scores in China
- Transparent communication with investors

**Concerns:**
- Continued cash burn despite scale increases
- Delayed autonomous driving rollout
- Execution challenges on international expansion

**Recent Commentary:** Management targeting profitability in H2 2026, focusing on operating efficiency while maintaining growth.

## 7. VALUATION ANALYSIS

**DCF Valuation:**
Assumptions:
- Terminal growth rate: 3%
- WACC: 12%
- FCF positive by 2027
- Fair Value: $7.50-9.50 per share

**Relative Valuation:**
- P/S: 1.8x vs peers at 2.5x (Li Auto), 3.2x (XPeng) - trading at discount
- EV/2025E Revenue: 1.5x vs peer average of 2.0x

**Assessment:** Stock appears **fairly valued to slightly undervalued** at current levels. Significant upside if execution improves, but downside risk if profitability timeline extends further.

## 8. TOTAL ADDRESSABLE MARKET (TAM)

**Current TAM:** China EV market ~$150B annually (2024), growing to $250B by 2027

**NIO's Penetration:** ~4% of premium segment, ~2% of total market

**Growth Projections:**
- China EV penetration increasing from 35% (2024) to 50%+ (2027)
- Premium segment growing faster than mass market
- International expansion adds $50B+ TAM opportunity

**TAM/Revenue Ratio:** Current revenue represents 4% of TAM - significant runway for growth if market share maintained.

## 9. GROWTH CATALYSTS & RISKS

**Catalysts:**
1. New model launches driving volume growth (3 new models in 2025)
2. Battery swap network reaching critical mass (4,000+ stations by 2026)
3. Autonomous driving technology commercialization
4. Market share gains in premium segment
5. International expansion success (Middle East, Europe)

**Risks:**
1. **Competition:** Intense price war with BYD, XPeng, Li Auto, Tesla
2. **Profitability:** Continued delays in reaching profitability
3. **Capital:** May need dilutive equity raise in 2026
4. **Regulatory:** China EV subsidy reduction
5. **Geopolitical:** US-China tensions affecting ADR listing
6. **Technology:** Autonomous driving delays vs competitors
7. **Demand:** China economic slowdown impacting premium segment

## 10. INVESTMENT THESIS

**Bull Case (Price Target: $12+):**
- Achieves 500K deliveries by 2026
- Gross margins reach 15%+ through scale
- BaaS becomes significant profit driver
- Successful international expansion
- Autonomous driving leadership position

**Base Case (Price Target: $8.50):**
- Steady execution on delivery growth (35-40% annually)
- Margins improve gradually to 12-13% by 2026
- Profitability reached by late 2026
- Market share maintained in China premium segment

**Bear Case (Price Target: $4.00):**
- Price war intensifies, margins compress further
- Profitability timeline extends to 2028+
- Forced capital raise at unfavorable terms
- Market share erosion from new competitors
- Demand headwinds in China

**Final Recommendation:** **HOLD** with cautious optimism. Stock appropriate for growth-oriented investors with high risk tolerance. Wait for clearer path to profitability before adding to positions. Consider accumulating on dips below $6.00. Set stop-loss below $5.00.

**Conviction Level:** Medium (6/10)`,
      
      'AAPL': `## 1. EXECUTIVE SUMMARY

**Investment Recommendation:** BUY

**Key Thesis:** Apple remains the world's most valuable technology company with an unmatched ecosystem of hardware, software, and services. While iPhone growth has matured, the services segment and emerging products (Vision Pro, AI features) provide new growth vectors. Premium valuation justified by best-in-class margins, capital returns, and competitive moat.

**Target Price:** $245 (12-month, representing ~25% upside)

## 2. COMPANY OVERVIEW

**Business Model:** Apple designs and manufactures premium consumer electronics (iPhone, Mac, iPad, Apple Watch, AirPods) and provides digital services (App Store, iCloud, Apple Music, Apple Pay, Apple TV+).

**Competitive Position:** Dominant player in premium smartphone segment with 55%+ market share in US, 20% globally. Unrivaled ecosystem creates high switching costs.

**Market Share:** 20% global smartphone share, 65% US tablet share, 25% smartwatch share.

## 3. FINANCIAL METRICS

| Metric | Value |
|--------|-------|
| **Stock Price** | $195.50 |
| **Market Cap** | $3.1T |
| **P/E Ratio** | 32.5x |
| **P/S Ratio** | 8.2x |
| **PEG Ratio** | 2.8x |
| **EV/EBITDA** | 24.5x |
| **Revenue (TTM)** | $385B |
| **Revenue Growth YoY** | +2.1% |
| **Gross Margin** | 45.5% |
| **Operating Margin** | 30.2% |
| **Net Margin** | 25.8% |
| **ROE** | 147% |
| **ROIC** | 52% |
| **Debt-to-Equity** | 1.8 |
| **Current Ratio** | 0.95 |
| **Free Cash Flow** | $99B |
| **FCF Yield** | 3.2% |
| **Dividend Yield** | 0.45% |

## 4. REVENUE ANALYSIS & PROJECTIONS

**Revenue Mix:**
- Products (iPhone 52%, Mac 8%, iPad 7%, Wearables 10%) = 77%
- Services (23%) = Fastest growing segment

**Historical Trend:**
- Strong double-digit growth 2020-2022
- Normalization in 2023-2024 (flat to low single digits)
- Services growing 15%+ annually offsetting hardware softness

**Projections (2025-2027):**
- 2025E: $405B (+5% growth from iPhone 16 cycle, AI features)
- 2026E: $430B (+6% growth from Vision Pro, services)
- 2027E: $465B (+8% growth from AI monetization)
- Expected 3-year CAGR: 6.5%

## 5. PROFITABILITY & CASH FLOW

**Margin Sustainability:** Industry-leading 45% gross margins driven by:
- Premium pricing power
- Vertical integration (Apple Silicon)
- Services mix shift (70% gross margins)

**Cash Generation:** Apple generates ~$100B free cash flow annually - highest in tech. 

**Capital Allocation:**
- $90B annual buybacks
- $15B dividends
- Minimal M&A
- Net cash position: $50B

## 6. MANAGEMENT QUALITY

**CEO Tim Cook:** Excellent operational track record. Successfully transitioned Apple to services-led growth and maintained premium brand despite competition.

**Capital Allocation:** Best-in-class with $650B returned to shareholders since 2012 through buybacks and dividends.

**Recent Focus:** AI integration across products, Vision Pro ecosystem development, health technology expansion.

## 7. VALUATION ANALYSIS

**DCF Fair Value:** $220-250 per share (assuming 6% revenue CAGR, stable margins)

**Relative Valuation:**
- Trading at 32x P/E vs 5-year average of 28x
- Premium justified by:
  - Highest quality tech business (ROE 147%, ROIC 52%)
  - Recession-resistant revenue base
  - $100B FCF generation

**Assessment:** **Fairly valued** at current levels. Premium warranted but limited multiple expansion room.

## 8. TOTAL ADDRESSABLE MARKET (TAM)

**Current TAM:** 
- Smartphones: $500B
- Services: $1.2T (cloud, streaming, payments, health)
- Wearables: $100B
- Computing: $400B

**Apple's Penetration:** ~5-20% across categories

**Growth Drivers:** Underpenetrated markets (India, Southeast Asia), services attachment rate increasing, new categories (AR/VR, automotive, health).

## 9. GROWTH CATALYSTS & RISKS

**Catalysts:**
1. iPhone 16 "super cycle" with AI features driving upgrades
2. Vision Pro adoption in enterprise
3. Services revenue growing 15%+ with advertising, health services
4. India market expansion (manufacturing + retail)
5. AI-powered features driving hardware replacement cycle

**Risks:**
1. **Regulatory:** EU forcing interoperability, App Store changes impacting fees
2. **China:** 20% of revenue at risk from geopolitics, Huawei competition
3. **Saturation:** iPhone replacement cycles lengthening
4. **Competition:** Android AI features, Huawei resurgence
5. **Services Growth:** Slowing user growth in mature markets

## 10. INVESTMENT THESIS

**Bull Case (Price Target: $280):**
- AI drives significant iPhone upgrade cycle
- Services grow 18%+ with new offerings
- Vision Pro becomes mainstream (5M+ units annually)
- India becomes 2nd largest market
- Multiple expands to 35x on AI enthusiasm

**Base Case (Price Target: $245):**
- Steady 5-7% revenue growth from services + modest hardware growth
- Margins stable at 45% gross, 30% operating
- $100B+ annual FCF supporting buybacks
- Valuation remains premium at 32-34x P/E

**Bear Case (Price Target: $160):**
- iPhone sales decline amid saturation
- Regulatory headwinds reduce services revenue
- China revenue drops 30% from competition/geopolitics
- Multiple compresses to 25x on growth concerns

**Final Recommendation:** **BUY** on any dips below $185. Core holding for quality growth portfolios. Best risk/reward in mega-cap tech given recession resilience, cash generation, and capital returns.

**Conviction Level:** High (8.5/10)`
    };

    function selectModel(model) {
      try {
        selectedModel = model;
        document.querySelectorAll('.model-option').forEach(opt => opt.classList.remove('selected'));
        document.getElementById(`model-${model}`).classList.add('selected');
      } catch (error) {
        console.error('Error selecting model:', error);
      }
    }

    function openFlashcardModal() {
      try {
        const modal = document.getElementById('flashcardModal');
        if (!modal) {
          console.error('Flashcard modal not found');
          return;
        }
        modal.classList.add('show');
        renderConceptLibrary();
        loadFlashcard(flashcardConcepts[0]);
      } catch (error) {
        console.error('Error opening flashcard modal:', error);
        alert('Error opening flashcard creator. Please refresh the page.');
      }
    }

    function closeFlashcardModal() {
      try {
        const modal = document.getElementById('flashcardModal');
        if (modal) {
          modal.classList.remove('show');
        }
      } catch (error) {
        console.error('Error closing modal:', error);
      }
    }

    function renderConceptLibrary() {
      try {
        const library = document.getElementById('conceptLibrary');
        if (!library) {
          console.error('Concept library element not found');
          return;
        }
        
        let html = '';
        flashcardConcepts.forEach(concept => {
          const active = concept.id === currentFlashcard.id ? 'active' : '';
          html += `
            <div class="concept-card ${active}" onclick="selectConcept('${concept.id}')">
              <h4>${concept.concept}</h4>
              <p>${concept.category}</p>
            </div>
          `;
        });
        
        library.innerHTML = html;
      } catch (error) {
        console.error('Error rendering concept library:', error);
      }
    }

    function selectConcept(id) {
      try {
        const concept = flashcardConcepts.find(c => c.id === id);
        if (concept) {
          loadFlashcard(concept);
        }
      } catch (error) {
        console.error('Error selecting concept:', error);
      }
    }

    function loadFlashcard(concept) {
      try {
        if (!concept) {
          console.error('Invalid concept');
          return;
        }
        
        currentFlashcard = concept;
        
        const elements = {
          concept: document.getElementById('previewConcept'),
          definition: document.getElementById('previewDefinition'),
          formula: document.getElementById('previewFormula'),
          example: document.getElementById('previewExample')
        };
        
        if (elements.concept) elements.concept.textContent = concept.concept;
        if (elements.definition) elements.definition.textContent = concept.definition;
        if (elements.formula) elements.formula.textContent = concept.formula;
        if (elements.example) elements.example.textContent = concept.example;
        
        renderConceptLibrary();
      } catch (error) {
        console.error('Error loading flashcard:', error);
      }
    }

    function selectGradient(num) {
      try {
        currentGradient = num;
        const canvas = document.getElementById('flashcardCanvas');
        if (!canvas) {
          console.error('Canvas element not found');
          return;
        }
        
        canvas.className = `flashcard-canvas gradient-${num}`;
        
        const options = document.querySelectorAll('.gradient-option');
        options.forEach(opt => opt.classList.remove('active'));
        if (options[num - 1]) {
          options[num - 1].classList.add('active');
        }
      } catch (error) {
        console.error('Error selecting gradient:', error);
      }
    }

    function updateTextSize(type, value) {
      try {
        const elementId = `preview${type.charAt(0).toUpperCase() + type.slice(1)}`;
        const element = document.getElementById(elementId);
        const valueElement = document.getElementById(`${type}SizeValue`);
        
        if (element) {
          element.style.fontSize = value + 'px';
        }
        if (valueElement) {
          valueElement.textContent = value;
        }
      } catch (error) {
        console.error('Error updating text size:', error);
      }
    }

    async function downloadFlashcard() {
      const canvas = document.getElementById('flashcardCanvas');
      
      // Check if html2canvas is loaded
      if (typeof html2canvas === 'undefined') {
        console.error('html2canvas library not loaded');
        alert('Image export library is loading. Please try again in a moment.');
        return;
      }
      
      try {
        // Show loading state
        const btn = event?.target;
        const originalText = btn?.innerHTML;
        if (btn) btn.innerHTML = '‚è≥ Generating...';
        
        const htmlCanvas = await html2canvas(canvas, {
          width: 1080,
          height: 1080,
          scale: 2,
          backgroundColor: null,
          logging: false,
          useCORS: true,
          allowTaint: true
        });
        
        const dataUrl = htmlCanvas.toDataURL('image/png');
        const link = document.createElement('a');
        link.download = `${currentFlashcard.id}-investiq-flashcard.png`;
        link.href = dataUrl;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        if (btn) btn.innerHTML = originalText;
      } catch (error) {
        console.error('Download error:', error);
        alert('Error generating image. Please try again or use a different browser.');
        if (event?.target) event.target.innerHTML = 'üíæ Download PNG';
      }
    }

    async function shareFlashcard() {
      const canvas = document.getElementById('flashcardCanvas');
      
      // Check if html2canvas is loaded
      if (typeof html2canvas === 'undefined') {
        console.error('html2canvas library not loaded');
        alert('Image export library is loading. Please try again in a moment.');
        return;
      }
      
      try {
        // Show loading state
        const btn = event?.target;
        const originalText = btn?.innerHTML;
        if (btn) btn.innerHTML = '‚è≥ Generating...';
        
        const htmlCanvas = await html2canvas(canvas, {
          width: 1080,
          height: 1080,
          scale: 2,
          backgroundColor: null,
          logging: false,
          useCORS: true,
          allowTaint: true
        });
        
        htmlCanvas.toBlob(async (blob) => {
          if (!blob) {
            throw new Error('Failed to generate image blob');
          }
          
          const file = new File([blob], `${currentFlashcard.concept.replace(/[^a-z0-9]/gi, '-')}.png`, { type: 'image/png' });
          
          // Check if Web Share API is available
          if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
            try {
              await navigator.share({
                files: [file],
                title: currentFlashcard.concept,
                text: `Learn about ${currentFlashcard.concept} with Invest AI!`
              });
              if (btn) btn.innerHTML = originalText;
            } catch (shareError) {
              if (shareError.name !== 'AbortError') {
                console.log('Share cancelled or failed, falling back to download');
              }
              if (btn) btn.innerHTML = originalText;
              // Don't download automatically if user cancelled
              if (shareError.name !== 'AbortError') {
                downloadFlashcard();
              }
            }
          } else {
            // Web Share API not supported, download instead
            console.log('Web Share API not supported, downloading instead');
            if (btn) btn.innerHTML = originalText;
            downloadFlashcard();
          }
        }, 'image/png');
      } catch (error) {
        console.error('Share error:', error);
        if (event?.target) event.target.innerHTML = 'üì§ Share';
        alert('Share failed. Downloading instead.');
        downloadFlashcard();
      }
    }

    // Tab switching
    function switchTab(tabName) {
      console.log(`üîÑ Switching to tab: ${tabName}`);
      
      try {
        // Hide all content sections
        document.querySelectorAll('.content-section').forEach(section => {
          section.classList.remove('active');
        });
        
        // Remove active class from all tab buttons
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        
        // Show the requested content section
        const targetSection = document.getElementById(tabName);
        if (targetSection) {
          targetSection.classList.add('active');
          console.log(`‚úÖ Section '${tabName}' activated`);
        } else {
          console.error(`‚ùå Section '${tabName}' not found`);
        }
        
        // Special handling for Learn tab - show modules view by default
        if (tabName === 'learn') {
          const modulesView = document.getElementById('modules-view');
          const lessonContent = document.getElementById('lesson-content');
          
          if (modulesView) {
            modulesView.style.display = 'block';
          }
          if (lessonContent) {
            lessonContent.style.display = 'none';
          }
        }
        
        // Highlight the corresponding tab button
        const tabButtons = document.querySelectorAll('.tab-btn');
        tabButtons.forEach(btn => {
          if (btn.textContent.toLowerCase().includes(tabName) || 
              (tabName === 'home' && btn.textContent.includes('Home')) ||
              (tabName === 'learn' && btn.textContent.includes('Learn')) ||
              (tabName === 'analyze' && btn.textContent.includes('Analyze'))) {
            btn.classList.add('active');
          }
        });
        
        console.log(`‚úÖ Tab switched to: ${tabName}`);
      } catch (error) {
        console.error('‚ùå Error in switchTab:', error);
      }
    }

    // Load lesson content
    function loadLesson(lessonType) {
      console.log(`üìö Loading lesson: ${lessonType}`);
      
      try {
        switchTab('learn');
        
        // Hide modules, show lesson content
        const modulesView = document.getElementById('modules-view');
        const lessonContent = document.getElementById('lesson-content');
        
        if (!lessonContent) {
          console.error('‚ùå lesson-content div not found!');
          return;
        }
        
        if (modulesView) {
          modulesView.style.display = 'none';
        }
        lessonContent.style.display = 'block';
        
        console.log('‚úÖ Switched to lesson view');
        
        const lessons = {
          compounding: generateCompoundingLesson(),
          stocks: generateStocksLesson(),
          analysis: generateAnalysisLesson(),
          financials: generateFinancialsLesson(),
          valuation: generateValuationLesson(),
          metrics: generateMetricsLesson()
        };
        
        console.log(`üìù Generating ${lessonType} lesson...`);
        
        lessonContent.innerHTML = lessons[lessonType] || lessons.compounding;
        
        console.log(`‚úÖ Lesson content injected (${lessonContent.innerHTML.length} characters)`);
        
        if (lessonType === 'compounding') {
          console.log('üé¨ Initializing compounding animations...');
          initPennyAnimation();
          // Wait for DOM to be ready, then initialize charts
          setTimeout(() => {
            initCompoundingCharts();
          }, 100);
        }
        
        if (lessonType === 'valuation') {
          console.log('üìä Initializing valuation charts...');
          setTimeout(() => {
            initValuationCharts();
          }, 100);
        }
        
        if (lessonType === 'financials') {
          console.log('üí∞ Initializing financial charts...');
          setTimeout(() => {
            initFinancialCharts();
          }, 100);
        }
        
        console.log(`‚úÖ Lesson '${lessonType}' loaded successfully`);
      } catch (error) {
        console.error('‚ùå Error in loadLesson:', error);
        console.error('Error stack:', error.stack);
      }
    }
    
    // Function to go back to modules view
    function backToModules() {
      const modulesView = document.getElementById('modules-view');
      const lessonContent = document.getElementById('lesson-content');
      
      if (modulesView) {
        modulesView.style.display = 'block';
      }
      if (lessonContent) {
        lessonContent.style.display = 'none';
      }
    }
    
    // Toggle expandable cards
    function toggleExpand(card) {
      card.classList.toggle('expanded');
    }
    
    // AI Video Explanation System
    let currentVideoScript = '';
    let currentVideoUtterance = null;
    let currentVideoConcept = null;
    let videoStartTime = 0;
    let videoDuration = 60000; // 60 seconds
    let videoProgressInterval = null;
    
    // Open video explanation modal
    async function openVideoExplanation(conceptId) {
      const concept = flashcardConcepts.find(c => c.id === conceptId);
      if (!concept) return;
      
      currentVideoConcept = concept;
      
      // Show modal
      const modal = document.getElementById('video-explanation-modal');
      modal.style.display = 'flex';
      
      // Set title
      document.getElementById('video-concept-title').textContent = concept.concept;
      
      // Show loading
      document.getElementById('video-loading').style.display = 'block';
      document.getElementById('video-script-container').style.display = 'none';
      document.getElementById('play-explanation-btn').style.display = 'none';
      
      // Display flashcard content immediately
      displayVideoFlashcard(concept);
      
      try {
        // Generate script with Claude
        const script = await generateVideoScript(concept);
        currentVideoScript = script;
        
        // Hide loading, show content
        document.getElementById('video-loading').style.display = 'none';
        document.getElementById('video-script-container').style.display = 'block';
        document.getElementById('play-explanation-btn').style.display = 'flex';
        
        // Display script
        document.getElementById('video-script-display').innerHTML = formatScriptForDisplay(script);
        
        console.log('‚úÖ Video explanation ready for:', concept.concept);
      } catch (error) {
        console.error('‚ùå Error generating video script:', error);
        document.getElementById('video-loading').innerHTML = `
          <div style="color: #ff6b6b; padding: 20px;">
            <h3>‚ö†Ô∏è Error Generating Script</h3>
            <p>Could not connect to AI service. Please try again.</p>
            <button onclick="closeVideoExplanation()" style="margin-top: 15px; padding: 10px 20px; background: #39ff14; color: #0a0e27; border: none; border-radius: 8px; cursor: pointer;">Close</button>
          </div>
        `;
      }
    }
    
    // Generate video script using Claude API
    async function generateVideoScript(concept) {
      console.log('üé¨ Generating video script for:', concept.concept);
      
      if (OFFLINE_MODE) {
        // Return sample script for offline testing
        return `Hello! Let's understand ${concept.concept} in just 60 seconds.

${concept.definition}

Here's the formula: ${concept.formula}

${concept.example}

The key takeaway: This metric helps you evaluate companies by showing how efficiently they generate value. Understanding this will make you a better investor!

Remember: ${concept.concept} is one of the essential tools in your investing toolkit. Practice using it when analyzing real companies!`;
      }
      
      const response = await fetch("https://api.anthropic.com/v1/messages", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          model: "claude-sonnet-4-20250514",
          max_tokens: 1000,
          messages: [{
            role: "user",
            content: `Create an engaging 60-second educational video script explaining "${concept.concept}" for investing beginners.

Context:
- Definition: ${concept.definition}
- Formula: ${concept.formula}
- Example: ${concept.example}
- Category: ${concept.category}

Structure the script as follows:

**HOOK (5 seconds):**
Start with an attention-grabbing opening that makes beginners excited to learn this.

**EXPLANATION (30 seconds):**
Break down the concept in simple, conversational language. Use analogies that beginners understand (like comparing to everyday life). Avoid jargon.

**REAL EXAMPLE (20 seconds):**
Give a specific real company example with actual numbers. Make it concrete and memorable.

**KEY TAKEAWAY (5 seconds):**
End with one sentence that summarizes why this matters for investors.

Important:
- Write conversationally, as if you're talking to a friend
- Use "you" to engage the listener
- Keep sentences short and punchy
- Include specific numbers in examples
- Make it exciting and memorable!
- Total length: approximately 250-300 words to fit in 60 seconds when spoken

Just write the script - no stage directions, no formatting markers. Write it as natural speech.`
          }]
        })
      });

      const data = await response.json();
      
      if (!data.content || data.content.length === 0) {
        throw new Error('No script received from AI');
      }
      
      const script = data.content
        .map(item => (item.type === "text" ? item.text : ""))
        .filter(Boolean)
        .join("\\n");

      return script;
    }
    
    // Display flashcard in video modal
    function displayVideoFlashcard(concept) {
      const container = document.getElementById('video-flashcard-content');
      container.innerHTML = `
        <div style="margin-bottom: 30px;">
          <div style="display: inline-block; background: rgba(57, 255, 20, 0.2); padding: 8px 20px; border-radius: 20px; margin-bottom: 20px;">
            <span style="color: #39ff14; font-size: 0.9rem; font-weight: 600;">${concept.category}</span>
          </div>
        </div>
        
        <h2 style="font-size: 2.5rem; margin-bottom: 30px; color: white; font-family: 'Playfair Display', serif;">
          ${concept.concept}
        </h2>
        
        <p style="font-size: 1.3rem; line-height: 1.8; margin-bottom: 35px; color: rgba(255,255,255,0.9);">
          ${concept.definition}
        </p>
        
        <div style="background: rgba(0,0,0,0.4); padding: 25px; border-radius: 16px; margin-bottom: 30px; border-left: 5px solid #39ff14;">
          <h3 style="color: #39ff14; font-size: 1.1rem; margin-bottom: 15px;">üìê Formula:</h3>
          <code style="font-size: 1.2rem; color: var(--accent-emerald); font-family: 'JetBrains Mono', monospace; line-height: 1.6;">
            ${concept.formula}
          </code>
        </div>
        
        <div style="background: rgba(244, 196, 48, 0.15); padding: 25px; border-radius: 16px; border-left: 5px solid var(--accent-gold);">
          <h3 style="color: var(--accent-gold); font-size: 1.1rem; margin-bottom: 15px;">üí° Example:</h3>
          <p style="font-size: 1.1rem; line-height: 1.8; color: rgba(255,255,255,0.9);">
            ${concept.example}
          </p>
        </div>
      `;
    }
    
    // Format script for display with sections
    function formatScriptForDisplay(script) {
      // Split into paragraphs and add styling
      const paragraphs = script.split('\\n\\n').filter(p => p.trim());
      return paragraphs.map((p, index) => {
        let label = '';
        let color = 'rgba(255,255,255,0.7)';
        
        if (index === 0) {
          label = '<span style="color: #39ff14; font-weight: 600; font-size: 0.9rem;">üé¨ HOOK:</span><br>';
          color = 'rgba(255,255,255,0.9)';
        } else if (index === paragraphs.length - 1) {
          label = '<span style="color: var(--accent-gold); font-weight: 600; font-size: 0.9rem;">üéØ KEY TAKEAWAY:</span><br>';
          color = 'rgba(255,255,255,0.9)';
        }
        
        return `<p style="margin-bottom: 20px; color: ${color}; line-height: 2;">${label}${p}</p>`;
      }).join('');
    }
    
    // Play explanation with speech synthesis
    function playExplanation() {
      if (!currentVideoScript) return;
      
      // Stop any existing speech
      speechSynthesis.cancel();
      
      // Get voice settings
      const rate = parseFloat(document.getElementById('voice-rate').value);
      const pitch = parseFloat(document.getElementById('voice-pitch').value);
      
      // Create speech utterance
      currentVideoUtterance = new SpeechSynthesisUtterance(currentVideoScript);
      currentVideoUtterance.rate = rate;
      currentVideoUtterance.pitch = pitch;
      currentVideoUtterance.volume = 1;
      
      // Select best English voice
      const voices = speechSynthesis.getVoices();
      const englishVoice = voices.find(v => v.lang.startsWith('en-US')) || voices.find(v => v.lang.startsWith('en')) || voices[0];
      if (englishVoice) {
        currentVideoUtterance.voice = englishVoice;
      }
      
      // Update button
      document.getElementById('play-icon').textContent = 'üîä';
      document.getElementById('play-text').textContent = 'Playing...';
      
      // Start progress animation
      videoStartTime = Date.now();
      startVideoProgress();
      
      // Handle completion
      currentVideoUtterance.onend = () => {
        document.getElementById('play-icon').textContent = '‚úÖ';
        document.getElementById('play-text').textContent = 'Completed!';
        stopVideoProgress();
        setTimeout(() => {
          document.getElementById('play-icon').textContent = 'üîÑ';
          document.getElementById('play-text').textContent = 'Play Again';
        }, 2000);
      };
      
      // Handle errors
      currentVideoUtterance.onerror = (event) => {
        console.error('Speech synthesis error:', event);
        document.getElementById('play-icon').textContent = '‚ö†Ô∏è';
        document.getElementById('play-text').textContent = 'Error - Try Again';
        stopVideoProgress();
      };
      
      // Start speaking
      speechSynthesis.speak(currentVideoUtterance);
      
      console.log('üéôÔ∏è Playing explanation:', currentVideoConcept.concept);
    }
    
    // Pause explanation
    function pauseExplanation() {
      if (speechSynthesis.speaking && !speechSynthesis.paused) {
        speechSynthesis.pause();
        document.getElementById('play-icon').textContent = '‚è∏Ô∏è';
        document.getElementById('play-text').textContent = 'Paused';
        stopVideoProgress();
      } else if (speechSynthesis.paused) {
        speechSynthesis.resume();
        document.getElementById('play-icon').textContent = 'üîä';
        document.getElementById('play-text').textContent = 'Playing...';
        startVideoProgress();
      }
    }
    
    // Stop explanation
    function stopExplanation() {
      speechSynthesis.cancel();
      document.getElementById('play-icon').textContent = '‚ñ∂Ô∏è';
      document.getElementById('play-text').textContent = 'Play Explanation';
      document.getElementById('video-progress-bar').style.width = '0%';
      stopVideoProgress();
    }
    
    // Replay explanation
    function replayExplanation() {
      stopExplanation();
      setTimeout(() => playExplanation(), 100);
    }
    
    // Close video modal
    function closeVideoExplanation() {
      stopExplanation();
      document.getElementById('video-explanation-modal').style.display = 'none';
      currentVideoScript = '';
      currentVideoConcept = null;
    }
    
    // Update progress bar
    function startVideoProgress() {
      stopVideoProgress();
      const progressBar = document.getElementById('video-progress-bar');
      
      videoProgressInterval = setInterval(() => {
        const elapsed = Date.now() - videoStartTime;
        const progress = Math.min((elapsed / videoDuration) * 100, 100);
        progressBar.style.width = progress + '%';
        
        if (progress >= 100) {
          stopVideoProgress();
        }
      }, 100);
    }
    
    function stopVideoProgress() {
      if (videoProgressInterval) {
        clearInterval(videoProgressInterval);
        videoProgressInterval = null;
      }
    }
    
    // Update voice setting displays
    document.addEventListener('DOMContentLoaded', () => {
      const rateSlider = document.getElementById('voice-rate');
      const pitchSlider = document.getElementById('voice-pitch');
      
      if (rateSlider) {
        rateSlider.addEventListener('input', (e) => {
          document.getElementById('rate-value').textContent = e.target.value + 'x';
        });
      }
      
      if (pitchSlider) {
        pitchSlider.addEventListener('input', (e) => {
          document.getElementById('pitch-value').textContent = e.target.value + 'x';
        });
      }
    });
    
    // Render flashcard library in main flashcards tab
    function renderFlashcardLibraryMain() {
      const libraryDiv = document.getElementById('flashcard-library');
      if (!libraryDiv) return;
      
      // Group concepts by category
      const categories = {};
      flashcardConcepts.forEach(concept => {
        if (!categories[concept.category]) {
          categories[concept.category] = [];
        }
        categories[concept.category].push(concept);
      });
      
      let html = '<div style="max-width: 1400px; margin: 0 auto;">';
      
      Object.keys(categories).sort().forEach(category => {
        html += `
          <div style="margin-bottom: 50px;">
            <h3 style="font-size: 1.8rem; margin-bottom: 25px; font-family: 'Playfair Display', serif; color: var(--accent-gold); border-bottom: 3px solid var(--accent-gold); padding-bottom: 10px;">
              ${category} (${categories[category].length})
            </h3>
            <div class="concept-library" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
        `;
        
        categories[category].forEach(concept => {
          html += `
            <div class="concept-card" style="cursor: pointer; transition: all 0.3s ease; background: rgba(255, 255, 255, 0.03); border: 2px solid rgba(255, 255, 255, 0.1); border-radius: 16px; padding: 20px;">
              <h4 style="font-size: 1.2rem; margin-bottom: 10px; color: var(--accent-emerald);">${concept.concept}</h4>
              <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 15px; line-height: 1.6;">${concept.definition}</p>
              <div style="background: rgba(57, 255, 20, 0.1); padding: 10px; border-radius: 8px; border-left: 3px solid #39ff14; margin-bottom: 15px;">
                <code style="font-size: 0.85rem; color: #39ff14;">${concept.formula}</code>
              </div>
              <div style="margin-top: 15px; display: flex; gap: 10px; flex-direction: column;">
                <button onclick="openVideoExplanation('${concept.id}')" style="background: linear-gradient(135deg, #39ff14, var(--accent-emerald)); color: #0a0e27; padding: 12px 20px; border-radius: 10px; border: none; font-weight: 700; cursor: pointer; font-size: 1rem; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.3s ease;">
                  <span style="font-size: 1.2rem;">‚ñ∂Ô∏è</span>
                  <span>Watch 1-Min Explanation</span>
                </button>
                <button onclick="openFlashcardModal(); selectConcept('${concept.id}')" style="background: rgba(244, 196, 48, 0.2); color: var(--accent-gold); padding: 12px 20px; border-radius: 10px; border: 2px solid var(--accent-gold); font-weight: 600; cursor: pointer; font-size: 0.95rem; transition: all 0.3s ease;">
                  üìö Create Flashcard
                </button>
              </div>
            </div>
          `;
        });
        
        html += '</div></div>';
      });
      
      html += `
        <div style="text-align: center; margin-top: 50px; padding: 40px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15)); border-radius: 16px;">
          <h3 style="font-size: 1.8rem; margin-bottom: 15px; color: var(--accent-purple);">üìä ${flashcardConcepts.length} Investment Concepts</h3>
          <p style="font-size: 1.1rem; color: var(--text-secondary); max-width: 600px; margin: 0 auto;">
            Click any card to customize colors, adjust text sizes, and download as 1080x1080 Instagram-ready images. Perfect for studying or sharing!
          </p>
        </div>
      `;
      
      html += '</div>';
      libraryDiv.innerHTML = html;
    }

    // Compounding Lesson
    function generateCompoundingLesson() {
      return `
        <div class="lesson-container">
          <h2>The Magic of Compounding</h2>
          <p style="font-size: 1.15rem; color: var(--text-secondary); margin-bottom: 30px;">
            Compounding is often called the "eighth wonder of the world." It's the process where your investments generate earnings, 
            and those earnings generate their own earnings, creating exponential growth over time.
          </p>

          <h3 style="font-size: 1.8rem; margin: 40px 0 20px; font-family: 'Playfair Display', serif;">
            Interactive Example: The Penny Doubling Challenge
          </h3>
          <p style="color: var(--text-secondary); margin-bottom: 20px;">
            A genie offers you a choice: $1 million today, or a penny that doubles every day for 30 days. Which would you choose?
          </p>

          <div class="animation-canvas">
            <div class="penny-animation">
              <div class="penny">1¬¢</div>
              <div class="day-counter">Day <span id="pennyDay">1</span></div>
              <div class="penny-value">Value: $<span id="pennyValue">0.01</span></div>
              <div class="progress-bar">
                <div class="progress-fill" id="pennyProgress" style="width: 3.33%"></div>
              </div>
            </div>
          </div>

          <div class="animation-controls">
            <button class="control-btn" onclick="startPennyAnimation()">‚ñ∂ Start Animation</button>
            <button class="control-btn secondary" onclick="resetPennyAnimation()">‚Ü∫ Reset</button>
            <button class="control-btn secondary" onclick="skipToEnd()">‚è© Skip to Day 30</button>
          </div>

          <h3 style="font-size: 1.8rem; margin: 50px 0 20px; font-family: 'Playfair Display', serif;">
            üìä Exponential Growth Visualization
          </h3>
          <div class="chart-container">
            <canvas id="compoundingChart"></canvas>
          </div>

          <div style="margin-top: 50px; padding: 30px; background: rgba(244, 196, 48, 0.1); border-radius: 16px; border-left: 4px solid var(--accent-gold);">
            <h4 style="font-size: 1.4rem; margin-bottom: 15px;">The Shocking Result:</h4>
            <p style="font-size: 1.1rem; line-height: 1.8;">
              By day 30, that penny grows to over <strong style="color: var(--accent-gold);">$5.3 million</strong>! 
              This is the power of exponential growth. Notice how the growth is slow at first, but accelerates dramatically in the later days.
            </p>
          </div>

          <h3 style="font-size: 1.8rem; margin: 50px 0 20px; font-family: 'Playfair Display', serif;">
            üí∞ Investment Growth Comparison
          </h3>
          <div class="chart-container">
            <canvas id="investmentComparisonChart"></canvas>
          </div>

          <h3 style="font-size: 1.8rem; margin: 50px 0 20px; font-family: 'Playfair Display', serif;">
            More Mind-Bending Examples
          </h3>

          <div class="modules-grid" style="margin-top: 30px;">
            <div class="module-card">
              <div class="module-icon">üìÑ</div>
              <h3>Paper Folding to the Moon</h3>
              <p>If you could fold a piece of paper 42 times, it would reach the moon. Each fold doubles the thickness, demonstrating exponential growth in physical space.</p>
            </div>

            <div class="module-card">
              <div class="module-icon">‚ôüÔ∏è</div>
              <h3>The Chess & Rice Story</h3>
              <p>A king promised to double rice grains on each square of a chessboard, starting with one grain. By the 64th square, he owed 18 quintillion grains - more rice than exists on Earth!</p>
            </div>

            <div class="module-card">
              <div class="module-icon">üíµ</div>
              <h3>Real Investment Example</h3>
              <p>$10,000 invested at 10% annual return grows to $174,494 in 30 years. The same money at 12% becomes $299,599. Small differences in return rates create massive differences over time.</p>
            </div>
          </div>

          <div style="margin-top: 50px; padding: 30px; background: rgba(45, 212, 191, 0.1); border-radius: 16px;">
            <h4 style="font-size: 1.4rem; margin-bottom: 15px; color: var(--accent-emerald);">Key Takeaways:</h4>
            <ul style="font-size: 1.05rem; line-height: 2; padding-left: 20px;">
              <li>Time is your most valuable asset in investing</li>
              <li>Start early - even small amounts can grow substantially</li>
              <li>Reinvest your returns to maximize compounding</li>
              <li>Be patient - the real magic happens in the later years</li>
              <li>A few percentage points difference in returns compounds to huge differences</li>
            </ul>
            
            <div style="margin-top: 30px; text-align: center;">
              <button class="control-btn" onclick="openFlashcardModal()" style="font-size: 1.1rem; padding: 16px 40px;">
                üìö Create Learning Flashcard
              </button>
              <p style="margin-top: 10px; font-size: 0.9rem; color: var(--text-secondary);">
                Turn key concepts into shareable 1080x1080 cards!
              </p>
            </div>
          </div>
        </div>
      `;
    }

    // Stocks Lesson
    function generateStocksLesson() {
      return `
        <div class="lesson-container">
          <button onclick="backToModules()" style="background: rgba(57, 255, 20, 0.1); border: 2px solid #39ff14; color: #39ff14; padding: 10px 20px; border-radius: 8px; cursor: pointer; margin-bottom: 20px; font-weight: 600;">
            ‚Üê Back to Modules
          </button>
          
          <h2>üìà Understanding Stocks & Capital Markets</h2>
          
          <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15)); padding: 25px; border-radius: 16px; margin: 20px 0; border-left: 4px solid var(--accent-purple);">
            <p style="font-size: 1.1rem; line-height: 1.8; margin: 0;">
              üéØ <strong>Learning Goal:</strong> Understand what stocks are, how capital markets work, and the difference between investing vehicles. This lesson uses real-world examples and interactive explanations.
            </p>
          </div>

          <h3 style="font-size: 1.8rem; margin: 40px 0 20px;">üè¢ What is a Stock?</h3>
          
          <div class="expandable-card" onclick="toggleExpand(this)">
            <div class="expand-header">
              <span style="font-size: 1.3rem; font-weight: 600;">üí° Click to Learn: Simple Definition + Real Example</span>
              <span class="expand-icon">+</span>
            </div>
            <div class="expand-content">
              <p style="font-size: 1.1rem; line-height: 1.8; margin: 15px 0;">
                A <strong>stock</strong> represents <strong>ownership</strong> in a company. When you buy a stock, you become a part-owner of that business.
              </p>
              
              <div style="background: rgba(57, 255, 20, 0.1); padding: 20px; border-radius: 12px; margin: 20px 0; border-left: 4px solid #39ff14;">
                <h4 style="color: #39ff14; margin-bottom: 15px;">üé¨ Example: Buying Apple Stock</h4>
                <p style="font-size: 1.05rem; line-height: 2;">
                  ‚Ä¢ Apple has <strong>15.5 billion shares</strong><br>
                  ‚Ä¢ Stock price: <strong>$195/share</strong><br>
                  ‚Ä¢ Buy 100 shares = <strong>$19,500 investment</strong><br>
                  ‚Ä¢ You own <strong>0.0000006%</strong> of Apple<br>
                  ‚Ä¢ You get: Dividends + voting rights + price gains
                </p>
              </div>
            </div>
          </div>

          <h3 style="font-size: 1.8rem; margin: 40px 0 20px;">üèõÔ∏è Capital Markets Explained</h3>
          
          <div class="expandable-card" onclick="toggleExpand(this)">
            <div class="expand-header">
              <span style="font-size: 1.3rem; font-weight: 600;">üÜï PRIMARY MARKET - Where Stocks Are Born (IPO)</span>
              <span class="expand-icon">+</span>
            </div>
            <div class="expand-content">
              <p style="font-size: 1.1rem; line-height: 1.8; margin: 15px 0;">
                The <strong>primary market</strong> is where companies <strong>first sell shares</strong> to raise money (IPO = Initial Public Offering).
              </p>
              
              <div style="background: linear-gradient(135deg, rgba(167, 139, 250, 0.2), rgba(139, 92, 246, 0.2)); padding: 25px; border-radius: 16px; margin: 20px 0;">
                <h4 style="color: var(--accent-purple); margin-bottom: 20px; font-size: 1.3rem;">üé¨ Case Study: Reddit's IPO (March 2024)</h4>
                
                <div style="background: rgba(57, 255, 20, 0.2); padding: 15px; border-radius: 10px; margin: 10px 0;">
                  <strong style="color: #39ff14;">üìÖ Before IPO:</strong>
                  <p style="margin-top: 10px; line-height: 1.8;">
                    Reddit was private. Only employees and early investors owned shares. No public trading.
                  </p>
                </div>
                
                <div style="background: rgba(244, 196, 48, 0.2); padding: 15px; border-radius: 10px; margin: 10px 0;">
                  <strong style="color: var(--accent-gold);">üíº IPO Day (March 21, 2024):</strong>
                  <p style="margin-top: 10px; line-height: 1.8;">
                    <strong>IPO Price:</strong> $34/share<br>
                    <strong>Shares Sold:</strong> 22 million<br>
                    <strong>Money Raised:</strong> $748 million goes to Reddit<br>
                    <strong>Who Bought:</strong> Institutional investors
                  </p>
                </div>
                
                <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 12px; margin-top: 20px; border: 2px solid #39ff14;">
                  <h5 style="color: #39ff14; margin-bottom: 10px;">üéØ Key Takeaway:</h5>
                  <p style="font-size: 1.1rem;">In PRIMARY market, <strong>money goes TO the company</strong>. Reddit used $748M to hire engineers, expand servers, develop features.</p>
                </div>
              </div>
            </div>
          </div>

          <div class="expandable-card" onclick="toggleExpand(this)">
            <div class="expand-header">
              <span style="font-size: 1.3rem; font-weight: 600;">üîÑ SECONDARY MARKET - Where You Buy & Sell Daily</span>
              <span class="expand-icon">+</span>
            </div>
            <div class="expand-content">
              <p style="font-size: 1.1rem; line-height: 1.8; margin: 15px 0;">
                The <strong>secondary market</strong> is where investors trade shares <strong>with each other</strong>. This is NYSE, NASDAQ - the stock market on the news.
              </p>
              
              <div style="background: linear-gradient(135deg, rgba(244, 196, 48, 0.2), rgba(251, 191, 36, 0.2)); padding: 25px; border-radius: 16px; margin: 20px 0;">
                <h4 style="color: var(--accent-gold); margin-bottom: 20px; font-size: 1.3rem;">üé¨ Real Transaction: Buying Tesla Stock</h4>
                
                <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 12px; margin: 15px 0;">
                  <h5 style="color: #39ff14; font-size: 1.2rem; margin-bottom: 15px;">üì± Step-by-Step:</h5>
                  <p style="line-height: 2;">
                    1Ô∏è‚É£ Open Robinhood/Fidelity app<br>
                    2Ô∏è‚É£ Search "TSLA" (Tesla)<br>
                    3Ô∏è‚É£ Current price: $248.50<br>
                    4Ô∏è‚É£ Click "Buy 10 shares" = <strong>$2,485</strong>
                  </p>
                  
                  <div style="background: rgba(57, 255, 20, 0.1); padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h5 style="color: #39ff14;">üí∏ What Actually Happens:</h5>
                    <p style="line-height: 2;">
                      ‚Ä¢ Your $2,485 goes to <strong>another investor</strong> (not Tesla)<br>
                      ‚Ä¢ That person is selling their 10 shares<br>
                      ‚Ä¢ Stock exchange matches buyers/sellers<br>
                      ‚Ä¢ <strong>Tesla gets $0</strong> from this
                    </p>
                  </div>
                </div>
                
                <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 12px; margin-top: 20px; border: 2px solid var(--accent-gold);">
                  <h5 style="color: var(--accent-gold); margin-bottom: 10px;">üéØ Key Takeaway:</h5>
                  <p style="font-size: 1.1rem;">In SECONDARY market, <strong>money goes investor ‚Üî investor</strong>. Tesla already raised money at IPO. Now investors trade among themselves.</p>
                </div>
              </div>
            </div>
          </div>

          <h3 style="font-size: 1.8rem; margin: 40px 0 20px;">üìä The Three Core Financial Statements</h3>
          
          <div class="expandable-card" onclick="toggleExpand(this)">
            <div class="expand-header">
              <span style="font-size: 1.3rem; font-weight: 600;">üí∞ INCOME STATEMENT - How Much Profit?</span>
              <span class="expand-icon">+</span>
            </div>
            <div class="expand-content">
              <p style="font-size: 1.1rem; line-height: 1.8; margin: 15px 0;">
                Shows how much money a company <strong>made or lost</strong> during a period.
              </p>
              
              <div style="background: rgba(0, 0, 0, 0.3); padding: 20px; border-radius: 12px; margin: 20px 0;">
                <h4 style="color: #39ff14; margin-bottom: 15px;">üé¨ Apple Q4 2024 (Simplified)</h4>
                <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.95rem;">
                  <div style="padding: 10px; border-bottom: 2px solid #39ff14;">
                    <strong>Revenue:</strong> <span style="float: right; color: var(--accent-gold);">$94.9B</span><br>
                    <small style="color: var(--text-secondary);">Total sales from iPhones, Macs, Services</small>
                  </div>
                  <div style="padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <span style="padding-left: 20px;">- Cost of Goods:</span> <span style="float: right; color: #ff6b6b;">($52.0B)</span><br>
                    <small style="color: var(--text-secondary); padding-left: 20px;">Manufacturing, materials</small>
                  </div>
                  <div style="padding: 10px; border-bottom: 2px solid #39ff14; background: rgba(57, 255, 20, 0.1);">
                    <strong>= Gross Profit:</strong> <span style="float: right; color: #39ff14;">$42.9B</span><br>
                    <small style="color: #39ff14;">45% margin - Excellent!</small>
                  </div>
                  <div style="padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <span style="padding-left: 20px;">- Operating Expenses:</span> <span style="float: right; color: #ff6b6b;">($14.3B)</span><br>
                    <small style="color: var(--text-secondary); padding-left: 20px;">R&D, marketing, salaries</small>
                  </div>
                  <div style="padding: 15px; border-top: 3px double #39ff14; background: rgba(102, 126, 234, 0.2);">
                    <strong style="font-size: 1.2rem;">NET INCOME:</strong> <span style="float: right; color: #39ff14; font-size: 1.2rem;">$24.6B</span><br>
                    <small style="color: #39ff14;">Bottom line profit!</small>
                  </div>
                </div>
                
                <div style="background: rgba(57, 255, 20, 0.1); padding: 15px; border-radius: 10px; margin-top: 20px;">
                  <strong style="color: #39ff14;">üí° What This Means:</strong>
                  <p style="margin-top: 10px;">For every $100 in sales, Apple keeps $26 as profit. That's EXCELLENT - most companies keep $5-15.</p>
                </div>
              </div>
            </div>
          </div>

          <div class="expandable-card" onclick="toggleExpand(this)">
            <div class="expand-header">
              <span style="font-size: 1.3rem; font-weight: 600;">üè¶ BALANCE SHEET - What Company Owns vs Owes</span>
              <span class="expand-icon">+</span>
            </div>
            <div class="expand-content">
              <p style="font-size: 1.1rem; line-height: 1.8; margin: 15px 0;">
                Shows what a company <strong>owns</strong> (assets) and <strong>owes</strong> (liabilities) at a point in time.
              </p>
              
              <div style="background: rgba(0, 0, 0, 0.3); padding: 20px; border-radius: 12px; margin: 20px 0;">
                <h4 style="color: var(--accent-gold); margin-bottom: 15px;">üé¨ Tesla End of 2024</h4>
                <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.95rem;">
                  <h5 style="color: #39ff14; margin-bottom: 10px;">ASSETS (What Tesla Owns):</h5>
                  <div style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    Cash: <span style="float: right; color: #39ff14;">$29.1B üíµ</span>
                  </div>
                  <div style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    Inventory: <span style="float: right; color: #39ff14;">$16.3B üöó</span>
                  </div>
                  <div style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    Property: <span style="float: right; color: #39ff14;">$43.7B üè≠</span>
                  </div>
                  <div style="padding: 10px; background: rgba(57, 255, 20, 0.1); margin-top: 5px;">
                    <strong>Total Assets:</strong> <span style="float: right; color: #39ff14;">$106.6B</span>
                  </div>
                  
                  <h5 style="color: #ff6b6b; margin: 20px 0 10px;">LIABILITIES (What Tesla Owes):</h5>
                  <div style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    Payables: <span style="float: right; color: #ff6b6b;">$15.7B üí≥</span>
                  </div>
                  <div style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    Debt: <span style="float: right; color: #ff6b6b;">$6.8B üè¶</span>
                  </div>
                  <div style="padding: 10px; margin-top: 5px;">
                    <strong>Total Liabilities:</strong> <span style="float: right; color: #ff6b6b;">$43.0B</span>
                  </div>
                  
                  <div style="padding: 15px; border-top: 3px double var(--accent-gold); background: rgba(244, 196, 48, 0.2); margin-top: 15px;">
                    <strong style="font-size: 1.2rem;">EQUITY (Net Worth):</strong> <span style="float: right; color: var(--accent-gold); font-size: 1.2rem;">$63.6B</span>
                  </div>
                </div>
                
                <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 12px; margin-top: 20px; border: 2px solid var(--accent-gold);">
                  <h5 style="color: var(--accent-gold);">üéØ The Golden Equation:</h5>
                  <p style="font-size: 1.2rem; text-align: center; margin: 15px 0; color: #39ff14;">
                    Assets = Liabilities + Equity
                  </p>
                  <p style="font-size: 1.1rem; text-align: center;">
                    $106.6B = $43.0B + $63.6B ‚úÖ
                  </p>
                </div>
              </div>
            </div>
          </div>

          <div class="expandable-card" onclick="toggleExpand(this)">
            <div class="expand-header">
              <span style="font-size: 1.3rem; font-weight: 600;">üí∏ CASH FLOW - Real Money In/Out</span>
              <span class="expand-icon">+</span>
            </div>
            <div class="expand-content">
              <p style="font-size: 1.1rem; line-height: 1.8; margin: 15px 0;">
                Shows actual <strong>cash movement</strong>. Critical because companies can show profit but run out of cash!
              </p>
              
              <div style="background: rgba(0, 0, 0, 0.3); padding: 20px; border-radius: 12px; margin: 20px 0;">
                <h4 style="color: var(--accent-purple); margin-bottom: 15px;">üé¨ Netflix 2024</h4>
                <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.95rem;">
                  <h5 style="color: #39ff14; margin-bottom: 10px;">Operating (Day-to-Day):</h5>
                  <div style="padding: 8px;">
                    + Subscriptions: <span style="float: right; color: #39ff14;">$9.1B</span>
                  </div>
                  <div style="padding: 8px;">
                    - Content Costs: <span style="float: right; color: #ff6b6b;">($3.5B)</span>
                  </div>
                  <div style="padding: 10px; background: rgba(57, 255, 20, 0.1); margin-top: 5px;">
                    <strong>= Operating CF:</strong> <span style="float: right; color: #39ff14;">$3.6B ‚úÖ</span>
                  </div>
                  
                  <h5 style="color: var(--accent-gold); margin: 20px 0 10px;">Investing (Long-term):</h5>
                  <div style="padding: 8px;">
                    - Equipment: <span style="float: right; color: #ff6b6b;">($0.8B)</span>
                  </div>
                  
                  <h5 style="color: var(--accent-purple); margin: 20px 0 10px;">Financing (Debt/Dividends):</h5>
                  <div style="padding: 8px;">
                    - Buybacks: <span style="float: right; color: #ff6b6b;">($2.5B)</span>
                  </div>
                  
                  <div style="padding: 15px; border-top: 3px double #39ff14; background: rgba(57, 255, 20, 0.2); margin-top: 15px;">
                    <strong>NET CHANGE:</strong> <span style="float: right; color: #39ff14;">+$0.3B</span>
                  </div>
                </div>
                
                <div style="background: rgba(57, 255, 20, 0.1); padding: 15px; border-radius: 10px; margin-top: 20px;">
                  <strong style="color: #39ff14;">üí° Why This Matters:</strong>
                  <p style="margin-top: 10px;">Positive operating cash flow ($3.6B) = healthy business generating cash. Free Cash Flow = $3.6B - $0.8B = <strong>$2.8B</strong> available for shareholders!</p>
                </div>
              </div>
            </div>
          </div>

          <div style="background: linear-gradient(135deg, rgba(57, 255, 20, 0.2), rgba(34, 197, 94, 0.2)); padding: 30px; border-radius: 16px; margin: 40px 0; border: 3px solid #39ff14;">
            <h3 style="color: #39ff14; margin-bottom: 20px; font-size: 1.8rem;">üéì Lesson Complete!</h3>
            <p style="font-size: 1.1rem; line-height: 1.8; margin-bottom: 20px;">
              You now understand stocks and capital markets! You learned:
            </p>
            <ul style="line-height: 2; font-size: 1.05rem; margin-bottom: 25px;">
              <li>‚úÖ What stocks represent (ownership)</li>
              <li>‚úÖ Primary vs Secondary markets (IPOs vs daily trading)</li>
              <li>‚úÖ 3 financial statements with real examples</li>
              <li>‚úÖ How to read company financials (Apple, Tesla, Netflix)</li>
            </ul>
            
            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
              <button class="control-btn" onclick="backToModules()">‚Üê Back to Modules</button>
              <button class="control-btn" onclick="openFlashcardModal()" style="background: rgba(244, 196, 48, 0.2); border-color: var(--accent-gold);">
                üìö Create Flashcard
              </button>
            </div>
          </div>
        </div>
      `;
    }

    function generateAnalysisLesson() {
      return `
        <div class="lesson-container">
          <button onclick="backToModules()" style="background: rgba(57, 255, 20, 0.1); border: 2px solid #39ff14; color: #39ff14; padding: 10px 20px; border-radius: 8px; cursor: pointer; margin-bottom: 20px; font-weight: 600;">
            ‚Üê Back to Modules
          </button>
          
          <h2>üîç The Three Pillars of Stock Analysis</h2>
          
          <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15)); padding: 25px; border-radius: 16px; margin: 20px 0; border-left: 4px solid var(--accent-purple);">
            <p style="font-size: 1.1rem; line-height: 1.8; margin: 0;">
              üéØ <strong>Learning Goal:</strong> Master the three fundamental approaches professional investors use to analyze stocks. Each pillar is essential - skip one and you're investing blind!
            </p>
          </div>

          <div style="background: rgba(57, 255, 20, 0.05); padding: 20px; border-radius: 12px; margin: 30px 0; border: 2px solid #39ff14;">
            <h3 style="color: #39ff14; margin-bottom: 15px;">üìä The Three Pillars:</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
              <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px;">
                <h4 style="color: var(--accent-emerald);">1Ô∏è‚É£ Business Understanding</h4>
                <p style="font-size: 0.95rem; color: var(--text-secondary);">What does the company do? How does it make money?</p>
              </div>
              <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px;">
                <h4 style="color: var(--accent-gold);">2Ô∏è‚É£ Financial Health</h4>
                <p style="font-size: 0.95rem; color: var(--text-secondary);">Is the company profitable? Growing? Financially stable?</p>
              </div>
              <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px;">
                <h4 style="color: var(--accent-purple);">3Ô∏è‚É£ Valuation</h4>
                <p style="font-size: 0.95rem; color: var(--text-secondary);">Is the stock price fair, cheap, or expensive?</p>
              </div>
            </div>
          </div>

          <h3 style="font-size: 2rem; margin: 40px 0 20px; color: var(--accent-emerald);">1Ô∏è‚É£ Business Understanding</h3>

          <div class="expandable-card" onclick="toggleExpand(this)">
            <div class="expand-header">
              <span style="font-size: 1.3rem; font-weight: 600;">üè¢ What Does the Company Do?</span>
              <span class="expand-icon">+</span>
            </div>
            <div class="expand-content">
              <p style="font-size: 1.1rem; line-height: 1.8; margin: 15px 0;">
                Before investing a single dollar, understand <strong>exactly how the company makes money</strong>. It sounds obvious, but many investors skip this!
              </p>
              
              <div style="background: linear-gradient(135deg, rgba(57, 255, 20, 0.15), rgba(34, 197, 94, 0.15)); padding: 25px; border-radius: 16px; margin: 20px 0;">
                <h4 style="color: #39ff14; margin-bottom: 20px;">üé¨ Real Example: Netflix</h4>
                
                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px; margin: 15px 0;">
                  <h5 style="color: var(--accent-gold); margin-bottom: 15px;">Business Model:</h5>
                  <ul style="line-height: 2; font-size: 1.05rem;">
                    <li><strong>What they sell:</strong> Streaming entertainment subscriptions</li>
                    <li><strong>Revenue source:</strong> Monthly subscription fees ($6.99 to $22.99/month)</li>
                    <li><strong>Customers:</strong> 280+ million subscribers worldwide</li>
                    <li><strong>How they make money:</strong> Subscribers pay monthly ‚Üí Netflix produces/licenses content ‚Üí More subscribers join</li>
                  </ul>
                </div>
                
                <div style="background: rgba(57, 255, 20, 0.1); padding: 20px; border-radius: 12px; margin: 15px 0; border-left: 4px solid #39ff14;">
                  <h5 style="color: #39ff14; margin-bottom: 10px;">üí° Key Questions to Ask:</h5>
                  <ol style="line-height: 2; font-size: 1.05rem;">
                    <li><strong>Revenue Model:</strong> One-time sales or recurring subscriptions?</li>
                    <li><strong>Target Market:</strong> Who are the customers? Businesses or consumers?</li>
                    <li><strong>Competition:</strong> Who are the main rivals? (Disney+, HBO, Amazon Prime)</li>
                    <li><strong>Defensibility:</strong> What stops competitors from copying them?</li>
                  </ol>
                </div>
              </div>
            </div>
          </div>

          <div class="expandable-card" onclick="toggleExpand(this)">
            <div class="expand-header">
              <span style="font-size: 1.3rem; font-weight: 600;">üè∞ Economic Moat - The Competitive Advantage</span>
              <span class="expand-icon">+</span>
            </div>
            <div class="expand-content">
              <p style="font-size: 1.1rem; line-height: 1.8; margin: 15px 0;">
                An <strong>economic moat</strong> is like a castle's protective barrier. It's what prevents competitors from stealing customers and profits.
              </p>
              
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 20px 0;">
                <div style="background: rgba(102, 126, 234, 0.15); padding: 20px; border-radius: 12px; border: 2px solid var(--accent-purple);">
                  <h5 style="color: var(--accent-purple); margin-bottom: 10px;">üé® Brand Power</h5>
                  <p style="font-size: 0.95rem; margin-bottom: 10px;">Customers prefer your brand and pay premium prices</p>
                  <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; margin-top: 10px;">
                    <strong>Example: Apple</strong><br>
                    <small>People wait in line for iPhones. Brand loyalty is extreme. Can charge 30-40% premium vs competitors.</small>
                  </div>
                </div>
                
                <div style="background: rgba(244, 196, 48, 0.15); padding: 20px; border-radius: 12px; border: 2px solid var(--accent-gold);">
                  <h5 style="color: var(--accent-gold); margin-bottom: 10px;">üîÑ Network Effects</h5>
                  <p style="font-size: 0.95rem; margin-bottom: 10px;">More users make product more valuable for everyone</p>
                  <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; margin-top: 10px;">
                    <strong>Example: Facebook/Meta</strong><br>
                    <small>3 billion users. You join because everyone else is there. Impossible to compete.</small>
                  </div>
                </div>
                
                <div style="background: rgba(57, 255, 20, 0.15); padding: 20px; border-radius: 12px; border: 2px solid #39ff14;">
                  <h5 style="color: #39ff14; margin-bottom: 10px;">üí∞ Cost Advantage</h5>
                  <p style="font-size: 0.95rem; margin-bottom: 10px;">Can produce cheaper than anyone else</p>
                  <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; margin-top: 10px;">
                    <strong>Example: Walmart</strong><br>
                    <small>Massive scale. Buys in huge volumes. Negotiates lowest prices. Competitors can't match.</small>
                  </div>
                </div>
                
                <div style="background: rgba(167, 139, 250, 0.15); padding: 20px; border-radius: 12px; border: 2px solid var(--accent-purple);">
                  <h5 style="color: var(--accent-purple); margin-bottom: 10px;">üîí Switching Costs</h5>
                  <p style="font-size: 0.95rem; margin-bottom: 10px;">Too painful/expensive for customers to leave</p>
                  <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; margin-top: 10px;">
                    <strong>Example: Adobe</strong><br>
                    <small>Designers learn Photoshop for years. All files in Adobe format. Switching = relearning everything.</small>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <h3 style="font-size: 2rem; margin: 40px 0 20px; color: var(--accent-gold);">2Ô∏è‚É£ Financial Health - Deep Dive</h3>
          
          <p style="font-size: 1.1rem; line-height: 1.8; color: var(--text-secondary); margin-bottom: 30px;">
            This is where we look at the numbers. Think of it like a health checkup - but for a company. We're checking if it's making money, growing, and financially stable.
          </p>

          <div class="expandable-card" onclick="toggleExpand(this)">
            <div class="expand-header">
              <span style="font-size: 1.3rem; font-weight: 600;">üíµ REVENUE - The Top Line</span>
              <span class="expand-icon">+</span>
            </div>
            <div class="expand-content">
              <div style="background: rgba(57, 255, 20, 0.1); padding: 20px; border-radius: 12px; margin: 20px 0; border-left: 4px solid #39ff14;">
                <h4 style="color: #39ff14; margin-bottom: 15px;">üìñ What is Revenue?</h4>
                <p style="font-size: 1.1rem; line-height: 1.8;">
                  <strong>Revenue</strong> (also called "sales" or "top line") is the <strong>total money a company receives</strong> from selling products or services <strong>BEFORE</strong> paying any expenses.
                </p>
              </div>
              
              <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(139, 92, 246, 0.15)); padding: 25px; border-radius: 16px; margin: 20px 0;">
                <h4 style="color: var(--accent-purple); margin-bottom: 20px;">üé¨ Real Example: Starbucks</h4>
                
                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px;">
                  <h5 style="color: #39ff14; margin-bottom: 15px;">How Starbucks Makes Revenue:</h5>
                  <table style="width: 100%; border-collapse: collapse; font-family: 'JetBrains Mono', monospace;">
                    <tr style="border-bottom: 2px solid #39ff14;">
                      <td style="padding: 10px;"><strong>Product</strong></td>
                      <td style="padding: 10px; text-align: right;"><strong>Revenue Source</strong></td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;">‚òï Beverages (coffee, tea, etc.)</td>
                      <td style="padding: 10px; text-align: right; color: var(--accent-gold);">$20B per year</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;">üç∞ Food (sandwiches, pastries)</td>
                      <td style="padding: 10px; text-align: right; color: var(--accent-gold);">$5B per year</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;">üõçÔ∏è Consumer Packaged Goods</td>
                      <td style="padding: 10px; text-align: right; color: var(--accent-gold);">$3B per year</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;">üéµ Licensing & Other</td>
                      <td style="padding: 10px; text-align: right; color: var(--accent-gold);">$4B per year</td>
                    </tr>
                    <tr style="border-top: 3px double #39ff14; background: rgba(57, 255, 20, 0.1);">
                      <td style="padding: 15px;"><strong style="font-size: 1.2rem;">TOTAL REVENUE</strong></td>
                      <td style="padding: 15px; text-align: right; color: #39ff14; font-size: 1.3rem;"><strong>$32B/year</strong></td>
                    </tr>
                  </table>
                </div>
                
                <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 12px; margin-top: 20px;">
                  <h5 style="color: var(--accent-gold); margin-bottom: 15px;">üßÆ Simple Calculation:</h5>
                  <p style="font-family: 'JetBrains Mono', monospace; font-size: 1.05rem; line-height: 2;">
                    ‚Ä¢ 35,000 stores worldwide<br>
                    ‚Ä¢ Average store: $1.5M revenue/year<br>
                    ‚Ä¢ Corporate/licensing: $12B<br>
                    = <strong style="color: #39ff14;">~$32 billion total revenue</strong>
                  </p>
                </div>
                
                <div style="background: rgba(57, 255, 20, 0.1); padding: 20px; border-radius: 12px; margin-top: 20px; border: 2px solid #39ff14;">
                  <h5 style="color: #39ff14; margin-bottom: 15px;">üìà What to Look For:</h5>
                  <ul style="line-height: 2; font-size: 1.05rem;">
                    <li><strong>Growing Revenue:</strong> Is it going up each year? Starbucks grew 12% last year ‚úÖ</li>
                    <li><strong>Consistent Revenue:</strong> Or does it jump around? Stable is better</li>
                    <li><strong>Revenue Sources:</strong> One product or diversified? Diversified = safer</li>
                    <li><strong>Geographic Mix:</strong> One country or global? Global = more opportunity</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <div class="expandable-card" onclick="toggleExpand(this)">
            <div class="expand-header">
              <span style="font-size: 1.3rem; font-weight: 600;">üí∞ PROFIT MARGINS - The Bottom Line</span>
              <span class="expand-icon">+</span>
            </div>
            <div class="expand-content">
              <p style="font-size: 1.1rem; line-height: 1.8; margin: 15px 0;">
                Revenue is great, but <strong>profit is what matters</strong>. A company can have $1 billion in revenue but lose money if expenses are $1.1 billion!
              </p>
              
              <div style="background: rgba(244, 196, 48, 0.1); padding: 25px; border-radius: 16px; margin: 20px 0; border-left: 4px solid var(--accent-gold);">
                <h4 style="color: var(--accent-gold); margin-bottom: 20px;">üé¨ The Margin Waterfall - Nike Example</h4>
                <p style="margin-bottom: 20px;">Let's follow $100 in Nike shoe sales through the income statement:</p>
                
                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px; font-family: 'JetBrains Mono', monospace;">
                  <div style="padding: 15px; background: rgba(57, 255, 20, 0.2); border-radius: 8px; margin-bottom: 15px;">
                    <div style="font-size: 1.2rem; margin-bottom: 5px;">
                      <strong>REVENUE (Top Line)</strong>
                      <span style="float: right; color: #39ff14; font-size: 1.4rem;">$100.00</span>
                    </div>
                    <small style="color: var(--text-secondary);">Customer pays $100 for Nike shoes</small>
                  </div>
                  
                  <div style="padding: 15px; border-left: 4px solid #ff6b6b; margin-bottom: 10px;">
                    <div style="margin-bottom: 5px;">
                      <strong>- Cost of Goods Sold (COGS)</strong>
                      <span style="float: right; color: #ff6b6b;">($55.00)</span>
                    </div>
                    <small style="color: var(--text-secondary); display: block; margin-top: 5px;">What it costs Nike to make the shoes:</small>
                    <ul style="font-size: 0.85rem; margin-top: 5px; list-style: none; padding-left: 20px;">
                      <li>‚Ä¢ Materials (leather, rubber, fabric): $25</li>
                      <li>‚Ä¢ Manufacturing labor in Vietnam: $15</li>
                      <li>‚Ä¢ Factory overhead: $10</li>
                      <li>‚Ä¢ Shipping from factory to warehouse: $5</li>
                    </ul>
                  </div>
                  
                  <div style="padding: 15px; background: rgba(57, 255, 20, 0.15); border-radius: 8px; margin-bottom: 15px; border: 2px solid #39ff14;">
                    <div style="font-size: 1.2rem;">
                      <strong>= GROSS PROFIT</strong>
                      <span style="float: right; color: #39ff14;">$45.00</span>
                    </div>
                    <div style="font-size: 0.9rem; margin-top: 5px; color: #39ff14;">
                      <strong>Gross Margin: 45%</strong> (Industry benchmark: 40-50% is excellent)
                    </div>
                    <small style="display: block; margin-top: 8px;">This is profit BEFORE operating expenses</small>
                  </div>
                  
                  <div style="padding: 15px; border-left: 4px solid #ff6b6b; margin-bottom: 10px;">
                    <div style="margin-bottom: 5px;">
                      <strong>- Operating Expenses</strong>
                      <span style="float: right; color: #ff6b6b;">($25.00)</span>
                    </div>
                    <small style="color: var(--text-secondary); display: block; margin-top: 5px;">Day-to-day business costs:</small>
                    <ul style="font-size: 0.85rem; margin-top: 5px; list-style: none; padding-left: 20px;">
                      <li>‚Ä¢ Marketing & Advertising (MJ, LeBron): $12</li>
                      <li>‚Ä¢ Salaries (designers, engineers, office): $6</li>
                      <li>‚Ä¢ R&D (new shoe tech): $3</li>
                      <li>‚Ä¢ Rent (offices, stores, warehouses): $2</li>
                      <li>‚Ä¢ Technology & IT: $2</li>
                    </ul>
                  </div>
                  
                  <div style="padding: 15px; background: rgba(244, 196, 48, 0.15); border-radius: 8px; margin-bottom: 15px; border: 2px solid var(--accent-gold);">
                    <div style="font-size: 1.2rem;">
                      <strong>= OPERATING PROFIT (EBIT)</strong>
                      <span style="float: right; color: var(--accent-gold);">$20.00</span>
                    </div>
                    <div style="font-size: 0.9rem; margin-top: 5px; color: var(--accent-gold);">
                      <strong>Operating Margin: 20%</strong> (Industry benchmark: 10-15% is good)
                    </div>
                    <small style="display: block; margin-top: 8px;">Profit from core business operations</small>
                  </div>
                  
                  <div style="padding: 15px; border-left: 4px solid #ff6b6b; margin-bottom: 10px;">
                    <div style="margin-bottom: 5px;">
                      <strong>- Interest & Taxes</strong>
                      <span style="float: right; color: #ff6b6b;">($5.00)</span>
                    </div>
                    <ul style="font-size: 0.85rem; margin-top: 5px; list-style: none; padding-left: 20px;">
                      <li>‚Ä¢ Interest on debt: $1</li>
                      <li>‚Ä¢ Income taxes (21% federal + state): $4</li>
                    </ul>
                  </div>
                  
                  <div style="padding: 20px; background: rgba(102, 126, 234, 0.2); border-radius: 8px; border: 3px solid var(--accent-purple);">
                    <div style="font-size: 1.4rem;">
                      <strong>= NET INCOME (Bottom Line)</strong>
                      <span style="float: right; color: var(--accent-purple); font-size: 1.6rem;">$15.00</span>
                    </div>
                    <div style="font-size: 1.1rem; margin-top: 5px; color: var(--accent-purple);">
                      <strong>Net Profit Margin: 15%</strong> (Excellent!)
                    </div>
                    <small style="display: block; margin-top: 10px; font-size: 0.95rem;">
                      This is the FINAL profit. For every $100 shoe sold, Nike keeps $15 as pure profit.
                    </small>
                  </div>
                </div>
                
                <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 12px; margin-top: 20px;">
                  <h5 style="color: #39ff14; margin-bottom: 15px;">üéØ What Good Margins Look Like:</h5>
                  <table style="width: 100%; border-collapse: collapse;">
                    <tr style="border-bottom: 2px solid rgba(255,255,255,0.2);">
                      <th style="padding: 10px; text-align: left;">Margin Type</th>
                      <th style="padding: 10px; text-align: center;">Poor</th>
                      <th style="padding: 10px; text-align: center;">Good</th>
                      <th style="padding: 10px; text-align: center;">Excellent</th>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;"><strong>Gross Margin</strong></td>
                      <td style="padding: 10px; text-align: center; color: #ff6b6b;">&lt;30%</td>
                      <td style="padding: 10px; text-align: center; color: var(--accent-gold);">40-50%</td>
                      <td style="padding: 10px; text-align: center; color: #39ff14;">&gt;60%</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;"><strong>Operating Margin</strong></td>
                      <td style="padding: 10px; text-align: center; color: #ff6b6b;">&lt;5%</td>
                      <td style="padding: 10px; text-align: center; color: var(--accent-gold);">10-15%</td>
                      <td style="padding: 10px; text-align: center; color: #39ff14;">&gt;25%</td>
                    </tr>
                    <tr>
                      <td style="padding: 10px;"><strong>Net Margin</strong></td>
                      <td style="padding: 10px; text-align: center; color: #ff6b6b;">&lt;5%</td>
                      <td style="padding: 10px; text-align: center; color: var(--accent-gold);">10-15%</td>
                      <td style="padding: 10px; text-align: center; color: #39ff14;">&gt;20%</td>
                    </tr>
                  </table>
                  
                  <div style="margin-top: 20px; padding: 15px; background: rgba(57, 255, 20, 0.1); border-radius: 8px;">
                    <h5 style="color: #39ff14; margin-bottom: 10px;">üí° Real Company Examples:</h5>
                    <ul style="line-height: 2;">
                      <li><strong>Apple:</strong> 45% gross, 30% operating, 26% net = üåü AMAZING</li>
                      <li><strong>Amazon:</strong> 48% gross, 6% operating, 3% net = Growth mode (reinvesting)</li>
                      <li><strong>Walmart:</strong> 24% gross, 4% operating, 2% net = Low margin, high volume</li>
                      <li><strong>Microsoft:</strong> 69% gross, 42% operating, 36% net = üöÄ SOFTWARE POWER</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="expandable-card" onclick="toggleExpand(this)">
            <div class="expand-header">
              <span style="font-size: 1.3rem; font-weight: 600;">üí∏ CASH FLOW - Real Money Movement</span>
              <span class="expand-icon">+</span>
            </div>
            <div class="expand-content">
              <div style="background: rgba(167, 139, 250, 0.1); padding: 20px; border-radius: 12px; margin: 20px 0; border-left: 4px solid var(--accent-purple);">
                <h4 style="color: var(--accent-purple); margin-bottom: 15px;">ü§î Why Cash Flow Matters MORE Than Profit</h4>
                <p style="font-size: 1.1rem; line-height: 1.8;">
                  A company can show "$100M profit" on paper but have <strong>$0 in the bank</strong>. How? Because profit uses accounting rules. Cash flow shows REAL money.
                </p>
              </div>
              
              <div style="background: linear-gradient(135deg, rgba(244, 196, 48, 0.15), rgba(251, 191, 36, 0.15)); padding: 25px; border-radius: 16px; margin: 20px 0;">
                <h4 style="color: var(--accent-gold); margin-bottom: 20px;">üé¨ Real Example: Why Paper Profit ‚â† Real Cash</h4>
                
                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px; margin: 15px 0;">
                  <h5 style="color: #ff6b6b; margin-bottom: 15px;">‚ö†Ô∏è The Problem:</h5>
                  <p style="font-size: 1.05rem; line-height: 1.8;">
                    <strong>Company XYZ Income Statement (Paper Profit):</strong><br>
                    Revenue: $10M ‚úÖ<br>
                    Expenses: $7M<br>
                    <strong style="color: #39ff14;">Net Income: $3M profit! üéâ</strong>
                  </p>
                  
                  <p style="margin-top: 20px; font-size: 1.05rem; line-height: 1.8;">
                    <strong>But their Bank Account (Real Cash):</strong><br>
                    Cash received from customers: $6M (customers haven't paid yet!)<br>
                    Cash paid to suppliers: $8M (had to pay suppliers upfront)<br>
                    <strong style="color: #ff6b6b;">Net Cash: -$2M LOSS! üò±</strong>
                  </p>
                  
                  <div style="background: rgba(255, 107, 107, 0.2); padding: 15px; border-radius: 8px; margin-top: 20px; border: 2px solid #ff6b6b;">
                    <strong style="color: #ff6b6b;">Result:</strong> Company shows $3M profit but is running out of cash and might go bankrupt!
                  </div>
                </div>
                
                <div style="background: rgba(57, 255, 20, 0.1); padding: 20px; border-radius: 12px; margin: 15px 0; border: 2px solid #39ff14;">
                  <h5 style="color: #39ff14; margin-bottom: 15px;">‚úÖ This is why CASH FLOW is critical!</h5>
                  <p style="font-size: 1.05rem; line-height: 1.8;">
                    Cash Flow Statement shows the ACTUAL money moving in and out. It tells you if a company will survive or need to borrow money to stay alive.
                  </p>
                </div>
              </div>
              
              <div style="background: rgba(0,0,0,0.3); padding: 25px; border-radius: 12px; margin: 20px 0;">
                <h4 style="color: var(--accent-purple); margin-bottom: 20px;">üìä Understanding Cash Flow - Tesla Example (2024)</h4>
                
                <div style="padding: 20px; background: rgba(57, 255, 20, 0.1); border-radius: 10px; margin-bottom: 20px;">
                  <h5 style="color: #39ff14; font-size: 1.2rem; margin-bottom: 15px;">1Ô∏è‚É£ Operating Cash Flow (OCF)</h5>
                  <p style="margin-bottom: 15px;"><strong>What it is:</strong> Cash from day-to-day business operations</p>
                  
                  <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.95rem; background: rgba(0,0,0,0.5); padding: 15px; border-radius: 8px;">
                    <div style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                      Net Income (from Income Statement)
                      <span style="float: right; color: var(--accent-gold);">+$7.9B</span>
                    </div>
                    <div style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                      + Depreciation (non-cash expense)
                      <span style="float: right; color: #39ff14;">+$3.5B</span>
                    </div>
                    <div style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                      + Stock-based compensation
                      <span style="float: right; color: #39ff14;">+$2.0B</span>
                    </div>
                    <div style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                      - Increase in inventory (built up cars)
                      <span style="float: right; color: #ff6b6b;">-$1.5B</span>
                    </div>
                    <div style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                      - Increase in accounts receivable
                      <span style="float: right; color: #ff6b6b;">-$0.8B</span>
                    </div>
                    <div style="padding: 15px; background: rgba(57, 255, 20, 0.2); margin-top: 10px; border-radius: 8px;">
                      <strong style="font-size: 1.1rem;">= Operating Cash Flow</strong>
                      <span style="float: right; color: #39ff14; font-size: 1.2rem;"><strong>+$11.1B</strong></span>
                    </div>
                  </div>
                  
                  <div style="background: rgba(57, 255, 20, 0.1); padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <strong style="color: #39ff14;">üí° What this means:</strong> Tesla's core business generated $11.1B REAL cash in 2024. This is healthy! ‚úÖ
                  </div>
                </div>
                
                <div style="padding: 20px; background: rgba(244, 196, 48, 0.1); border-radius: 10px; margin-bottom: 20px;">
                  <h5 style="color: var(--accent-gold); font-size: 1.2rem; margin-bottom: 15px;">2Ô∏è‚É£ Investing Cash Flow</h5>
                  <p style="margin-bottom: 15px;"><strong>What it is:</strong> Cash spent on long-term investments (growing the business)</p>
                  
                  <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.95rem; background: rgba(0,0,0,0.5); padding: 15px; border-radius: 8px;">
                    <div style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                      - Capital Expenditures (CapEx)
                      <span style="float: right; color: #ff6b6b;">-$8.9B</span>
                      <br><small style="color: var(--text-secondary);">New factories (Gigafactory Texas, Berlin expansion), machinery</small>
                    </div>
                    <div style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                      - Acquisitions
                      <span style="float: right; color: #ff6b6b;">-$0.5B</span>
                      <br><small style="color: var(--text-secondary);">Buying battery tech companies</small>
                    </div>
                    <div style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                      - Investment in securities
                      <span style="float: right; color: #ff6b6b;">-$1.0B</span>
                    </div>
                    <div style="padding: 15px; background: rgba(244, 196, 48, 0.2); margin-top: 10px; border-radius: 8px;">
                      <strong style="font-size: 1.1rem;">= Investing Cash Flow</strong>
                      <span style="float: right; color: #ff6b6b; font-size: 1.2rem;"><strong>-$10.4B</strong></span>
                    </div>
                  </div>
                  
                  <div style="background: rgba(244, 196, 48, 0.1); padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <strong style="color: var(--accent-gold);">üí° What this means:</strong> Tesla spent $10.4B building new factories and growing. This is GOOD - they're investing in future growth! ‚úÖ
                  </div>
                </div>
                
                <div style="padding: 20px; background: rgba(102, 126, 234, 0.1); border-radius: 10px; margin-bottom: 20px;">
                  <h5 style="color: var(--accent-purple); font-size: 1.2rem; margin-bottom: 15px;">3Ô∏è‚É£ Financing Cash Flow</h5>
                  <p style="margin-bottom: 15px;"><strong>What it is:</strong> Cash from/to investors and lenders</p>
                  
                  <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.95rem; background: rgba(0,0,0,0.5); padding: 15px; border-radius: 8px;">
                    <div style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                      + Borrowing (new debt)
                      <span style="float: right; color: #39ff14;">+$2.0B</span>
                    </div>
                    <div style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                      - Debt repayment
                      <span style="float: right; color: #ff6b6b;">-$1.5B</span>
                    </div>
                    <div style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                      - Stock buybacks
                      <span style="float: right; color: #ff6b6b;">-$1.0B</span>
                    </div>
                    <div style="padding: 15px; background: rgba(102, 126, 234, 0.2); margin-top: 10px; border-radius: 8px;">
                      <strong style="font-size: 1.1rem;">= Financing Cash Flow</strong>
                      <span style="float: right; color: #ff6b6b; font-size: 1.2rem;"><strong>-$0.5B</strong></span>
                    </div>
                  </div>
                </div>
                
                <div style="padding: 25px; background: rgba(57, 255, 20, 0.15); border-radius: 12px; border: 3px solid #39ff14;">
                  <h5 style="color: #39ff14; font-size: 1.3rem; margin-bottom: 15px;">üìä NET CHANGE IN CASH</h5>
                  <div style="font-family: 'JetBrains Mono', monospace; font-size: 1.1rem;">
                    <div>Operating CF: <span style="float: right; color: #39ff14;">+$11.1B</span></div>
                    <div>Investing CF: <span style="float: right; color: #ff6b6b;">-$10.4B</span></div>
                    <div>Financing CF: <span style="float: right; color: #ff6b6b;">-$0.5B</span></div>
                    <div style="border-top: 3px double #39ff14; margin-top: 10px; padding-top: 10px; font-size: 1.3rem;">
                      <strong>Net Change:</strong>
                      <span style="float: right; color: #39ff14;"><strong>+$0.2B</strong></span>
                    </div>
                  </div>
                  
                  <div style="margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 8px;">
                    <strong style="color: #39ff14;">‚úÖ Healthy Cash Flow!</strong>
                    <p style="margin-top: 10px; line-height: 1.8;">
                      Tesla generated $11B from operations, invested $10B in growth, and still increased cash by $200M. This is a financially healthy, growing company!
                    </p>
                  </div>
                </div>
              </div>
              
              <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 12px; margin-top: 25px; border: 2px solid var(--accent-gold);">
                <h5 style="color: var(--accent-gold); margin-bottom: 15px;">üö® Red Flags to Watch For:</h5>
                <ul style="line-height: 2; font-size: 1.05rem;">
                  <li><strong>Negative Operating CF:</strong> Company burning cash from core business ‚ùå</li>
                  <li><strong>OCF < Net Income:</strong> "Profit" might be accounting tricks ‚ö†Ô∏è</li>
                  <li><strong>Constantly raising debt:</strong> Need money to survive üö©</li>
                  <li><strong>Free Cash Flow negative for years:</strong> Can't sustain without investors ‚õî</li>
                </ul>
              </div>
            </div>
          </div>

          <h3 style="font-size: 2rem; margin: 40px 0 20px; color: var(--accent-purple);">3Ô∏è‚É£ Valuation - Is the Price Right?</h3>

          <div class="expandable-card" onclick="toggleExpand(this)">
            <div class="expand-header">
              <span style="font-size: 1.3rem; font-weight: 600;">üìä P/E Ratio - The Most Common Metric</span>
              <span class="expand-icon">+</span>
            </div>
            <div class="expand-content">
              <div style="background: rgba(102, 126, 234, 0.1); padding: 20px; border-radius: 12px; margin: 20px 0; border-left: 4px solid var(--accent-purple);">
                <h4 style="color: var(--accent-purple); margin-bottom: 15px;">üìñ What is P/E Ratio?</h4>
                <p style="font-size: 1.1rem; line-height: 1.8;">
                  <strong>Price-to-Earnings (P/E) Ratio</strong> tells you how much you're paying for each dollar of profit. Think of it like: "How many years of earnings does this stock cost?"
                </p>
              </div>
              
              <div style="background: linear-gradient(135deg, rgba(167, 139, 250, 0.15), rgba(139, 92, 246, 0.15)); padding: 25px; border-radius: 16px; margin: 20px 0;">
                <h4 style="color: var(--accent-purple); margin-bottom: 20px;">üé¨ Real Example: Comparing Two Restaurants</h4>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                  <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px; border: 2px solid #39ff14;">
                    <h5 style="color: #39ff14; margin-bottom: 15px;">üçî Restaurant A</h5>
                    <div style="font-family: 'JetBrains Mono', monospace; line-height: 2;">
                      <div>Stock Price: <span style="float: right;">$50</span></div>
                      <div>Earnings Per Share: <span style="float: right;">$5</span></div>
                      <div style="border-top: 2px solid #39ff14; margin-top: 10px; padding-top: 10px; font-size: 1.2rem;">
                        <strong>P/E Ratio:</strong>
                        <span style="float: right; color: #39ff14;"><strong>10</strong></span>
                      </div>
                    </div>
                    <p style="margin-top: 15px; font-size: 0.95rem;">
                      Paying $50 for $5 in annual earnings = 10 years to "pay back" investment
                    </p>
                  </div>
                  
                  <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px; border: 2px solid var(--accent-gold);">
                    <h5 style="color: var(--accent-gold); margin-bottom: 15px;">üçï Restaurant B</h5>
                    <div style="font-family: 'JetBrains Mono', monospace; line-height: 2;">
                      <div>Stock Price: <span style="float: right;">$100</span></div>
                      <div>Earnings Per Share: <span style="float: right;">$2</span></div>
                      <div style="border-top: 2px solid var(--accent-gold); margin-top: 10px; padding-top: 10px; font-size: 1.2rem;">
                        <strong>P/E Ratio:</strong>
                        <span style="float: right; color: var(--accent-gold);"><strong>50</strong></span>
                      </div>
                    </div>
                    <p style="margin-top: 15px; font-size: 0.95rem;">
                      Paying $100 for $2 in annual earnings = 50 years to "pay back" investment
                    </p>
                  </div>
                </div>
                
                <div style="background: rgba(57, 255, 20, 0.1); padding: 20px; border-radius: 12px; margin-top: 20px; border: 2px solid #39ff14;">
                  <h5 style="color: #39ff14; margin-bottom: 15px;">üí° Which is Better Value?</h5>
                  <p style="font-size: 1.1rem; line-height: 1.8;">
                    <strong>Restaurant A (P/E = 10)</strong> looks cheaper! But wait... Restaurant B might be growing 50% per year while A is growing 5%. High P/E can be justified by high growth!
                  </p>
                  
                  <table style="width: 100%; margin-top: 20px; border-collapse: collapse;">
                    <tr style="border-bottom: 2px solid rgba(255,255,255,0.2);">
                      <th style="padding: 10px; text-align: left;">P/E Range</th>
                      <th style="padding: 10px;">Interpretation</th>
                      <th style="padding: 10px;">Examples</th>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;"><strong style="color: #39ff14;">&lt;15</strong></td>
                      <td style="padding: 10px;">Undervalued or slow growth</td>
                      <td style="padding: 10px; font-size: 0.9rem;">Banks, utilities, mature companies</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;"><strong style="color: var(--accent-gold);">15-25</strong></td>
                      <td style="padding: 10px;">Fair value, market average</td>
                      <td style="padding: 10px; font-size: 0.9rem;">S&P 500 average ~20</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;"><strong style="color: var(--accent-purple);">25-40</strong></td>
                      <td style="padding: 10px;">Growth stock premium</td>
                      <td style="padding: 10px; font-size: 0.9rem;">Tech companies, fast growers</td>
                    </tr>
                    <tr>
                      <td style="padding: 10px;"><strong style="color: #ff6b6b;">&gt;40</strong></td>
                      <td style="padding: 10px;">Very expensive or hyper-growth</td>
                      <td style="padding: 10px; font-size: 0.9rem;">Tesla (P/E ~70), unprofitable startups</td>
                    </tr>
                  </table>
                </div>
              </div>
            </div>
          </div>

          <div style="background: linear-gradient(135deg, rgba(57, 255, 20, 0.2), rgba(34, 197, 94, 0.2)); padding: 30px; border-radius: 16px; margin: 40px 0; border: 3px solid #39ff14;">
            <h3 style="color: #39ff14; margin-bottom: 20px; font-size: 1.8rem;">üéì Lesson Complete!</h3>
            <p style="font-size: 1.1rem; line-height: 1.8; margin-bottom: 20px;">
              You now understand the Three Pillars of Stock Analysis! You learned:
            </p>
            <ul style="line-height: 2; font-size: 1.05rem; margin-bottom: 25px;">
              <li>‚úÖ Business Understanding: What companies do and their competitive moats</li>
              <li>‚úÖ Financial Health: Revenue, profits, margins, and cash flow with real examples</li>
              <li>‚úÖ Valuation: How to tell if a stock price is fair using P/E ratios</li>
              <li>‚úÖ Real Company Examples: Nike, Tesla, Starbucks, Apple, and more</li>
            </ul>
            
            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
              <button class="control-btn" onclick="backToModules()">‚Üê Back to Modules</button>
              <button class="control-btn" onclick="openFlashcardModal()" style="background: rgba(244, 196, 48, 0.2); border-color: var(--accent-gold);">
                üìö Create Flashcard
              </button>
            </div>
          </div>
        </div>
      `;
    }
    function generateFinancialsLesson() {
      return `
        <div class="lesson-container">
          <button onclick="backToModules()" style="background: rgba(57, 255, 20, 0.1); border: 2px solid #39ff14; color: #39ff14; padding: 10px 20px; border-radius: 8px; cursor: pointer; margin-bottom: 20px; font-weight: 600;">
            ‚Üê Back to Modules
          </button>
          
          <h2>üìä Financial Statements - The Complete Guide</h2>
          
          <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15)); padding: 25px; border-radius: 16px; margin: 20px 0; border-left: 4px solid var(--accent-purple);">
            <p style="font-size: 1.1rem; line-height: 1.8; margin: 0;">
              üéØ <strong>Learning Goal:</strong> Master all three financial statements line by line. Understand EVERY term from depreciation to deferred revenue. Use real company examples to see how it all fits together.
            </p>
          </div>

          <div style="background: rgba(57, 255, 20, 0.05); padding: 20px; border-radius: 12px; margin: 30px 0; border: 2px solid #39ff14;">
            <h3 style="color: #39ff14; margin-bottom: 15px;">üìö The Three Financial Statements:</h3>
            <ol style="font-size: 1.1rem; line-height: 2;">
              <li><strong style="color: var(--accent-gold);">Income Statement (P&L):</strong> How much profit did we make?</li>
              <li><strong style="color: var(--accent-emerald);">Balance Sheet:</strong> What do we own and owe?</li>
              <li><strong style="color: var(--accent-purple);">Cash Flow Statement:</strong> Where did cash come from and go?</li>
            </ol>
            <p style="margin-top: 15px; font-style: italic; color: var(--text-secondary);">
              These three statements tell the complete story of a company's financial health. Let's master them!
            </p>
          </div>

          <h3 style="font-size: 2rem; margin: 40px 0 20px; color: var(--accent-gold);">1Ô∏è‚É£ Income Statement (P&L) - Line by Line</h3>

          <div class="expandable-card" onclick="toggleExpand(this)">
            <div class="expand-header">
              <span style="font-size: 1.3rem; font-weight: 600;">üí∞ REVENUE - Every Source Explained</span>
              <span class="expand-icon">+</span>
            </div>
            <div class="expand-content">
              <p style="font-size: 1.1rem; line-height: 1.8; margin: 15px 0;">
                Revenue is ALL money the company receives from customers. Let's break down every type:
              </p>
              
              <div style="background: linear-gradient(135deg, rgba(57, 255, 20, 0.15), rgba(34, 197, 94, 0.15)); padding: 25px; border-radius: 16px; margin: 20px 0;">
                <h4 style="color: #39ff14; margin-bottom: 20px;">üé¨ Amazon Revenue Breakdown (2024)</h4>
                
                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px;">
                  <table style="width: 100%; border-collapse: collapse; font-family: 'JetBrains Mono', monospace;">
                    <tr style="border-bottom: 2px solid #39ff14;">
                      <th style="padding: 10px; text-align: left;">Revenue Source</th>
                      <th style="padding: 10px; text-align: right;">Amount</th>
                      <th style="padding: 10px;">How They Earn It</th>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;">üõí <strong>Product Sales</strong></td>
                      <td style="padding: 10px; text-align: right; color: var(--accent-gold);">$255B</td>
                      <td style="padding: 10px; font-size: 0.9rem;">Physical goods sold on Amazon.com</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;">üè™ <strong>Third-Party Seller Services</strong></td>
                      <td style="padding: 10px; text-align: right; color: var(--accent-gold);">$140B</td>
                      <td style="padding: 10px; font-size: 0.9rem;">Fees from merchants using Amazon's platform</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;">‚òÅÔ∏è <strong>AWS (Cloud Services)</strong></td>
                      <td style="padding: 10px; text-align: right; color: var(--accent-gold);">$90B</td>
                      <td style="padding: 10px; font-size: 0.9rem;">Companies paying for cloud computing</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;">üì∫ <strong>Prime Subscriptions</strong></td>
                      <td style="padding: 10px; text-align: right; color: var(--accent-gold);">$40B</td>
                      <td style="padding: 10px; font-size: 0.9rem;">$139/year √ó 300M members</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;">üì¢ <strong>Advertising</strong></td>
                      <td style="padding: 10px; text-align: right; color: var(--accent-gold);">$47B</td>
                      <td style="padding: 10px; font-size: 0.9rem;">Brands paying for ads on Amazon</td>
                    </tr>
                    <tr style="border-top: 3px double #39ff14; background: rgba(57, 255, 20, 0.1);">
                      <td style="padding: 15px;"><strong style="font-size: 1.2rem;">TOTAL REVENUE</strong></td>
                      <td style="padding: 15px; text-align: right; color: #39ff14; font-size: 1.3rem;"><strong>$572B</strong></td>
                      <td style="padding: 15px; font-size: 0.9rem;">All income sources combined</td>
                    </tr>
                  </table>
                </div>
                
                <div style="background: rgba(57, 255, 20, 0.1); padding: 20px; border-radius: 12px; margin-top: 20px; border: 2px solid #39ff14;">
                  <h5 style="color: #39ff14; margin-bottom: 15px;">üí° Key Concepts:</h5>
                  <ul style="line-height: 2; font-size: 1.05rem;">
                    <li><strong>Product Revenue:</strong> Selling physical/digital products directly</li>
                    <li><strong>Service Revenue:</strong> Ongoing services (AWS cloud, Prime membership)</li>
                    <li><strong>Commission Revenue:</strong> Taking a % cut (3rd party sellers pay 15% commission)</li>
                    <li><strong>Advertising Revenue:</strong> Selling ad space to brands</li>
                    <li><strong>Recurring vs One-time:</strong> AWS & Prime = recurring (predictable!), Products = one-time</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <div class="expandable-card" onclick="toggleExpand(this)">
            <div class="expand-header">
              <span style="font-size: 1.3rem; font-weight: 600;">üì¶ COST OF GOODS SOLD (COGS) - What It Really Costs</span>
              <span class="expand-icon">+</span>
            </div>
            <div class="expand-content">
              <p style="font-size: 1.1rem; line-height: 1.8; margin: 15px 0;">
                <strong>COGS</strong> is the <strong>direct cost</strong> to produce what you sell. For physical products, it's materials and labor. For services, it's delivery costs.
              </p>
              
              <div style="background: linear-gradient(135deg, rgba(244, 196, 48, 0.15), rgba(251, 191, 36, 0.15)); padding: 25px; border-radius: 16px; margin: 20px 0;">
                <h4 style="color: var(--accent-gold); margin-bottom: 20px;">üé¨ Example: Making an iPhone</h4>
                
                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px;">
                  <div style="padding: 15px; background: rgba(57, 255, 20, 0.1); border-radius: 8px; margin-bottom: 15px;">
                    <strong style="color: #39ff14; font-size: 1.2rem;">Selling Price: $999</strong>
                  </div>
                  
                  <h5 style="color: var(--accent-gold); margin: 15px 0;">What's Included in COGS:</h5>
                  <table style="width: 100%; border-collapse: collapse; font-size: 0.95rem;">
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 8px;">üî© Display (OLED screen)</td>
                      <td style="padding: 8px; text-align: right; color: #ff6b6b;">$110</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 8px;">üíæ A17 Processor chip</td>
                      <td style="padding: 8px; text-align: right; color: #ff6b6b;">$65</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 8px;">üì∏ Camera modules</td>
                      <td style="padding: 8px; text-align: right; color: #ff6b6b;">$75</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 8px;">üîã Battery</td>
                      <td style="padding: 8px; text-align: right; color: #ff6b6b;">$15</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 8px;">üì¶ Casing, glass, other components</td>
                      <td style="padding: 8px; text-align: right; color: #ff6b6b;">$80</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 8px;">üë∑ Assembly labor (Foxconn factory)</td>
                      <td style="padding: 8px; text-align: right; color: #ff6b6b;">$25</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 8px;">üö¢ Shipping to Apple warehouse</td>
                      <td style="padding: 8px; text-align: right; color: #ff6b6b;">$10</td>
                    </tr>
                    <tr style="border-top: 2px solid #ff6b6b;">
                      <td style="padding: 10px;"><strong>Total COGS</strong></td>
                      <td style="padding: 10px; text-align: right; color: #ff6b6b; font-size: 1.2rem;"><strong>$380</strong></td>
                    </tr>
                  </table>
                  
                  <div style="padding: 15px; background: rgba(57, 255, 20, 0.1); border-radius: 8px; margin-top: 15px;">
                    <strong style="color: #39ff14;">Gross Profit: $999 - $380 = $619 per iPhone!</strong><br>
                    <small style="color: var(--text-secondary);">That's 62% gross margin - incredible!</small>
                  </div>
                </div>
                
                <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 12px; margin-top: 20px;">
                  <h5 style="color: var(--accent-gold); margin-bottom: 15px;">‚ùå What's NOT in COGS:</h5>
                  <ul style="line-height: 2;">
                    <li>‚úó Marketing costs (those go in Operating Expenses)</li>
                    <li>‚úó Retail store salaries (Operating Expenses)</li>
                    <li>‚úó R&D for next iPhone (Operating Expenses)</li>
                    <li>‚úó Corporate office rent (Operating Expenses)</li>
                  </ul>
                  <p style="margin-top: 15px; padding: 15px; background: rgba(57, 255, 20, 0.1); border-radius: 8px;">
                    <strong style="color: #39ff14;">Rule of thumb:</strong> If it's DIRECTLY tied to making the product, it's COGS. If it's general business operations, it's Operating Expenses.
                  </p>
                </div>
              </div>
            </div>
          </div>

          <div class="expandable-card" onclick="toggleExpand(this)">
            <div class="expand-header">
              <span style="font-size: 1.3rem; font-weight: 600;">üè¢ OPERATING EXPENSES - Running the Business</span>
              <span class="expand-icon">+</span>
            </div>
            <div class="expand-content">
              <p style="font-size: 1.1rem; line-height: 1.8; margin: 15px 0;">
                <strong>Operating Expenses (OpEx)</strong> are costs to run the business that aren't directly tied to making products. Three main categories:
              </p>
              
              <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(139, 92, 246, 0.15)); padding: 25px; border-radius: 16px; margin: 20px 0;">
                <h4 style="color: var(--accent-purple); margin-bottom: 20px;">üé¨ Google Operating Expenses (2024)</h4>
                
                <div style="display: grid; gap: 20px;">
                  <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px; border-left: 4px solid #39ff14;">
                    <h5 style="color: #39ff14; font-size: 1.2rem; margin-bottom: 15px;">1Ô∏è‚É£ R&D (Research & Development)</h5>
                    <p style="margin-bottom: 15px;"><strong style="color: var(--accent-gold);">$45.4 billion</strong></p>
                    <ul style="line-height: 2; font-size: 0.95rem;">
                      <li>üë®‚Äçüíª Engineer salaries (200,000+ employees at $150K avg)</li>
                      <li>ü§ñ AI research (DeepMind, Gemini development)</li>
                      <li>üíª Data centers for training AI models</li>
                      <li>üî¨ Hardware R&D (Pixel phones, quantum computing)</li>
                      <li>üß™ Experimental projects (self-driving cars, drones)</li>
                    </ul>
                    <div style="background: rgba(57, 255, 20, 0.1); padding: 15px; border-radius: 8px; margin-top: 15px;">
                      <strong>Why so high?</strong> Google invests 15% of revenue into R&D to stay ahead. Tech companies MUST innovate or die.
                    </div>
                  </div>
                  
                  <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px; border-left: 4px solid var(--accent-gold);">
                    <h5 style="color: var(--accent-gold); font-size: 1.2rem; margin-bottom: 15px;">2Ô∏è‚É£ Sales & Marketing (S&M)</h5>
                    <p style="margin-bottom: 15px;"><strong style="color: var(--accent-gold);">$27.9 billion</strong></p>
                    <ul style="line-height: 2; font-size: 0.95rem;">
                      <li>üì∫ Advertising (YouTube ads, Pixel commercials)</li>
                      <li>üëî Sales team salaries (selling Google Cloud to businesses)</li>
                      <li>üéØ Marketing campaigns (brand awareness)</li>
                      <li>üé™ Events & conferences (Google I/O conference)</li>
                      <li>üíº Partnership deals (paying Apple $15B to be default search)</li>
                    </ul>
                    <div style="background: rgba(244, 196, 48, 0.1); padding: 15px; border-radius: 8px; margin-top: 15px;">
                      <strong>Key metric:</strong> S&M as % of revenue. Google = 9% (efficient!). Some SaaS companies spend 50%+
                    </div>
                  </div>
                  
                  <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px; border-left: 4px solid var(--accent-purple);">
                    <h5 style="color: var(--accent-purple); font-size: 1.2rem; margin-bottom: 15px;">3Ô∏è‚É£ General & Administrative (G&A)</h5>
                    <p style="margin-bottom: 15px;"><strong style="color: var(--accent-gold);">$16.4 billion</strong></p>
                    <ul style="line-height: 2; font-size: 0.95rem;">
                      <li>üè¢ Office rent (Googleplex campus, offices worldwide)</li>
                      <li>üëî Executive salaries (CEO, CFO, legal team)</li>
                      <li>‚öñÔ∏è Legal fees (lawsuits, regulatory compliance)</li>
                      <li>üíº HR & recruiting (hiring thousands of employees)</li>
                      <li>üñ•Ô∏è IT & infrastructure (internal systems)</li>
                      <li>üìä Accounting & finance teams</li>
                    </ul>
                    <div style="background: rgba(167, 139, 250, 0.1); padding: 15px; border-radius: 8px; margin-top: 15px;">
                      <strong>Rule:</strong> G&A should be <10% of revenue. If higher, company is bloated/inefficient.
                    </div>
                  </div>
                </div>
                
                <div style="background: rgba(0,0,0,0.4); padding: 20px; border-radius: 12px; margin-top: 20px; border: 2px solid var(--accent-purple);">
                  <h5 style="color: var(--accent-purple); margin-bottom: 15px;">üìä Total Operating Expenses:</h5>
                  <div style="font-family: 'JetBrains Mono', monospace; font-size: 1.1rem;">
                    <div>R&D: <span style="float: right; color: #ff6b6b;">$45.4B</span></div>
                    <div>S&M: <span style="float: right; color: #ff6b6b;">$27.9B</span></div>
                    <div>G&A: <span style="float: right; color: #ff6b6b;">$16.4B</span></div>
                    <div style="border-top: 2px solid var(--accent-purple); margin-top: 10px; padding-top: 10px; font-size: 1.3rem;">
                      <strong>Total OpEx:</strong>
                      <span style="float: right; color: #ff6b6b;"><strong>$89.7B</strong></span>
                    </div>
                    <div style="margin-top: 15px; padding: 15px; background: rgba(57, 255, 20, 0.1); border-radius: 8px;">
                      Revenue: $307B<br>
                      COGS: $134B<br>
                      Gross Profit: $173B<br>
                      - Operating Expenses: $89.7B<br>
                      = <strong style="color: #39ff14; font-size: 1.2rem;">Operating Income: $83.3B</strong>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="expandable-card" onclick="toggleExpand(this)">
            <div class="expand-header">
              <span style="font-size: 1.3rem; font-weight: 600;">üìâ DEPRECIATION & AMORTIZATION - Non-Cash Expenses</span>
              <span class="expand-icon">+</span>
            </div>
            <div class="expand-content">
              <div style="background: rgba(244, 196, 48, 0.1); padding: 20px; border-radius: 12px; margin: 20px 0; border-left: 4px solid var(--accent-gold);">
                <h4 style="color: var(--accent-gold); margin-bottom: 15px;">ü§î What is Depreciation?</h4>
                <p style="font-size: 1.1rem; line-height: 1.8;">
                  When you buy expensive equipment, you don't expense it all at once. You "spread out" the cost over its useful life. This is called <strong>depreciation</strong>.
                </p>
              </div>
              
              <div style="background: linear-gradient(135deg, rgba(57, 255, 20, 0.15), rgba(34, 197, 94, 0.15)); padding: 25px; border-radius: 16px; margin: 20px 0;">
                <h4 style="color: #39ff14; margin-bottom: 20px;">üé¨ Real Example: FedEx Buys Delivery Truck</h4>
                
                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px;">
                  <h5 style="color: var(--accent-gold); margin-bottom: 15px;">üöö The Purchase:</h5>
                  <p style="font-size: 1.05rem; line-height: 1.8;">
                    FedEx buys a delivery truck for <strong style="color: #39ff14;">$100,000</strong> cash in 2024.
                  </p>
                  
                  <div style="background: rgba(255, 107, 107, 0.2); padding: 15px; border-radius: 8px; margin: 15px 0; border: 2px solid #ff6b6b;">
                    <strong style="color: #ff6b6b;">‚ùå WRONG Way (What Beginners Think):</strong><br><br>
                    Income Statement 2024:<br>
                    - Expense: $100,000 truck purchase<br>
                    = Huge loss in 2024<br><br>
                    Then $0 expense for next 9 years even though they're using the truck!
                  </div>
                  
                  <div style="background: rgba(57, 255, 20, 0.2); padding: 15px; border-radius: 8px; margin: 15px 0; border: 2px solid #39ff14;">
                    <strong style="color: #39ff14;">‚úÖ CORRECT Way (Depreciation):</strong><br><br>
                    Truck will last 10 years.<br>
                    Depreciation per year: $100,000 √∑ 10 = <strong>$10,000/year</strong><br><br>
                    
                    <table style="width: 100%; margin-top: 15px; border-collapse: collapse; font-family: 'JetBrains Mono', monospace;">
                      <tr style="border-bottom: 2px solid #39ff14;">
                        <th style="padding: 8px;">Year</th>
                        <th style="padding: 8px; text-align: right;">Cash Paid</th>
                        <th style="padding: 8px; text-align: right;">Depreciation Expense</th>
                        <th style="padding: 8px; text-align: right;">Book Value</th>
                      </tr>
                      <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <td style="padding: 8px;">2024 (purchase)</td>
                        <td style="padding: 8px; text-align: right; color: #ff6b6b;">$100,000</td>
                        <td style="padding: 8px; text-align: right; color: var(--accent-gold);">$10,000</td>
                        <td style="padding: 8px; text-align: right;">$90,000</td>
                      </tr>
                      <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <td style="padding: 8px;">2025</td>
                        <td style="padding: 8px; text-align: right;">$0</td>
                        <td style="padding: 8px; text-align: right; color: var(--accent-gold);">$10,000</td>
                        <td style="padding: 8px; text-align: right;">$80,000</td>
                      </tr>
                      <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <td style="padding: 8px;">2026</td>
                        <td style="padding: 8px; text-align: right;">$0</td>
                        <td style="padding: 8px; text-align: right; color: var(--accent-gold);">$10,000</td>
                        <td style="padding: 8px; text-align: right;">$70,000</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px;">... (continue 7 more years)</td>
                        <td style="padding: 8px;"></td>
                        <td style="padding: 8px; text-align: right; color: var(--accent-gold);">$10,000/yr</td>
                        <td style="padding: 8px;"></td>
                      </tr>
                      <tr style="border-top: 2px solid #39ff14;">
                        <td style="padding: 8px;">2033 (end)</td>
                        <td style="padding: 8px; text-align: right;">$0</td>
                        <td style="padding: 8px; text-align: right; color: var(--accent-gold);">$10,000</td>
                        <td style="padding: 8px; text-align: right;">$0</td>
                      </tr>
                    </table>
                  </div>
                  
                  <div style="background: rgba(57, 255, 20, 0.1); padding: 20px; border-radius: 12px; margin-top: 20px; border: 2px solid #39ff14;">
                    <h5 style="color: #39ff14; margin-bottom: 15px;">üí° Why This Matters:</h5>
                    <ul style="line-height: 2;">
                      <li><strong>Cash Flow:</strong> FedEx paid $100K cash in 2024 (shows in Cash Flow Statement)</li>
                      <li><strong>Income Statement:</strong> Only $10K expense per year for 10 years (matches usage)</li>
                      <li><strong>Balance Sheet:</strong> Truck value decreases by $10K per year</li>
                      <li><strong>Key Insight:</strong> Depreciation is a NON-CASH expense. No money leaves the company after initial purchase!</li>
                    </ul>
                  </div>
                </div>
                
                <div style="background: rgba(167, 139, 250, 0.1); padding: 20px; border-radius: 12px; margin-top: 20px;">
                  <h5 style="color: var(--accent-purple); margin-bottom: 15px;">üìä Amortization (Same Concept, Different Assets):</h5>
                  <p style="line-height: 1.8;">
                    <strong>Amortization</strong> = Depreciation for <em>intangible</em> assets (no physical form)<br><br>
                    
                    <strong>Examples:</strong><br>
                    ‚Ä¢ Patents: Spread over patent life (typically 20 years)<br>
                    ‚Ä¢ Software licenses: Spread over contract term<br>
                    ‚Ä¢ Customer relationships (from acquisitions): Spread over expected lifetime<br>
                    ‚Ä¢ Trademarks: Sometimes amortized, sometimes indefinite
                  </p>
                  
                  <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <strong>Example:</strong> Microsoft buys a company for $10B. $3B is customer relationships. Amortize over 10 years = $300M/year amortization expense.
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div style="background: linear-gradient(135deg, rgba(57, 255, 20, 0.2), rgba(34, 197, 94, 0.2)); padding: 30px; border-radius: 16px; margin: 40px 0; border: 3px solid #39ff14; text-align: center;">
            <p style="font-size: 1.3rem; color: #39ff14; margin-bottom: 15px;">
              ‚ö†Ô∏è <strong>Income Statement Complete!</strong>
            </p>
            <p style="font-size: 1.05rem; line-height: 1.8;">
              You now understand every line: Revenue, COGS, Gross Profit, Operating Expenses (R&D, S&M, G&A), Depreciation & Amortization.<br><br>
              <strong>Next up:</strong> Balance Sheet (Assets, Liabilities, Equity) ‚Üí
            </p>
          </div>

          <h3 style="font-size: 2rem; margin: 40px 0 20px; color: var(--accent-emerald);">2Ô∏è‚É£ Balance Sheet - What You Own & Owe</h3>

          <p style="font-size: 1.1rem; line-height: 1.8; color: var(--text-secondary); margin-bottom: 30px;">
            The Balance Sheet is a <strong>snapshot</strong> of a company's financial position at a specific moment in time. Think of it as a photograph of everything the company owns and owes on December 31st.
          </p>

          <div class="expandable-card" onclick="toggleExpand(this)">
            <div class="expand-header">
              <span style="font-size: 1.3rem; font-weight: 600;">üì¶ ASSETS - What the Company Owns</span>
              <span class="expand-icon">+</span>
            </div>
            <div class="expand-content">
              <p style="font-size: 1.1rem; line-height: 1.8; margin: 15px 0;">
                Assets = Anything of value the company owns. Divided into <strong>Current Assets</strong> (will convert to cash within 1 year) and <strong>Long-Term Assets</strong> (longer than 1 year).
              </p>
              
              <div style="background: linear-gradient(135deg, rgba(57, 255, 20, 0.15), rgba(34, 197, 94, 0.15)); padding: 25px; border-radius: 16px; margin: 20px 0;">
                <h4 style="color: #39ff14; margin-bottom: 20px;">üé¨ Coca-Cola Balance Sheet - Assets Side</h4>
                
                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                  <h5 style="color: #39ff14; font-size: 1.3rem; margin-bottom: 15px; border-bottom: 2px solid #39ff14; padding-bottom: 10px;">
                    ‚ö° CURRENT ASSETS (Can convert to cash quickly)
                  </h5>
                  
                  <table style="width: 100%; border-collapse: collapse; font-family: 'JetBrains Mono', monospace; font-size: 0.95rem;">
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;"><strong>üíµ Cash & Cash Equivalents</strong></td>
                      <td style="padding: 10px; text-align: right; color: #39ff14;">$10.5B</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;"><small style="color: var(--text-secondary); padding-left: 20px;">Physical cash in bank accounts + treasury bills</small></td>
                      <td></td>
                    </tr>
                    
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;"><strong>üßæ Accounts Receivable</strong></td>
                      <td style="padding: 10px; text-align: right; color: #39ff14;">$4.2B</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;"><small style="color: var(--text-secondary); padding-left: 20px;">Money OWED to Coca-Cola by customers (stores, restaurants)</small></td>
                      <td></td>
                    </tr>
                    
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;"><strong>üì¶ Inventory</strong></td>
                      <td style="padding: 10px; text-align: right; color: #39ff14;">$3.9B</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;"><small style="color: var(--text-secondary); padding-left: 20px;">Bottles of Coke in warehouses, ingredients (sugar, flavorings)</small></td>
                      <td></td>
                    </tr>
                    
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;"><strong>üí∞ Prepaid Expenses</strong></td>
                      <td style="padding: 10px; text-align: right; color: #39ff14;">$1.8B</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;"><small style="color: var(--text-secondary); padding-left: 20px;">Paid upfront for future benefits (insurance, rent paid in advance)</small></td>
                      <td></td>
                    </tr>
                    
                    <tr style="border-top: 2px solid #39ff14; background: rgba(57, 255, 20, 0.1);">
                      <td style="padding: 15px;"><strong style="font-size: 1.1rem;">Total Current Assets</strong></td>
                      <td style="padding: 15px; text-align: right; color: #39ff14; font-size: 1.2rem;"><strong>$20.4B</strong></td>
                    </tr>
                  </table>
                </div>
                
                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px;">
                  <h5 style="color: var(--accent-gold); font-size: 1.3rem; margin-bottom: 15px; border-bottom: 2px solid var(--accent-gold); padding-bottom: 10px;">
                    üèóÔ∏è LONG-TERM ASSETS (Held for years)
                  </h5>
                  
                  <table style="width: 100%; border-collapse: collapse; font-family: 'JetBrains Mono', monospace; font-size: 0.95rem;">
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;"><strong>üè≠ Property, Plant & Equipment (PP&E)</strong></td>
                      <td style="padding: 10px; text-align: right; color: var(--accent-gold);">$9.9B</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;"><small style="color: var(--text-secondary); padding-left: 20px;">Factories, bottling plants, machinery, trucks, office buildings</small></td>
                      <td></td>
                    </tr>
                    
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;"><strong>üé® Intangible Assets</strong></td>
                      <td style="padding: 10px; text-align: right; color: var(--accent-gold);">$14.5B</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;"><small style="color: var(--text-secondary); padding-left: 20px;">Brand names acquired (Vitamin Water, Costa Coffee), patents, licenses</small></td>
                      <td></td>
                    </tr>
                    
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;"><strong>‚ú® Goodwill</strong></td>
                      <td style="padding: 10px; text-align: right; color: var(--accent-gold);">$19.4B</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;"><small style="color: var(--text-secondary); padding-left: 20px;">"Premium" paid for acquisitions above fair value (brand reputation, market position)</small></td>
                      <td></td>
                    </tr>
                    
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;"><strong>üìä Long-term Investments</strong></td>
                      <td style="padding: 10px; text-align: right; color: var(--accent-gold);">$16.8B</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                      <td style="padding: 10px;"><small style="color: var(--text-secondary); padding-left: 20px;">Equity stakes in bottling partners, bonds, other investments</small></td>
                      <td></td>
                    </tr>
                    
                    <tr style="border-top: 2px solid var(--accent-gold);">
                      <td style="padding: 15px;"><strong style="font-size: 1.1rem;">Total Long-term Assets</strong></td>
                      <td style="padding: 15px; text-align: right; color: var(--accent-gold); font-size: 1.2rem;"><strong>$60.6B</strong></td>
                    </tr>
                  </table>
                </div>
                
                <div style="background: rgba(57, 255, 20, 0.15); padding: 20px; border-radius: 12px; margin-top: 20px; border: 3px solid #39ff14;">
                  <div style="font-family: 'JetBrains Mono', monospace; font-size: 1.3rem;">
                    <strong>TOTAL ASSETS</strong>
                    <span style="float: right; color: #39ff14;"><strong>$81.0B</strong></span>
                  </div>
                  <p style="margin-top: 15px; font-size: 1.05rem;">
                    Everything Coca-Cola owns, added together.
                  </p>
                </div>
              </div>
            </div>
          </div>

          <div style="background: linear-gradient(135deg, rgba(57, 255, 20, 0.2), rgba(34, 197, 94, 0.2)); padding: 30px; border-radius: 16px; margin: 40px 0; border: 3px solid #39ff14;">
            <h3 style="color: #39ff14; margin-bottom: 20px; font-size: 1.8rem;">üéì You're Mastering Financial Statements!</h3>
            <p style="font-size: 1.1rem; line-height: 1.8;">
              This is the most comprehensive financial statement education you'll find. We're going line-by-line with real company examples to make everything crystal clear.
            </p>
            
            <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 25px;">
              <button class="control-btn" onclick="backToModules()">‚Üê Back to Modules</button>
              <button class="control-btn" onclick="openFlashcardModal()" style="background: rgba(244, 196, 48, 0.2); border-color: var(--accent-gold);">
                üìö Create Flashcard
              </button>
            </div>
          </div>
        </div>
      `;
    }
    function generateValuationLesson() {
      return `
        <div class="lesson-container">
          <h2>Stock Valuation Methods</h2>
          <p style="font-size: 1.15rem; color: var(--text-secondary); margin-bottom: 30px;">
            Valuation is the process of determining what a stock is worth. There are multiple approaches, each with strengths and weaknesses.
          </p>

          <h3 style="font-size: 1.8rem; margin: 40px 0 20px; font-family: 'Playfair Display', serif;">
            1. Discounted Cash Flow (DCF) Analysis
          </h3>
          <div style="padding: 30px; background: rgba(167, 139, 250, 0.1); border-radius: 16px;">
            <p style="font-size: 1.1rem; line-height: 1.8; margin-bottom: 20px;">
              DCF values a company based on the present value of its future cash flows. It's considered the most "correct" 
              method but requires many assumptions.
            </p>
            <div style="background: rgba(0, 0, 0, 0.3); padding: 25px; border-radius: 12px; font-family: 'JetBrains Mono', monospace; font-size: 0.95rem;">
              <p style="margin: 10px 0;"><strong>Step 1:</strong> Project Free Cash Flows for 5-10 years</p>
              <p style="margin: 10px 0;"><strong>Step 2:</strong> Calculate Terminal Value (value beyond projection period)</p>
              <p style="margin: 10px 0;"><strong>Step 3:</strong> Discount all cash flows to present value using WACC</p>
              <p style="margin: 10px 0; color: var(--accent-gold);"><strong>Step 4:</strong> Sum = Enterprise Value ‚Üí subtract debt, add cash = Equity Value</p>
            </div>
            <div style="margin-top: 25px; padding: 20px; background: rgba(45, 212, 191, 0.1); border-radius: 10px;">
              <p style="font-weight: 600; margin-bottom: 10px;">Formula:</p>
              <p style="font-family: 'JetBrains Mono', monospace;">PV = FCF‚ÇÅ/(1+r)¬π + FCF‚ÇÇ/(1+r)¬≤ + ... + Terminal Value/(1+r)‚Åø</p>
              <p style="margin-top: 10px; font-size: 0.9rem;">Where r = discount rate (WACC)</p>
            </div>
          </div>

          <h3 style="font-size: 1.8rem; margin: 50px 0 20px; font-family: 'Playfair Display', serif;">
            2. Price Multiple Valuation
          </h3>
          
          <table class="data-table">
            <thead>
              <tr>
                <th>Multiple</th>
                <th>Formula</th>
                <th>When to Use</th>
                <th>Typical Range</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>P/E Ratio</strong></td>
                <td>Price / Earnings Per Share</td>
                <td>Profitable companies, mature industries</td>
                <td>15-25 (varies by sector)</td>
              </tr>
              <tr>
                <td><strong>P/S Ratio</strong></td>
                <td>Price / Sales Per Share</td>
                <td>Unprofitable but growing companies</td>
                <td>2-10 (tech higher)</td>
              </tr>
              <tr>
                <td><strong>P/B Ratio</strong></td>
                <td>Price / Book Value Per Share</td>
                <td>Banks, asset-heavy businesses</td>
                <td>1-3</td>
              </tr>
              <tr>
                <td><strong>EV/EBITDA</strong></td>
                <td>Enterprise Value / EBITDA</td>
                <td>Capital intensive businesses</td>
                <td>8-15</td>
              </tr>
              <tr>
                <td><strong>PEG Ratio</strong></td>
                <td>P/E / Growth Rate</td>
                <td>Growth companies</td>
                <td>&lt; 1 is attractive</td>
              </tr>
            </tbody>
          </table>

          <h3 style="font-size: 1.8rem; margin: 50px 0 20px; font-family: 'Playfair Display', serif;">
            Absolute vs Relative Valuation
          </h3>
          <div class="modules-grid">
            <div class="module-card">
              <div class="module-icon">üìç</div>
              <h3>Absolute Valuation</h3>
              <p style="margin: 15px 0; line-height: 1.7;">Compare current multiples to the company's historical averages. Is the stock trading above or below its 5-year average P/E?</p>
              <p style="font-size: 0.9rem; color: var(--accent-emerald);"><strong>Example:</strong> If AAPL historically trades at 20x P/E and is currently at 15x, it may be undervalued.</p>
            </div>

            <div class="module-card">
              <div class="module-icon">‚öñÔ∏è</div>
              <h3>Relative Valuation</h3>
              <p style="margin: 15px 0; line-height: 1.7;">Compare to peer companies. Is the stock expensive or cheap compared to competitors?</p>
              <p style="font-size: 0.9rem; color: var(--accent-emerald);"><strong>Example:</strong> If industry average P/E is 18x and the stock trades at 25x, it's relatively expensive.</p>
            </div>
          </div>

          <h3 style="font-size: 1.8rem; margin: 50px 0 20px; font-family: 'Playfair Display', serif;">
            Total Addressable Market (TAM) Analysis
          </h3>
          <div style="padding: 30px; background: rgba(45, 212, 191, 0.1); border-radius: 16px;">
            <p style="font-size: 1.1rem; line-height: 1.8; margin-bottom: 20px;">
              TAM represents the total market opportunity. Understanding TAM/Revenue ratio helps assess growth runway.
            </p>
            
            <h4 style="font-size: 1.3rem; margin: 30px 0 20px;">üìä Market Penetration Visualization</h4>
            <div class="chart-container" style="height: 350px;">
              <canvas id="tamPieChart"></canvas>
            </div>
            
            <div class="metrics-grid" style="margin-top: 30px;">
              <div class="metric-card">
                <div class="metric-label">Current TAM</div>
                <div class="metric-value">$500B</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Current Revenue</div>
                <div class="metric-value">$50B</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Market Share</div>
                <div class="metric-value">10%</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">TAM Growth (5yr)</div>
                <div class="metric-value">12% CAGR</div>
              </div>
            </div>
            
            <h4 style="font-size: 1.3rem; margin: 40px 0 20px;">üìà TAM Growth Projection</h4>
            <div class="chart-container" style="height: 400px;">
              <canvas id="tamGrowthChart"></canvas>
            </div>
            
            <p style="margin-top: 25px; font-size: 1.05rem; line-height: 1.8;">
              <strong>5-Year Projection:</strong> If TAM grows to $880B and the company maintains 10% share, 
              revenue could reach $88B - a 76% increase. This growth potential should be reflected in valuation.
            </p>
          </div>

          <div style="margin-top: 50px; padding: 30px; background: rgba(244, 196, 48, 0.1); border-radius: 16px; border-left: 4px solid var(--accent-gold);">
            <h4 style="font-size: 1.4rem; margin-bottom: 15px;">Valuation Framework:</h4>
            <ol style="font-size: 1.05rem; line-height: 2; padding-left: 20px;">
              <li>Build 3-5 year financial model with revenue and FCF projections</li>
              <li>Run DCF analysis with conservative, base, and optimistic scenarios</li>
              <li>Compare current multiples to historical ranges</li>
              <li>Compare multiples to industry peers</li>
              <li>Assess TAM penetration and growth runway</li>
              <li>Apply margin of safety (buy below intrinsic value)</li>
              <li>Monitor for changes in fundamentals that affect valuation</li>
            </ol>
          </div>

          <div style="margin-top: 30px; padding: 25px; background: rgba(239, 68, 68, 0.1); border-radius: 12px; border-left: 4px solid #ef4444;">
            <p style="font-size: 1.05rem; line-height: 1.8;">
              ‚ö†Ô∏è <strong>Important:</strong> All valuation models are only as good as their assumptions. 
              The goal isn't to find the "exact" value but to develop a reasonable range and understand the key drivers.
            </p>
          </div>
        </div>
      `;
    }

    // Metrics Lesson
    function generateMetricsLesson() {
      return `
        <div class="lesson-container">
          <h2>Key Metrics & Financial Ratios</h2>
          
          <h3 style="font-size: 1.8rem; margin: 40px 0 20px; font-family: 'Playfair Display', serif;">
            Return on Equity (ROE)
          </h3>
          <div style="padding: 30px; background: rgba(167, 139, 250, 0.1); border-radius: 16px;">
            <p style="font-size: 1.15rem; line-height: 1.8; margin-bottom: 20px;">
              ROE measures how efficiently a company uses shareholders' equity to generate profits. 
              It's one of Warren Buffett's favorite metrics.
            </p>
            <div style="background: rgba(0, 0, 0, 0.3); padding: 25px; border-radius: 12px; text-align: center;">
              <p style="font-size: 1.8rem; font-family: 'JetBrains Mono', monospace; color: var(--accent-gold); margin-bottom: 10px;">
                ROE = Net Income / Shareholders' Equity
              </p>
              <p style="font-size: 1.05rem;">Expressed as a percentage</p>
            </div>
            <div class="metrics-grid" style="margin-top: 25px;">
              <div class="metric-card">
                <div class="metric-label">Poor ROE</div>
                <div class="metric-value" style="color: #ef4444;">&lt; 10%</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Good ROE</div>
                <div class="metric-value" style="color: var(--accent-gold);">15-20%</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Excellent ROE</div>
                <div class="metric-value" style="color: #22c55e;">&gt; 20%</div>
              </div>
            </div>
            <p style="margin-top: 20px; font-size: 1.05rem; line-height: 1.8; font-style: italic;">
              üí° A company with 20% ROE generates $20 of profit for every $100 of shareholder equity. 
              Consistent high ROE indicates a strong competitive moat.
            </p>
          </div>

          <h3 style="font-size: 1.8rem; margin: 50px 0 20px; font-family: 'Playfair Display', serif;">
            Return on Invested Capital (ROIC)
          </h3>
          <div style="padding: 30px; background: rgba(45, 212, 191, 0.1); border-radius: 16px;">
            <p style="font-size: 1.15rem; line-height: 1.8; margin-bottom: 20px;">
              ROIC measures how well a company generates cash flow relative to the capital invested. 
              It's more comprehensive than ROE as it includes debt.
            </p>
            <div style="background: rgba(0, 0, 0, 0.3); padding: 25px; border-radius: 12px; text-align: center;">
              <p style="font-size: 1.6rem; font-family: 'JetBrains Mono', monospace; color: var(--accent-emerald); margin-bottom: 10px;">
                ROIC = NOPAT / Invested Capital
              </p>
              <p style="font-size: 0.95rem; margin-top: 15px;">NOPAT = Net Operating Profit After Tax</p>
              <p style="font-size: 0.95rem;">Invested Capital = Equity + Debt - Cash</p>
            </div>
            <p style="margin-top: 25px; padding: 20px; background: rgba(244, 196, 48, 0.1); border-radius: 10px; line-height: 1.8;">
              <strong>Key Insight:</strong> ROIC should be higher than the company's cost of capital (WACC). 
              If ROIC > WACC, the company creates value. If ROIC &lt; WACC, it destroys value.
            </p>
          </div>

          <h3 style="font-size: 1.8rem; margin: 50px 0 20px; font-family: 'Playfair Display', serif;">
            Leverage Ratios
          </h3>
          
          <table class="data-table">
            <thead>
              <tr>
                <th>Ratio</th>
                <th>Formula</th>
                <th>What It Measures</th>
                <th>Good Level</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>Debt-to-Equity</strong></td>
                <td>Total Debt / Total Equity</td>
                <td>Financial leverage</td>
                <td>&lt; 1.0 (conservative)</td>
              </tr>
              <tr>
                <td><strong>Debt-to-Assets</strong></td>
                <td>Total Debt / Total Assets</td>
                <td>Asset financing structure</td>
                <td>&lt; 0.5</td>
              </tr>
              <tr>
                <td><strong>Interest Coverage</strong></td>
                <td>EBIT / Interest Expense</td>
                <td>Ability to pay interest</td>
                <td>&gt; 5x</td>
              </tr>
              <tr>
                <td><strong>Debt-to-EBITDA</strong></td>
                <td>Net Debt / EBITDA</td>
                <td>Debt repayment capacity</td>
                <td>&lt; 3x</td>
              </tr>
            </tbody>
          </table>

          <div class="modules-grid" style="margin-top: 40px;">
            <div class="module-card">
              <div class="module-icon">‚ö†Ô∏è</div>
              <h3>High Debt Risks</h3>
              <ul style="margin-top: 15px; padding-left: 20px; line-height: 1.8; font-size: 0.95rem;">
                <li>Financial distress risk</li>
                <li>Limited flexibility</li>
                <li>Higher interest burden</li>
                <li>Volatility in downturns</li>
              </ul>
            </div>

            <div class="module-card">
              <div class="module-icon">‚úÖ</div>
              <h3>Optimal Debt Benefits</h3>
              <ul style="margin-top: 15px; padding-left: 20px; line-height: 1.8; font-size: 0.95rem;">
                <li>Tax shield (interest deductible)</li>
                <li>Leverage returns (when ROIC > rate)</li>
                <li>Discipline on management</li>
                <li>Lower cost than equity</li>
              </ul>
            </div>
          </div>

          <h3 style="font-size: 1.8rem; margin: 50px 0 20px; font-family: 'Playfair Display', serif;">
            Additional Important Metrics
          </h3>
          
          <div class="metrics-grid">
            <div class="metric-card">
              <div class="metric-label">Current Ratio</div>
              <div class="metric-value">Current Assets √∑ Current Liabilities</div>
              <p style="margin-top: 10px; font-size: 0.9rem; color: var(--text-secondary);">
                <strong>Target: &gt; 1.5</strong><br>
                Measures short-term liquidity
              </p>
            </div>

            <div class="metric-card">
              <div class="metric-label">Quick Ratio</div>
              <div class="metric-value">(CA - Inventory) √∑ CL</div>
              <p style="margin-top: 10px; font-size: 0.9rem; color: var(--text-secondary);">
                <strong>Target: &gt; 1.0</strong><br>
                More conservative liquidity test
              </p>
            </div>

            <div class="metric-card">
              <div class="metric-label">Asset Turnover</div>
              <div class="metric-value">Revenue √∑ Total Assets</div>
              <p style="margin-top: 10px; font-size: 0.9rem; color: var(--text-secondary);">
                <strong>Higher is better</strong><br>
                Asset utilization efficiency
              </p>
            </div>

            <div class="metric-card">
              <div class="metric-label">FCF Yield</div>
              <div class="metric-value">FCF √∑ Market Cap</div>
              <p style="margin-top: 10px; font-size: 0.9rem; color: var(--text-secondary);">
                <strong>Target: &gt; 5%</strong><br>
                Cash return on investment
              </p>
            </div>

            <div class="metric-card">
              <div class="metric-label">Gross Margin</div>
              <div class="metric-value">Gross Profit √∑ Revenue</div>
              <p style="margin-top: 10px; font-size: 0.9rem; color: var(--text-secondary);">
                <strong>Higher = stronger pricing power</strong><br>
                Core profitability indicator
              </p>
            </div>

            <div class="metric-card">
              <div class="metric-label">Operating Margin</div>
              <div class="metric-value">Operating Income √∑ Revenue</div>
              <p style="margin-top: 10px; font-size: 0.9rem; color: var(--text-secondary);">
                <strong>Target: &gt; 15%</strong><br>
                Operational efficiency
              </p>
            </div>
          </div>

          <div style="margin-top: 50px; padding: 30px; background: rgba(244, 196, 48, 0.1); border-radius: 16px; border-left: 4px solid var(--accent-gold);">
            <h4 style="font-size: 1.4rem; margin-bottom: 15px;">Using Metrics Effectively:</h4>
            <ul style="font-size: 1.05rem; line-height: 2; padding-left: 20px;">
              <li>Track trends over time - one quarter doesn't tell the story</li>
              <li>Compare to industry peers - what's good for tech may be bad for utilities</li>
              <li>Look for consistency - stable metrics indicate quality business</li>
              <li>Watch for deterioration - declining ROE or margins signal problems</li>
              <li>Use multiple metrics together - no single metric tells the complete story</li>
              <li>Understand the business context - growth companies may sacrifice margins temporarily</li>
            </ul>
          </div>
        </div>
      `;
    }

    // Penny Animation Logic
    let pennyDay = 1;
    let pennyValue = 0.01;
    let pennyInterval;

    function initPennyAnimation() {
      resetPennyAnimation();
    }

    function startPennyAnimation() {
      if (pennyInterval) clearInterval(pennyInterval);
      
      pennyInterval = setInterval(() => {
        if (pennyDay >= 30) {
          clearInterval(pennyInterval);
          return;
        }
        
        pennyDay++;
        pennyValue *= 2;
        updatePennyDisplay();
      }, 500);
    }

    function resetPennyAnimation() {
      if (pennyInterval) clearInterval(pennyInterval);
      pennyDay = 1;
      pennyValue = 0.01;
      updatePennyDisplay();
    }

    function skipToEnd() {
      if (pennyInterval) clearInterval(pennyInterval);
      pennyDay = 30;
      pennyValue = Math.pow(2, 29) * 0.01;
      updatePennyDisplay();
    }

    function updatePennyDisplay() {
      document.getElementById('pennyDay').textContent = pennyDay;
      document.getElementById('pennyValue').textContent = pennyValue.toLocaleString('en-US', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
      
      const progress = (pennyDay / 30) * 100;
      document.getElementById('pennyProgress').style.width = progress + '%';
      
      const penny = document.querySelector('.penny');
      if (penny) {
        penny.style.transform = `scale(${Math.min(1 + (pennyDay / 30), 2)})`;
      }
    }

    // Stock Analysis with Claude API
    function filterStocks() {
      const input = document.getElementById('stockSymbol').value.trim();
      const dropdown = document.getElementById('autocompleteDropdown');
      
      // Show dropdown even with just 1 character
      if (input.length === 0) {
        dropdown.classList.remove('show');
        return;
      }

      const searchTerm = input.toUpperCase();
      
      // Prioritize ticker matches, then name matches
      filteredResults = allStocks.filter(stock => 
        stock.ticker.toUpperCase().includes(searchTerm) || 
        stock.name.toUpperCase().includes(searchTerm) ||
        stock.exchange.toUpperCase().includes(searchTerm)
      ).sort((a, b) => {
        // Prioritize exact ticker matches
        const aTickerMatch = a.ticker.toUpperCase().startsWith(searchTerm);
        const bTickerMatch = b.ticker.toUpperCase().startsWith(searchTerm);
        
        if (aTickerMatch && !bTickerMatch) return -1;
        if (!aTickerMatch && bTickerMatch) return 1;
        
        // Then alphabetical by ticker
        return a.ticker.localeCompare(b.ticker);
      });

      // Limit to top 50 results for performance
      filteredResults = filteredResults.slice(0, 50);

      displayDropdown(filteredResults);
      selectedIndex = -1;
    }

    function displayDropdown(results) {
      const dropdown = document.getElementById('autocompleteDropdown');
      
      if (results.length === 0) {
        dropdown.innerHTML = '<div class="no-results">No stocks found. Try another search term.</div>';
        dropdown.classList.add('show');
        return;
      }

      // Group by region
      const grouped = {};
      results.forEach(stock => {
        if (!grouped[stock.region]) {
          grouped[stock.region] = [];
        }
        grouped[stock.region].push(stock);
      });

      let html = '';
      
      // Show count if results are limited
      if (results.length === 50) {
        html += `<div style="padding: 10px 24px; background: rgba(57, 255, 20, 0.05); color: #39ff14; font-size: 0.85rem; border-bottom: 1px solid rgba(57, 255, 20, 0.1);">
          Showing top 50 results. Type more to refine your search.
        </div>`;
      }
      
      Object.keys(grouped).forEach(region => {
        html += `<div class="region-label">üìç ${region}</div>`;
        grouped[region].forEach((stock, index) => {
          // Highlight matching part of ticker
          const searchTerm = document.getElementById('stockSymbol').value.toUpperCase();
          const tickerHighlighted = stock.ticker.replace(
            new RegExp(`(${searchTerm})`, 'gi'),
            '<span style="background: rgba(57, 255, 20, 0.3); padding: 2px 4px; border-radius: 3px;">$1</span>'
          );
          
          // Create data attributes for safe passing
          html += `
            <div class="autocomplete-item" 
                 data-ticker="${stock.ticker}" 
                 data-name="${stock.name.replace(/"/g, '&quot;')}"
                 onclick="selectStockFromDropdown(this)">
              <span class="stock-ticker">${tickerHighlighted}</span>
              <span class="stock-name">${stock.name}</span>
              <span class="stock-exchange">${stock.exchange}</span>
            </div>
          `;
        });
      });

      dropdown.innerHTML = html;
      dropdown.classList.add('show');
    }

    function selectStockFromDropdown(element) {
      const ticker = element.getAttribute('data-ticker');
      const name = element.getAttribute('data-name');
      selectStock(ticker, name);
    }

    function showDropdown() {
      const input = document.getElementById('stockSymbol').value;
      if (input.length > 0) {
        filterStocks();
      }
    }

    function selectStock(ticker, name) {
      document.getElementById('stockSymbol').value = ticker;
      document.getElementById('autocompleteDropdown').classList.remove('show');
      analyzeStock();
    }

    function handleKeyDown(event) {
      const dropdown = document.getElementById('autocompleteDropdown');
      const items = dropdown.querySelectorAll('.autocomplete-item');
      
      if (event.key === 'ArrowDown') {
        event.preventDefault();
        selectedIndex = Math.min(selectedIndex + 1, items.length - 1);
        updateSelection(items);
      } else if (event.key === 'ArrowUp') {
        event.preventDefault();
        selectedIndex = Math.max(selectedIndex - 1, 0);
        updateSelection(items);
      } else if (event.key === 'Enter') {
        event.preventDefault();
        if (selectedIndex >= 0 && items[selectedIndex]) {
          items[selectedIndex].click();
        } else {
          analyzeStock();
        }
      } else if (event.key === 'Escape') {
        dropdown.classList.remove('show');
      }
    }

    function updateSelection(items) {
      items.forEach((item, index) => {
        if (index === selectedIndex) {
          item.classList.add('selected');
          item.scrollIntoView({ block: 'nearest' });
        } else {
          item.classList.remove('selected');
        }
      });
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
      const searchContainer = document.querySelector('.stock-search');
      if (searchContainer && !searchContainer.contains(event.target)) {
        document.getElementById('autocompleteDropdown').classList.remove('show');
      }
    });

    async function analyzeStock() {
      const symbolInput = document.getElementById('stockSymbol');
      if (!symbolInput) {
        console.error('Stock symbol input not found');
        return;
      }
      
      const symbol = symbolInput.value.toUpperCase().trim();
      if (!symbol) {
        alert('Please enter a stock symbol');
        return;
      }

      // Close dropdown
      const dropdown = document.getElementById('autocompleteDropdown');
      if (dropdown) {
        dropdown.classList.remove('show');
      }

      // Find stock info for better context
      const stockInfo = allStocks.find(s => s.ticker === symbol);
      const stockContext = stockInfo ? `${stockInfo.name} (${stockInfo.exchange}, ${stockInfo.region})` : symbol;

      const analysisDiv = document.getElementById('stockAnalysis');
      if (!analysisDiv) {
        console.error('Stock analysis div not found');
        return;
      }
      
      const modelName = selectedModel === 'opus' ? 'Claude Opus 4.5' : 'Claude Sonnet 4.5';
      
      analysisDiv.innerHTML = `
        <div class="ai-analysis">
          <div class="ai-badge">
            <div class="loading-spinner"></div>
            <span>AI Analysis in Progress</span>
          </div>
          <p style="color: var(--text-secondary);">Analyzing ${stockContext}... ${OFFLINE_MODE ? '(Using offline mock data for testing)' : 'Gathering financial data, metrics, and generating insights...'}</p>
        </div>
      `;

      try {
        let analysisText;
        
        console.log(`üìä Starting analysis for ${symbol}`);
        console.log(`ü§ñ Model: ${modelName}`);
        console.log(`üîß Offline Mode: ${OFFLINE_MODE}`);
        
        // OFFLINE MODE: Use mock data
        if (OFFLINE_MODE) {
          console.log('üîß OFFLINE MODE: Using mock analysis data');
          
          // Simulate API delay
          await new Promise(resolve => setTimeout(resolve, 2000));
          
          // Get mock data or generate generic response
          if (mockAnalysisData[symbol]) {
            analysisText = mockAnalysisData[symbol];
            console.log(`‚úÖ Mock data found for ${symbol} (${analysisText.length} characters)`);
          } else {
            console.log(`‚ö†Ô∏è No mock data for ${symbol}, generating generic response`);
            // Generic response for stocks without mock data
            analysisText = `## 1. EXECUTIVE SUMMARY

**Investment Recommendation:** HOLD

This is a **demonstration analysis** for ${symbol}${stockInfo ? ` (${stockInfo.name})` : ''} in OFFLINE MODE.

## 2. COMPANY OVERVIEW

${stockInfo ? stockInfo.name : symbol} is traded on ${stockInfo ? stockInfo.exchange : 'stock exchange'} in the ${stockInfo ? stockInfo.region : 'global'} market.

## 3. KEY FEATURES WORKING

‚úÖ **Stock Search** - Autocomplete with 600+ global stocks
‚úÖ **Model Selection** - Choose between Sonnet 4.5 and Opus 4.5
‚úÖ **Analysis Display** - Professional formatting with sections
‚úÖ **Export Functions** - Excel, PowerPoint, and preview options
‚úÖ **Interactive Charts** - Financial visualizations in lessons
‚úÖ **Flashcard Creator** - 1080x1080 learning cards

## 4. TO GET REAL ANALYSIS

To analyze ${symbol} with real AI-powered insights:

1. **Run on a web server:**
   ```bash
   python -m http.server 8000
   ```
   Then open: http://localhost:8000/investing-app.html

2. **Or try pre-loaded stocks with full mock data:**
   - **NIO** - Complete analysis available
   - **AAPL** - Complete analysis available

## 5. TEST THE FEATURES

While in offline mode, you can test:
- ‚úÖ All navigation and tabs
- ‚úÖ Interactive learning lessons with animations
- ‚úÖ Chart visualizations  
- ‚úÖ Flashcard creation and export
- ‚úÖ Excel/PPT export buttons (will work with this data)
- ‚úÖ Search autocomplete for 600+ stocks

**Try typing "NIO" or "AAPL" for complete analysis examples!**`;
          }
          
          console.log(`üìù Analysis text prepared (${analysisText.length} characters)`);
        } 
        // ONLINE MODE: Use Claude API
        else {
          const modelString = selectedModel === 'opus' ? 'claude-opus-4-20250514' : 'claude-sonnet-4-20250514';
          
          const response = await fetch("https://api.anthropic.com/v1/messages", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              model: modelString,
              max_tokens: selectedModel === 'opus' ? 8000 : 4000,
              messages: [
                {
                  role: "user",
                  content: `You are a professional financial analyst. Provide a comprehensive investment analysis for ${symbol} stock${stockInfo ? ` (${stockInfo.name}, traded on ${stockInfo.exchange})` : ''}.

${selectedModel === 'opus' ? 'Use your advanced capabilities to provide DEEP, institutional-grade analysis with detailed financial modeling and projections.' : 'Provide a thorough but concise analysis suitable for retail investors.'}

Structure your analysis with these sections:

## 1. EXECUTIVE SUMMARY
- Investment recommendation (Strong Buy / Buy / Hold / Sell / Strong Sell)
- Key thesis in 2-3 sentences
- Target price with timeframe

## 2. COMPANY OVERVIEW
- Business model and core products/services
- Competitive positioning and moat
- Market share and industry standing

## 3. FINANCIAL METRICS
Present in table format:
- Stock Price & Market Cap
- P/E Ratio, P/S Ratio, PEG Ratio
- EV/EBITDA, Price/Book
- Revenue (TTM and YoY growth %)
- Gross Margin, Operating Margin, Net Margin
- ROE and ROIC
- Debt-to-Equity, Current Ratio, Interest Coverage
- Free Cash Flow and FCF Yield
- Dividend Yield (if applicable)

## 4. REVENUE ANALYSIS & PROJECTIONS
- Historical revenue trend (3-5 years)
- Key revenue drivers
- Revenue projection for next 3-5 years with assumptions
- Expected CAGR

## 5. PROFITABILITY & CASH FLOW
- Margin trends and sustainability
- Cash generation ability
- Capital allocation strategy
- Return metrics trend

## 6. MANAGEMENT QUALITY
- Track record of execution
- Capital allocation decisions
- Alignment with shareholders
- Recent management commentary (with YouTube/interview links if available)

## 7. VALUATION ANALYSIS
- DCF valuation with key assumptions
- Price multiples vs historical and peer comparison
- Fair value estimate with range
- Is stock overvalued, fairly valued, or undervalued?

## 8. TOTAL ADDRESSABLE MARKET (TAM)
- Current TAM size
- Company's market penetration %
- TAM growth projections
- TAM/Revenue ratio and implications

## 9. GROWTH CATALYSTS & RISKS
Catalysts:
- List 3-5 key growth drivers

Risks:
- List 3-5 key risks to watch

## 10. INVESTMENT THESIS
- Bull case (best scenario)
- Base case (most likely)
- Bear case (worst scenario)
- Final recommendation with conviction level

Make this analysis detailed, data-driven, and educational for someone learning stock analysis.`
                }
              ]
            })
          });

          if (!response.ok) {
            throw new Error(`API Error: ${response.status} ${response.statusText}`);
          }

          const data = await response.json();
          
          if (!data.content || data.content.length === 0) {
            throw new Error('No content received from API');
          }
          
          analysisText = data.content
            .map(item => (item.type === "text" ? item.text : ""))
            .filter(Boolean)
            .join("\n");

          if (!analysisText || analysisText.trim().length === 0) {
            throw new Error('Empty analysis received');
          }
        }

        // Store analysis for export
        currentAnalysis = {
          symbol: symbol,
          stockInfo: stockInfo,
          analysisText: analysisText,
          model: modelName,
          timestamp: new Date().toISOString()
        };

        console.log('üíæ Analysis stored in currentAnalysis');
        console.log('üé® Calling displayAnalysis...');
        
        displayAnalysis(symbol, analysisText, stockInfo, modelName);
        
        console.log('‚úÖ displayAnalysis called successfully');
      } catch (error) {
        console.error('‚ùå Analysis error:', error);
        console.error('Error stack:', error.stack);
        analysisDiv.innerHTML = `
          <div style="padding: 30px; background: rgba(239, 68, 68, 0.1); border-radius: 16px; border-left: 4px solid #ef4444;">
            <h3 style="font-size: 1.3rem; color: #ef4444; margin-bottom: 15px;">‚ö†Ô∏è Analysis Error</h3>
            <p style="font-size: 1.1rem; margin-bottom: 10px;">Unable to analyze <strong>${symbol}</strong> at this time.</p>
            <p style="font-size: 0.95rem; color: var(--text-secondary); margin-bottom: 20px;">Error: ${error.message}</p>
            <div style="padding: 20px; background: rgba(0, 0, 0, 0.3); border-radius: 10px; margin-top: 20px;">
              <p style="font-size: 0.9rem; line-height: 1.7;">
                <strong>Possible reasons:</strong><br>
                ‚Ä¢ Network connectivity issue<br>
                ‚Ä¢ API rate limit reached<br>
                ‚Ä¢ Invalid stock symbol<br>
                ‚Ä¢ Service temporarily unavailable
              </p>
            </div>
            <button class="control-btn" onclick="analyzeStock()" style="margin-top: 20px;">
              Try Again
            </button>
          </div>
        `;
      }
    }

    function displayAnalysis(symbol, analysisText, stockInfo, modelName) {
      console.log('üé® displayAnalysis called');
      console.log('  Symbol:', symbol);
      console.log('  Analysis length:', analysisText ? analysisText.length : 0);
      console.log('  Stock info:', stockInfo);
      console.log('  Model:', modelName);
      
      const analysisDiv = document.getElementById('stockAnalysis');
      
      if (!analysisDiv) {
        console.error('‚ùå stockAnalysis div not found!');
        return;
      }
      
      console.log('‚úÖ stockAnalysis div found');
      
      // Convert markdown-style formatting to HTML
      const formattedAnalysis = analysisText
        .replace(/###\s+(.+)/g, '<h3 style="font-size: 1.6rem; margin: 30px 0 15px; font-family: \'Playfair Display\', serif; color: var(--accent-gold);">$1</h3>')
        .replace(/##\s+(.+)/g, '<h3 style="font-size: 1.8rem; margin: 35px 0 20px; font-family: \'Playfair Display\', serif; color: var(--accent-emerald);">$1</h3>')
        .replace(/\*\*(.+?)\*\*/g, '<strong style="color: var(--text-primary);">$1</strong>')
        .replace(/\n\n/g, '</p><p style="margin: 15px 0; line-height: 1.8;">')
        .replace(/- (.+)/g, '<li style="margin: 8px 0;">$1</li>');

      analysisDiv.innerHTML = `
        <div style="margin-top: 30px;">
          <div style="padding: 25px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15)); border-radius: 16px; margin-bottom: 30px; border: 1px solid rgba(167, 139, 250, 0.3);">
            <div class="ai-badge">
              <span>‚ú® ${modelName} Analysis</span>
            </div>
            <h2 style="font-size: 2.2rem; margin: 15px 0; font-family: 'Playfair Display', serif;">${symbol} Stock Analysis</h2>
            ${stockInfo ? `
              <p style="color: var(--text-secondary); font-size: 1.1rem; margin: 5px 0;">${stockInfo.name}</p>
              <div style="display: inline-flex; gap: 15px; margin-top: 10px; flex-wrap: wrap;">
                <span style="background: rgba(57, 255, 20, 0.1); padding: 8px 16px; border-radius: 8px; font-size: 0.9rem;">
                  <strong>Exchange:</strong> ${stockInfo.exchange}
                </span>
                <span style="background: rgba(57, 255, 20, 0.1); padding: 8px 16px; border-radius: 8px; font-size: 0.9rem;">
                  <strong>Region:</strong> ${stockInfo.region}
                </span>
              </div>
            ` : '<p style="color: var(--text-secondary);">Comprehensive investment analysis generated by ${modelName}</p>'}
            
            <div class="export-buttons">
              <button class="export-btn" onclick="exportToExcel()" id="exportExcelBtn">
                üìä Export to Excel
              </button>
              <button class="export-btn" onclick="exportToPowerPoint()" id="exportPptBtn">
                üìë Export to PowerPoint
              </button>
              <button class="export-btn" onclick="viewInExcelFormat()" id="viewExcelBtn">
                üëÅÔ∏è View Excel Preview
              </button>
            </div>
          </div>

          <div style="background: var(--bg-card); padding: 30px; border-radius: 16px; margin-bottom: 30px; border: 1px solid rgba(255, 255, 255, 0.1);">
            <h3 style="font-size: 1.5rem; margin-bottom: 20px; color: var(--accent-gold);">üìà Key Metrics Overview</h3>
            <div class="metrics-grid">
              <div class="metric-card">
                <div class="metric-label">Stock Price</div>
                <div class="metric-value" id="stockPrice">--</div>
                <div class="metric-change positive" id="priceChange">--</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Market Cap</div>
                <div class="metric-value" id="marketCap">--</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">P/E Ratio</div>
                <div class="metric-value" id="peRatio">--</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">52-Week Range</div>
                <div class="metric-value" style="font-size: 1.3rem;" id="weekRange">--</div>
              </div>
            </div>
          </div>

          <div class="ai-content">
            <p style="margin: 15px 0; line-height: 1.8;">${formattedAnalysis}</p>
          </div>

          <div style="margin-top: 40px; padding: 30px; background: rgba(244, 196, 48, 0.1); border-radius: 16px; border-left: 4px solid var(--accent-gold);">
            <h4 style="font-size: 1.3rem; margin-bottom: 15px;">üìö Learning Notes:</h4>
            <p style="line-height: 1.8;">
              This ${modelName} analysis demonstrates comprehensive stock evaluation combining fundamental metrics, 
              qualitative assessment, valuation techniques, and risk analysis. Practice analyzing different 
              companies to develop your investment judgment skills.
            </p>
          </div>
        </div>
      `;
      
      console.log('‚úÖ displayAnalysis completed successfully - Analysis is now visible on page');
    }

    function showExample() {
      document.getElementById('stockSymbol').value = 'AAPL';
      analyzeStock();
    }

    
    // ============================================
    // EXPOSE FUNCTIONS TO GLOBAL SCOPE FOR ONCLICK HANDLERS
    // ============================================
    window.switchTab = switchTab;
    window.loadLesson = loadLesson;
    window.analyzeStock = analyzeStock;
    window.selectModel = selectModel;
    window.showExample = showExample;
    window.exportToExcel = exportToExcel;
    window.exportToPowerPoint = exportToPowerPoint;
    window.viewExcelPreview = viewExcelPreview;
    window.closePreview = closePreview;
    window.openFlashcardModal = openFlashcardModal;
    window.closeFlashcardModal = closeFlashcardModal;
    window.selectConcept = selectConcept;
    window.selectBackground = selectBackground;
    window.downloadFlashcard = downloadFlashcard;
    window.openVideoExplanation = openVideoExplanation;
    window.closeVideoExplanation = closeVideoExplanation;
    window.playExplanation = playExplanation;
    window.pauseExplanation = pauseExplanation;
    window.stopExplanation = stopExplanation;
    window.replayExplanation = replayExplanation;
    window.toggleExpand = toggleExpand;
    
    console.log('üåê All functions exposed to global scope');
    
    // Initialize on load
    window.onload = function() {
      console.log('‚úÖ Invest AI App Loaded Successfully');
      console.log('üìä Chart.js:', typeof Chart !== 'undefined' ? 'LOADED' : 'MISSING');
      console.log('üñºÔ∏è html2canvas:', typeof html2canvas !== 'undefined' ? 'LOADED' : 'MISSING');
      console.log('üîß switchTab:', typeof switchTab !== 'undefined' ? 'READY' : 'MISSING');
      console.log('üìö loadLesson:', typeof loadLesson !== 'undefined' ? 'READY' : 'MISSING');
      console.log('üíπ analyzeStock:', typeof analyzeStock !== 'undefined' ? 'READY' : 'MISSING');
      
      window.appReady = true;
      console.log('---');
      console.log('‚ú® App ready! Try clicking buttons now.');
      console.log('‚ùì If buttons still don\'t work, click the red "Test JavaScript" button');
      
      // Render flashcard library on load
      renderFlashcardLibraryMain();
      
      // Check if html2canvas is loaded
      if (typeof html2canvas === 'undefined') {
        console.warn('html2canvas not loaded yet, will retry...');
        setTimeout(() => {
          if (typeof html2canvas === 'undefined') {
            const script = document.createElement('script');
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
            script.async = true;
            script.onload = () => console.log('html2canvas loaded successfully');
            script.onerror = () => console.error('Failed to load html2canvas');
            document.head.appendChild(script);
          }
        }, 1000);
      }
    };

    // Global error handler
    window.addEventListener('error', function(event) {
      console.error('Global error caught:', event.error);
      // Don't show alerts for minor errors
      if (event.error && event.error.message && !event.error.message.includes('html2canvas')) {
        // Log but don't alert
        console.error('Error details:', event.error.stack);
      }
    });

    // Prevent unhandled promise rejections from showing in console
    window.addEventListener('unhandledrejection', function(event) {
      console.error('Unhandled promise rejection:', event.reason);
      event.preventDefault(); // Prevent default console error
    });

    // Chart Initialization Functions
    function initCompoundingCharts() {
      try {
        // Exponential Growth Chart
        const ctx1 = document.getElementById('compoundingChart');
        if (!ctx1) {
          console.log('Compounding chart canvas not found');
          return;
        }
        
        const days = Array.from({length: 30}, (_, i) => i + 1);
        const values = days.map(day => Math.pow(2, day - 1) * 0.01);
        
        new Chart(ctx1, {
          type: 'line',
          data: {
            labels: days,
            datasets: [{
              label: 'Penny Value ($)',
              data: values,
              borderColor: '#39ff14',
              backgroundColor: 'rgba(57, 255, 20, 0.1)',
              fill: true,
              tension: 0.4,
              borderWidth: 3
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                labels: { color: '#f8fafc', font: { size: 14 } }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return 'Value: $' + context.parsed.y.toLocaleString('en-US', {
                      minimumFractionDigits: 2,
                      maximumFractionDigits: 2
                    });
                  }
                }
              }
            },
            scales: {
              y: {
                type: 'logarithmic',
                ticks: { 
                  color: '#94a3b8',
                  callback: function(value) {
                    return '$' + value.toLocaleString();
                  }
                },
                grid: { color: 'rgba(255, 255, 255, 0.1)' }
              },
              x: {
                ticks: { color: '#94a3b8' },
                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                title: {
                  display: true,
                  text: 'Day',
                  color: '#f8fafc'
                }
              }
            }
          }
        });
      } catch (error) {
        console.error('Error initializing first compounding chart:', error);
      }

      // Investment Comparison Chart
      try {
        const ctx2 = document.getElementById('investmentComparisonChart');
      if (ctx2) {
        const years = Array.from({length: 31}, (_, i) => i);
        const rate8 = years.map(y => 10000 * Math.pow(1.08, y));
        const rate10 = years.map(y => 10000 * Math.pow(1.10, y));
        const rate12 = years.map(y => 10000 * Math.pow(1.12, y));
        
        new Chart(ctx2, {
          type: 'line',
          data: {
            labels: years,
            datasets: [
              {
                label: '8% Annual Return',
                data: rate8,
                borderColor: '#f4c430',
                backgroundColor: 'rgba(244, 196, 48, 0.1)',
                fill: false,
                tension: 0.4,
                borderWidth: 2
              },
              {
                label: '10% Annual Return',
                data: rate10,
                borderColor: '#2dd4bf',
                backgroundColor: 'rgba(45, 212, 191, 0.1)',
                fill: false,
                tension: 0.4,
                borderWidth: 2
              },
              {
                label: '12% Annual Return',
                data: rate12,
                borderColor: '#39ff14',
                backgroundColor: 'rgba(57, 255, 20, 0.1)',
                fill: false,
                tension: 0.4,
                borderWidth: 3
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                labels: { color: '#f8fafc', font: { size: 14 } }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return context.dataset.label + ': $' + context.parsed.y.toLocaleString('en-US', {
                      minimumFractionDigits: 0,
                      maximumFractionDigits: 0
                    });
                  }
                }
              }
            },
            scales: {
              y: {
                ticks: { 
                  color: '#94a3b8',
                  callback: function(value) {
                    return '$' + (value / 1000).toFixed(0) + 'K';
                  }
                },
                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                title: {
                  display: true,
                  text: 'Portfolio Value',
                  color: '#f8fafc'
                }
              },
              x: {
                ticks: { color: '#94a3b8' },
                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                title: {
                  display: true,
                  text: 'Years',
                  color: '#f8fafc'
                }
              }
            }
          }
        });
      }
      } catch (error) {
        console.error('Error initializing compounding charts:', error);
      }
    }

    function initValuationCharts() {
      try {
      // TAM Pie Chart - Market Penetration
      const ctxPie = document.getElementById('tamPieChart');
      if (ctxPie) {
        new Chart(ctxPie, {
          type: 'doughnut',
          data: {
            labels: ['Company Revenue (10%)', 'Competitors (60%)', 'Untapped Market (30%)'],
            datasets: [{
              data: [10, 60, 30],
              backgroundColor: [
                '#39ff14',
                '#f4c430',
                'rgba(148, 163, 184, 0.3)'
              ],
              borderColor: '#0a0e27',
              borderWidth: 3
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom',
                labels: { 
                  color: '#f8fafc', 
                  font: { size: 13 },
                  padding: 15
                }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return context.label + ': ' + context.parsed + '%';
                  }
                }
              }
            }
          }
        });
      }

      // TAM Growth Projection Chart
      const ctxGrowth = document.getElementById('tamGrowthChart');
      if (ctxGrowth) {
        const years = ['Today', 'Year 1', 'Year 2', 'Year 3', 'Year 4', 'Year 5'];
        const tam = [500, 560, 627, 702, 786, 880];
        const revenue = [50, 56, 63, 70, 79, 88];
        
        new Chart(ctxGrowth, {
          type: 'bar',
          data: {
            labels: years,
            datasets: [
              {
                label: 'Total Addressable Market ($B)',
                data: tam,
                backgroundColor: 'rgba(244, 196, 48, 0.6)',
                borderColor: '#f4c430',
                borderWidth: 2
              },
              {
                label: 'Company Revenue ($B)',
                data: revenue,
                backgroundColor: 'rgba(57, 255, 20, 0.6)',
                borderColor: '#39ff14',
                borderWidth: 2
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                labels: { color: '#f8fafc', font: { size: 13 } }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return context.dataset.label + ': $' + context.parsed.y + 'B';
                  }
                }
              }
            },
            scales: {
              y: {
                ticks: { 
                  color: '#94a3b8',
                  callback: function(value) {
                    return '$' + value + 'B';
                  }
                },
                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                title: {
                  display: true,
                  text: 'Value (Billions)',
                  color: '#f8fafc'
                }
              },
              x: {
                ticks: { color: '#94a3b8' },
                grid: { color: 'rgba(255, 255, 255, 0.1)' }
              }
            }
          }
        });
      }
      } catch (error) {
        console.error('Error initializing valuation charts:', error);
      }
    }

    function initFinancialCharts() {
      try {
      // Revenue & Margin Growth Chart
      const ctxRevenue = document.getElementById('revenueGrowthChart');
      if (ctxRevenue) {
        const years = ['2023', '2024E', '2025E', '2026E'];
        const revenue = [1000, 1150, 1323, 1521];
        const grossMargin = [60, 62, 63, 64];
        const opMargin = [25, 27, 28, 30];
        
        new Chart(ctxRevenue, {
          type: 'bar',
          data: {
            labels: years,
            datasets: [
              {
                label: 'Revenue ($M)',
                data: revenue,
                backgroundColor: 'rgba(57, 255, 20, 0.6)',
                borderColor: '#39ff14',
                borderWidth: 2,
                yAxisID: 'y'
              },
              {
                label: 'Gross Margin (%)',
                data: grossMargin,
                type: 'line',
                borderColor: '#f4c430',
                backgroundColor: 'rgba(244, 196, 48, 0.1)',
                borderWidth: 3,
                yAxisID: 'y1',
                tension: 0.4
              },
              {
                label: 'Operating Margin (%)',
                data: opMargin,
                type: 'line',
                borderColor: '#2dd4bf',
                backgroundColor: 'rgba(45, 212, 191, 0.1)',
                borderWidth: 3,
                yAxisID: 'y1',
                tension: 0.4
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                labels: { color: '#f8fafc', font: { size: 13 } }
              }
            },
            scales: {
              y: {
                type: 'linear',
                position: 'left',
                ticks: { 
                  color: '#94a3b8',
                  callback: function(value) {
                    return '$' + value + 'M';
                  }
                },
                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                title: {
                  display: true,
                  text: 'Revenue',
                  color: '#f8fafc'
                }
              },
              y1: {
                type: 'linear',
                position: 'right',
                ticks: { 
                  color: '#94a3b8',
                  callback: function(value) {
                    return value + '%';
                  }
                },
                grid: { display: false },
                title: {
                  display: true,
                  text: 'Margin %',
                  color: '#f8fafc'
                }
              },
              x: {
                ticks: { color: '#94a3b8' },
                grid: { color: 'rgba(255, 255, 255, 0.1)' }
              }
            }
          }
        });
      }

      // Free Cash Flow Chart
      const ctxFCF = document.getElementById('fcfChart');
      if (ctxFCF) {
        const years = ['2023', '2024E', '2025E', '2026E'];
        const fcf = [200, 250, 300, 365];
        const fcfMargin = [20, 22, 23, 24];
        
        new Chart(ctxFCF, {
          type: 'line',
          data: {
            labels: years,
            datasets: [
              {
                label: 'Free Cash Flow ($M)',
                data: fcf,
                borderColor: '#39ff14',
                backgroundColor: 'rgba(57, 255, 20, 0.2)',
                fill: true,
                tension: 0.4,
                borderWidth: 3,
                yAxisID: 'y'
              },
              {
                label: 'FCF Margin (%)',
                data: fcfMargin,
                borderColor: '#f4c430',
                backgroundColor: 'rgba(244, 196, 48, 0.1)',
                fill: false,
                tension: 0.4,
                borderWidth: 2,
                yAxisID: 'y1'
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                labels: { color: '#f8fafc', font: { size: 13 } }
              }
            },
            scales: {
              y: {
                type: 'linear',
                position: 'left',
                ticks: { 
                  color: '#94a3b8',
                  callback: function(value) {
                    return '$' + value + 'M';
                  }
                },
                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                title: {
                  display: true,
                  text: 'Free Cash Flow',
                  color: '#f8fafc'
                }
              },
              y1: {
                type: 'linear',
                position: 'right',
                ticks: { 
                  color: '#94a3b8',
                  callback: function(value) {
                    return value + '%';
                  }
                },
                grid: { display: false },
                title: {
                  display: true,
                  text: 'FCF Margin %',
                  color: '#f8fafc'
                }
              },
              x: {
                ticks: { color: '#94a3b8' },
                grid: { color: 'rgba(255, 255, 255, 0.1)' }
              }
            }
          }
        });
      }
      } catch (error) {
        console.error('Error initializing financial charts:', error);
      }
    }

    // Export Functions
    function viewInExcelFormat() {
      if (!currentAnalysis) {
        alert('Please analyze a stock first!');
        return;
      }

      const { symbol, analysisText, stockInfo } = currentAnalysis;
      
      // Create a simple Excel-like table view
      const excelWindow = window.open('', '_blank');
      excelWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <title>${symbol} Analysis - Excel Preview</title>
          <style>
            body {
              font-family: Arial, sans-serif;
              padding: 20px;
              background: #f5f5f5;
            }
            table {
              width: 100%;
              border-collapse: collapse;
              background: white;
              box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }
            th {
              background: #1E2761;
              color: white;
              padding: 12px;
              text-align: left;
              font-weight: bold;
            }
            td {
              padding: 10px;
              border-bottom: 1px solid #ddd;
            }
            tr:hover {
              background: #f9f9f9;
            }
            .section-header {
              background: #39ff14 !important;
              color: #000 !important;
              font-weight: bold;
              font-size: 14px;
            }
            .button {
              background: #39ff14;
              color: #000;
              border: none;
              padding: 10px 20px;
              margin: 10px 5px;
              cursor: pointer;
              border-radius: 5px;
              font-weight: bold;
            }
            .button:hover {
              background: #2de00f;
            }
          </style>
        </head>
        <body>
          <h1>${symbol} - ${stockInfo ? stockInfo.name : 'Stock Analysis'}</h1>
          <button class="button" onclick="window.print()">üñ®Ô∏è Print</button>
          <button class="button" onclick="exportTableToExcel()">üìä Download as Excel</button>
          <br><br>
          <table id="analysisTable">
            <tr><th colspan="2" class="section-header">STOCK INFORMATION</th></tr>
            <tr><td><strong>Ticker Symbol</strong></td><td>${symbol}</td></tr>
            <tr><td><strong>Company Name</strong></td><td>${stockInfo ? stockInfo.name : 'N/A'}</td></tr>
            <tr><td><strong>Exchange</strong></td><td>${stockInfo ? stockInfo.exchange : 'N/A'}</td></tr>
            <tr><td><strong>Region</strong></td><td>${stockInfo ? stockInfo.region : 'N/A'}</td></tr>
            <tr><th colspan="2" class="section-header">ANALYSIS</th></tr>
            <tr><td colspan="2"><pre style="white-space: pre-wrap; font-family: inherit;">${analysisText}</pre></td></tr>
          </table>
          <` + `script>
            function exportTableToExcel() {
              const table = document.getElementById('analysisTable');
              const html = table.outerHTML;
              const url = 'data:application/vnd.ms-excel,' + encodeURIComponent(html);
              const link = document.createElement('a');
              link.href = url;
              link.download = '${symbol}_analysis.xls';
              link.click();
            }
          </` + `script>
        </body>
        </html>
      `);
    }

    function exportToExcel() {
      if (!currentAnalysis) {
        alert('Please analyze a stock first!');
        return;
      }

      const btn = document.getElementById('exportExcelBtn');
      btn.disabled = true;
      btn.innerHTML = '‚è≥ Generating Excel...';

      try {
        const { symbol, analysisText, stockInfo } = currentAnalysis;
        
        // Create CSV content (Excel can open CSV files)
        let csvContent = "data:text/csv;charset=utf-8,";
        csvContent += `"${symbol} Stock Analysis Report"\n\n`;
        csvContent += `"Company Name","${stockInfo ? stockInfo.name : symbol}"\n`;
        csvContent += `"Ticker","${symbol}"\n`;
        csvContent += `"Exchange","${stockInfo ? stockInfo.exchange : 'N/A'}"\n`;
        csvContent += `"Region","${stockInfo ? stockInfo.region : 'N/A'}"\n`;
        csvContent += `"Analysis Date","${new Date().toLocaleDateString()}"\n\n`;
        csvContent += `"COMPREHENSIVE ANALYSIS"\n`;
        csvContent += `"${analysisText.replace(/"/g, '""')}"\n`;

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement('a');
        link.setAttribute('href', encodedUri);
        link.setAttribute('download', `${symbol}_Invest AI_Analysis.csv`);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        btn.disabled = false;
        btn.innerHTML = 'üìä Export to Excel';
        
        alert(`‚úÖ Excel file downloaded successfully!\n\nFile: ${symbol}_Invest AI_Analysis.csv\n\nYou can open this file in Excel, Google Sheets, or any spreadsheet application.`);
      } catch (error) {
        console.error('Excel export error:', error);
        btn.disabled = false;
        btn.innerHTML = 'üìä Export to Excel';
        alert('Error exporting to Excel. Please try again.');
      }
    }

    function exportToPowerPoint() {
      if (!currentAnalysis) {
        alert('Please analyze a stock first!');
        return;
      }

      const btn = document.getElementById('exportPptBtn');
      btn.disabled = true;
      btn.innerHTML = '‚è≥ Generating PowerPoint...';

      try {
        const { symbol, analysisText, stockInfo, model } = currentAnalysis;
        
        // Parse the analysis into sections
        const sections = analysisText.split(/##\s+/);
        
        // Create HTML for PowerPoint (can be opened in PowerPoint)
        let htmlContent = `
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>${symbol} Investment Analysis</title>
  <style>
    @page { size: 10in 7.5in; margin: 0; }
    body { margin: 0; font-family: Arial, sans-serif; }
    .slide {
      width: 10in;
      height: 7.5in;
      page-break-after: always;
      position: relative;
      background: linear-gradient(135deg, #1E2761 0%, #2F3C7E 100%);
      color: white;
      padding: 60px;
      box-sizing: border-box;
    }
    .slide h1 { font-size: 48px; margin-bottom: 30px; color: #39ff14; }
    .slide h2 { font-size: 36px; margin: 20px 0; color: #39ff14; }
    .slide h3 { font-size: 24px; margin: 15px 0; color: #CADCFC; }
    .slide p, .slide li { font-size: 18px; line-height: 1.6; }
    .slide ul { margin-left: 30px; }
    .logo { position: absolute; bottom: 30px; right: 60px; font-size: 24px; color: rgba(255,255,255,0.3); font-weight: bold; }
    .title-slide { text-align: center; display: flex; flex-direction: column; justify-content: center; align-items: center; }
    .content-slide { background: white; color: #1E2761; }
    .content-slide h2 { color: #1E2761; border-bottom: 4px solid #39ff14; padding-bottom: 10px; }
  </style>
</head>
<body>
  <!-- Title Slide -->
  <div class="slide title-slide">
    <h1>${symbol} Investment Analysis</h1>
    <h2>${stockInfo ? stockInfo.name : symbol}</h2>
    <p style="font-size: 24px; margin-top: 40px;">Generated by ${model}</p>
    <p style="font-size: 18px; color: #CADCFC;">${new Date().toLocaleDateString()}</p>
    <div class="logo">Invest AI</div>
  </div>

  <!-- Company Info Slide -->
  <div class="slide content-slide">
    <h2>Company Information</h2>
    <ul style="font-size: 22px; line-height: 2;">
      <li><strong>Ticker:</strong> ${symbol}</li>
      <li><strong>Company:</strong> ${stockInfo ? stockInfo.name : symbol}</li>
      <li><strong>Exchange:</strong> ${stockInfo ? stockInfo.exchange : 'N/A'}</li>
      <li><strong>Region:</strong> ${stockInfo ? stockInfo.region : 'N/A'}</li>
    </ul>
    <div class="logo">Invest AI</div>
  </div>
`;

        // Add content slides for each major section
        sections.forEach((section, index) => {
          if (section.trim() && index > 0) {
            const lines = section.trim().split('\n');
            const title = lines[0].replace(/#+\s*/g, '').trim();
            const content = lines.slice(1).join('\n').trim();
            
            htmlContent += `
  <div class="slide content-slide">
    <h2>${title}</h2>
    <div style="font-size: 16px; overflow: hidden;">
      ${content.replace(/\n/g, '<br>').substring(0, 800)}${content.length > 800 ? '...' : ''}
    </div>
    <div class="logo">Invest AI</div>
  </div>
`;
          }
        });

        htmlContent += `
</body>
</html>`;

        // Create download
        const blob = new Blob([htmlContent], { type: 'text/html' });
        const url = window.URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `${symbol}_Invest AI_Presentation.html`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        window.URL.revokeObjectURL(url);

        btn.disabled = false;
        btn.innerHTML = 'üìë Export to PowerPoint';
        
        alert(`‚úÖ Presentation downloaded successfully!\n\nFile: ${symbol}_Invest AI_Presentation.html\n\nTo convert to PowerPoint:\n1. Open the HTML file in your browser\n2. Print to PDF\n3. Import PDF into PowerPoint\n\nOr open the HTML file directly in PowerPoint 2016+ (File > Open)`);
      } catch (error) {
        console.error('PowerPoint export error:', error);
        btn.disabled = false;
        btn.innerHTML = 'üìë Export to PowerPoint';
        alert('Error exporting to PowerPoint. Please try again.');
      }
    }
  </script>
</body>
</html>